%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect14[["PgSelect[14∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Object11 -->|rejectNull| PgSelect14
    Connection12 --> PgSelect14
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelect14 --> PgSelectRows15
    Access18{{"Access[18∈0] ➊<br />ᐸ14.cursorDetailsᐳ"}}:::plan
    PgSelect14 --> Access18
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant31{{"Constant[31∈0] ➊<br />ᐸ'left_arms'ᐳ"}}:::plan
    Constant51{{"Constant[51∈0] ➊<br />ᐸ'person_secrets'ᐳ"}}:::plan
    PgCursor19{{"PgCursor[19∈1]"}}:::plan
    PgSelectSingle17{{"PgSelectSingle[17∈1]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle17 & Access18 --> PgCursor19
    PgSelect24[["PgSelect[24∈1]<br />ᐸleft_armᐳ"]]:::plan
    PgClassExpression20{{"PgClassExpression[20∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Object11 & PgClassExpression20 --> PgSelect24
    List33{{"List[33∈1]<br />ᐸ31,32ᐳ"}}:::plan
    PgClassExpression32{{"PgClassExpression[32∈1]<br />ᐸ__left_arm__.”id”ᐳ"}}:::plan
    Constant31 & PgClassExpression32 --> List33
    PgSelect36[["PgSelect[36∈1]<br />ᐸpersonᐳ"]]:::plan
    PgClassExpression35{{"PgClassExpression[35∈1]<br />ᐸ__left_arm...person_id”ᐳ"}}:::plan
    Object11 & PgClassExpression35 --> PgSelect36
    PgSelect46[["PgSelect[46∈1]<br />ᐸperson_secretᐳ"]]:::plan
    Object11 & PgClassExpression20 --> PgSelect46
    List53{{"List[53∈1]<br />ᐸ51,52ᐳ"}}:::plan
    PgClassExpression52{{"PgClassExpression[52∈1]<br />ᐸ__person_s...person_id”ᐳ"}}:::plan
    Constant51 & PgClassExpression52 --> List53
    PgSelect55[["PgSelect[55∈1]<br />ᐸpersonᐳ"]]:::plan
    Object11 & PgClassExpression52 --> PgSelect55
    __Item16[/"__Item[16∈1]<br />ᐸ15ᐳ"\]:::itemplan
    PgSelectRows15 ==> __Item16
    __Item16 --> PgSelectSingle17
    PgSelectSingle17 --> PgClassExpression20
    PgClassExpression21{{"PgClassExpression[21∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression21
    PgClassExpression23{{"PgClassExpression[23∈1]<br />ᐸ”c”.”perso..._person__)ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression23
    First28{{"First[28∈1]"}}:::plan
    PgSelectRows29[["PgSelectRows[29∈1]"]]:::plan
    PgSelectRows29 --> First28
    PgSelect24 --> PgSelectRows29
    PgSelectSingle30{{"PgSelectSingle[30∈1]<br />ᐸleft_armᐳ"}}:::plan
    First28 --> PgSelectSingle30
    PgSelectSingle30 --> PgClassExpression32
    Lambda34{{"Lambda[34∈1]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List33 --> Lambda34
    PgSelectSingle30 --> PgClassExpression35
    First38{{"First[38∈1]"}}:::plan
    PgSelectRows39[["PgSelectRows[39∈1]"]]:::plan
    PgSelectRows39 --> First38
    PgSelect36 --> PgSelectRows39
    PgSelectSingle40{{"PgSelectSingle[40∈1]<br />ᐸpersonᐳ"}}:::plan
    First38 --> PgSelectSingle40
    PgClassExpression41{{"PgClassExpression[41∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression41
    PgClassExpression42{{"PgClassExpression[42∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression42
    PgClassExpression44{{"PgClassExpression[44∈1]<br />ᐸ”c”.”perso..._person__)ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈1]<br />ᐸ__left_arm...in_metres”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression45
    First48{{"First[48∈1]"}}:::plan
    PgSelectRows49[["PgSelectRows[49∈1]"]]:::plan
    PgSelectRows49 --> First48
    PgSelect46 --> PgSelectRows49
    PgSelectSingle50{{"PgSelectSingle[50∈1]<br />ᐸperson_secretᐳ"}}:::plan
    First48 --> PgSelectSingle50
    PgSelectSingle50 --> PgClassExpression52
    Lambda54{{"Lambda[54∈1]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List53 --> Lambda54
    First57{{"First[57∈1]"}}:::plan
    PgSelectRows58[["PgSelectRows[58∈1]"]]:::plan
    PgSelectRows58 --> First57
    PgSelect55 --> PgSelectRows58
    PgSelectSingle59{{"PgSelectSingle[59∈1]<br />ᐸpersonᐳ"}}:::plan
    First57 --> PgSelectSingle59
    PgClassExpression60{{"PgClassExpression[60∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression61
    PgClassExpression63{{"PgClassExpression[63∈1]<br />ᐸ”c”.”perso..._person__)ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression63
    PgClassExpression64{{"PgClassExpression[64∈1]<br />ᐸ__person_s..._.”sekrit”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression64

    %% define steps

    subgraph "Buckets for queries/v4/one-to-one-backward"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 6, 9, 10, 31, 51, 11, 12<br />2: PgSelect[14]<br />ᐳ: Access[18]<br />3: PgSelectRows[15]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access10,Object11,Connection12,PgSelect14,PgSelectRows15,Access18,Constant31,Constant51 bucket0
    Bucket1("Bucket 1 (listItem)<br />Deps: 18, 11, 31, 51<br /><br />ROOT __Item{1}ᐸ15ᐳ[16]<br />1: <br />ᐳ: 17, 19, 20, 21, 23<br />2: PgSelect[24], PgSelect[46]<br />3: PgSelectRows[29], PgSelectRows[49]<br />ᐳ: 28, 30, 32, 33, 34, 35, 45, 48, 50, 52, 53, 54, 64<br />4: PgSelect[36], PgSelect[55]<br />5: PgSelectRows[39], PgSelectRows[58]<br />ᐳ: 38, 40, 41, 42, 44, 57, 59, 60, 61, 63"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item16,PgSelectSingle17,PgCursor19,PgClassExpression20,PgClassExpression21,PgClassExpression23,PgSelect24,First28,PgSelectRows29,PgSelectSingle30,PgClassExpression32,List33,Lambda34,PgClassExpression35,PgSelect36,First38,PgSelectRows39,PgSelectSingle40,PgClassExpression41,PgClassExpression42,PgClassExpression44,PgClassExpression45,PgSelect46,First48,PgSelectRows49,PgSelectSingle50,PgClassExpression52,List53,Lambda54,PgSelect55,First57,PgSelectRows58,PgSelectSingle59,PgClassExpression60,PgClassExpression61,PgClassExpression63,PgClassExpression64 bucket1
    Bucket0 --> Bucket1
    end
