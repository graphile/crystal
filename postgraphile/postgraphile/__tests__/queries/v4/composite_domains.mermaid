%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    Lambda70{{"Lambda[70∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant106{{"Constant[106∈0] ➊<br />ᐸ[Object: null prototype] {   cursorLower: null,   cursorUppeᐳ"}}:::plan
    Constant106 --> Lambda70
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    PgSelect19[["PgSelect[19∈1] ➊<br />ᐸpostsᐳ"]]:::plan
    Object17 & Connection18 & Lambda70 & Lambda70 & Lambda70 --> PgSelect19
    __Item20[/"__Item[20∈2]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelect19 ==> __Item20
    PgSelectSingle21{{"PgSelectSingle[21∈2]<br />ᐸpostsᐳ"}}:::plan
    __Item20 --> PgSelectSingle21
    PgClassExpression22{{"PgClassExpression[22∈3]<br />ᐸ__posts__.”id”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__posts__.”user_id”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    PgSelectSingle30{{"PgSelectSingle[30∈3]<br />ᐸfrmcdc_userUpdateContentᐳ"}}:::plan
    RemapKeys79{{"RemapKeys[79∈3]<br />ᐸ21:{”0”:2,”1”:3,”2”:4}ᐳ"}}:::plan
    RemapKeys79 --> PgSelectSingle30
    PgClassExpression31{{"PgClassExpression[31∈3]<br />ᐸ__frmcdc_u....”img_url”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression31
    PgClassExpression32{{"PgClassExpression[32∈3]<br />ᐸ__frmcdc_u...__.”lines”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression32
    PgClassExpression62{{"PgClassExpression[62∈3]<br />ᐸ__posts__.”created_at”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression62
    PgSelectSingle21 --> RemapKeys79
    Access97{{"Access[97∈3]<br />ᐸ20.5ᐳ"}}:::plan
    __Item20 --> Access97
    PgSelect36[["PgSelect[36∈5]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ"]]:::plan
    __Item35[/"__Item[35∈5]<br />ᐸ32ᐳ"\]:::itemplan
    Object17 & __Item35 & Lambda70 --> PgSelect36
    PgClassExpression32 ==> __Item35
    __Item40[/"__Item[40∈6]<br />ᐸ36ᐳ"\]:::itemplan
    PgSelect36 ==> __Item40
    PgSelectSingle41{{"PgSelectSingle[41∈6]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ"}}:::plan
    __Item40 --> PgSelectSingle41
    PgClassExpression42{{"PgClassExpression[42∈6]<br />ᐸ__frmcdc_u...node_type”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression42
    PgClassExpression43{{"PgClassExpression[43∈6]<br />ᐸ__frmcdc_u...node_text”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression43
    __Item47[/"__Item[47∈7]<br />ᐸ97ᐳ"\]:::itemplan
    Access97 ==> __Item47
    PgSelectSingle48{{"PgSelectSingle[48∈7]<br />ᐸfrmcdc_userUpdateContentᐳ"}}:::plan
    __Item47 --> PgSelectSingle48
    PgClassExpression49{{"PgClassExpression[49∈7]<br />ᐸ__frmcdc_u....”img_url”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression49
    PgClassExpression50{{"PgClassExpression[50∈7]<br />ᐸ__frmcdc_u...__.”lines”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression50
    PgSelect54[["PgSelect[54∈9]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ"]]:::plan
    __Item53[/"__Item[53∈9]<br />ᐸ50ᐳ"\]:::itemplan
    Object17 & __Item53 & Lambda70 --> PgSelect54
    PgClassExpression50 ==> __Item53
    __Item58[/"__Item[58∈10]<br />ᐸ54ᐳ"\]:::itemplan
    PgSelect54 ==> __Item58
    PgSelectSingle59{{"PgSelectSingle[59∈10]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ"}}:::plan
    __Item58 --> PgSelectSingle59
    PgClassExpression60{{"PgClassExpression[60∈10]<br />ᐸ__frmcdc_u...node_type”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈10]<br />ᐸ__frmcdc_u...node_text”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression61

    %% define steps

    subgraph "Buckets for queries/v4/composite_domains"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access15,Access16,Object17,Connection18,Lambda70,Constant106 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18, 70<br /><br />ROOT Connectionᐸ14ᐳ[18]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect19 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 17, 70<br /><br />ROOT __Item{2}ᐸ19ᐳ[20]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item20,PgSelectSingle21 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 21, 20, 17, 70<br /><br />ROOT PgSelectSingle{2}ᐸpostsᐳ[21]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression22,PgClassExpression23,PgSelectSingle30,PgClassExpression31,PgClassExpression32,PgClassExpression62,RemapKeys79,Access97 bucket3
    Bucket5("Bucket 5 (listItem)<br />Deps: 17, 70<br /><br />ROOT __Item{5}ᐸ32ᐳ[35]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item35,PgSelect36 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ36ᐳ[40]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item40,PgSelectSingle41,PgClassExpression42,PgClassExpression43 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 17, 70<br /><br />ROOT __Item{7}ᐸ97ᐳ[47]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item47,PgSelectSingle48,PgClassExpression49,PgClassExpression50 bucket7
    Bucket9("Bucket 9 (listItem)<br />Deps: 17, 70<br /><br />ROOT __Item{9}ᐸ50ᐳ[53]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item53,PgSelect54 bucket9
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ54ᐳ[58]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item58,PgSelectSingle59,PgClassExpression60,PgClassExpression61 bucket10
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket5 & Bucket7
    Bucket5 --> Bucket6
    Bucket7 --> Bucket9
    Bucket9 --> Bucket10
    end
