%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% define steps
    __Value0["__Value[0∈0]"]:::plan
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Access9{{"Access[9∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Object11{{"Object[11∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant121{{"Constant[121∈0]<br />ᐸtrueᐳ"}}:::plan
    PgSelect8[["PgSelect[8∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First12{{"First[12∈0]"}}:::plan
    PgSelectSingle13{{"PgSelectSingle[13∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression14{{"PgClassExpression[14∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    Constant122{{"Constant[122∈0]<br />ᐸfalseᐳ"}}:::plan
    PgSelect16[["PgSelect[16∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First20{{"First[20∈0]"}}:::plan
    PgSelectSingle21{{"PgSelectSingle[21∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression22{{"PgClassExpression[22∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    Constant123{{"Constant[123∈0]<br />ᐸ42ᐳ"}}:::plan
    PgSelect24[["PgSelect[24∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First28{{"First[28∈0]"}}:::plan
    PgSelectSingle29{{"PgSelectSingle[29∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression30{{"PgClassExpression[30∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    Constant124{{"Constant[124∈0]<br />ᐸ3.1415ᐳ"}}:::plan
    PgSelect32[["PgSelect[32∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First36{{"First[36∈0]"}}:::plan
    PgSelectSingle37{{"PgSelectSingle[37∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression38{{"PgClassExpression[38∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    Constant125{{"Constant[125∈0]<br />ᐸ'hello, world!'ᐳ"}}:::plan
    PgSelect40[["PgSelect[40∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First44{{"First[44∈0]"}}:::plan
    PgSelectSingle45{{"PgSelectSingle[45∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression46{{"PgClassExpression[46∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    __InputDynamicScalar47{{"__InputDynamicScalar[47∈0]"}}:::plan
    PgSelect48[["PgSelect[48∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First52{{"First[52∈0]"}}:::plan
    PgSelectSingle53{{"PgSelectSingle[53∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression54{{"PgClassExpression[54∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    __InputDynamicScalar55{{"__InputDynamicScalar[55∈0]"}}:::plan
    PgSelect56[["PgSelect[56∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First60{{"First[60∈0]"}}:::plan
    PgSelectSingle61{{"PgSelectSingle[61∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression62{{"PgClassExpression[62∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    __InputDynamicScalar63{{"__InputDynamicScalar[63∈0]"}}:::plan
    PgSelect64[["PgSelect[64∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First68{{"First[68∈0]"}}:::plan
    PgSelectSingle69{{"PgSelectSingle[69∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression70{{"PgClassExpression[70∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    __InputDynamicScalar71{{"__InputDynamicScalar[71∈0]"}}:::plan
    PgSelect72[["PgSelect[72∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First76{{"First[76∈0]"}}:::plan
    PgSelectSingle77{{"PgSelectSingle[77∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression78{{"PgClassExpression[78∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    __InputDynamicScalar79{{"__InputDynamicScalar[79∈0]"}}:::plan
    PgSelect80[["PgSelect[80∈0]<br />ᐸjson_identityᐳ"]]:::plan
    First84{{"First[84∈0]"}}:::plan
    PgSelectSingle85{{"PgSelectSingle[85∈0]<br />ᐸjson_identityᐳ"}}:::plan
    PgClassExpression86{{"PgClassExpression[86∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    __InputDynamicScalar87{{"__InputDynamicScalar[87∈0]"}}:::plan
    PgSelect88[["PgSelect[88∈0]<br />ᐸjsonb_identityᐳ"]]:::plan
    First92{{"First[92∈0]"}}:::plan
    PgSelectSingle93{{"PgSelectSingle[93∈0]<br />ᐸjsonb_identityᐳ"}}:::plan
    PgClassExpression94{{"PgClassExpression[94∈0]<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    __InputDynamicScalar95{{"__InputDynamicScalar[95∈0]"}}:::plan
    PgSelect96[["PgSelect[96∈0]<br />ᐸjsonb_identityᐳ"]]:::plan
    First100{{"First[100∈0]"}}:::plan
    PgSelectSingle101{{"PgSelectSingle[101∈0]<br />ᐸjsonb_identityᐳ"}}:::plan
    PgClassExpression102{{"PgClassExpression[102∈0]<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    Connection115{{"Connection[115∈0]<br />ᐸ111ᐳ"}}:::plan
    PgSelect116[["PgSelect[116∈1]<br />ᐸtypesᐳ"]]:::plan
    __Item117[/"__Item[117∈2]<br />ᐸ116ᐳ"\]:::itemplan
    PgSelectSingle118{{"PgSelectSingle[118∈2]<br />ᐸtypesᐳ"}}:::plan
    PgClassExpression119{{"PgClassExpression[119∈3]<br />ᐸ__types__.”json”ᐳ"}}:::plan
    PgClassExpression120{{"PgClassExpression[120∈3]<br />ᐸ__types__.”jsonb”ᐳ"}}:::plan

    %% plan dependencies
    __Value3 --> Access9
    __Value3 --> Access10
    Access9 & Access10 --> Object11
    Object11 & Constant121 --> PgSelect8
    PgSelect8 --> First12
    First12 --> PgSelectSingle13
    PgSelectSingle13 --> PgClassExpression14
    Object11 & Constant122 --> PgSelect16
    PgSelect16 --> First20
    First20 --> PgSelectSingle21
    PgSelectSingle21 --> PgClassExpression22
    Object11 & Constant123 --> PgSelect24
    PgSelect24 --> First28
    First28 --> PgSelectSingle29
    PgSelectSingle29 --> PgClassExpression30
    Object11 & Constant124 --> PgSelect32
    PgSelect32 --> First36
    First36 --> PgSelectSingle37
    PgSelectSingle37 --> PgClassExpression38
    Object11 & Constant125 --> PgSelect40
    PgSelect40 --> First44
    First44 --> PgSelectSingle45
    PgSelectSingle45 --> PgClassExpression46
    Object11 & __InputDynamicScalar47 --> PgSelect48
    PgSelect48 --> First52
    First52 --> PgSelectSingle53
    PgSelectSingle53 --> PgClassExpression54
    Object11 & __InputDynamicScalar55 --> PgSelect56
    PgSelect56 --> First60
    First60 --> PgSelectSingle61
    PgSelectSingle61 --> PgClassExpression62
    Object11 & __InputDynamicScalar63 --> PgSelect64
    PgSelect64 --> First68
    First68 --> PgSelectSingle69
    PgSelectSingle69 --> PgClassExpression70
    Object11 & __InputDynamicScalar71 --> PgSelect72
    PgSelect72 --> First76
    First76 --> PgSelectSingle77
    PgSelectSingle77 --> PgClassExpression78
    Object11 & __InputDynamicScalar79 --> PgSelect80
    PgSelect80 --> First84
    First84 --> PgSelectSingle85
    PgSelectSingle85 --> PgClassExpression86
    Object11 & __InputDynamicScalar87 --> PgSelect88
    PgSelect88 --> First92
    First92 --> PgSelectSingle93
    PgSelectSingle93 --> PgClassExpression94
    Object11 & __InputDynamicScalar95 --> PgSelect96
    PgSelect96 --> First100
    First100 --> PgSelectSingle101
    PgSelectSingle101 --> PgClassExpression102
    Object11 & Connection115 --> PgSelect116
    PgSelect116 ==> __Item117
    __Item117 --> PgSelectSingle118
    PgSelectSingle118 --> PgClassExpression119
    PgSelectSingle118 --> PgClassExpression120

    subgraph "Buckets for queries/v4/dynamic-json"
    Bucket0("Bucket 0 (root)<br />1: <br />ᐳ: 9, 10, 47, 55, 63, 71, 79, 87, 95, 115, 121, 122, 123, 124, 125, 11<br />2: 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96<br />ᐳ: 12, 13, 14, 20, 21, 22, 28, 29, 30, 36, 37, 38, 44, 45, 46, 52, 53, 54, 60, 61, 62, 68, 69, 70, 76, 77, 78, 84, 85, 86, 92, 93, 94, 100, 101, 102"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__Value5,PgSelect8,Access9,Access10,Object11,First12,PgSelectSingle13,PgClassExpression14,PgSelect16,First20,PgSelectSingle21,PgClassExpression22,PgSelect24,First28,PgSelectSingle29,PgClassExpression30,PgSelect32,First36,PgSelectSingle37,PgClassExpression38,PgSelect40,First44,PgSelectSingle45,PgClassExpression46,__InputDynamicScalar47,PgSelect48,First52,PgSelectSingle53,PgClassExpression54,__InputDynamicScalar55,PgSelect56,First60,PgSelectSingle61,PgClassExpression62,__InputDynamicScalar63,PgSelect64,First68,PgSelectSingle69,PgClassExpression70,__InputDynamicScalar71,PgSelect72,First76,PgSelectSingle77,PgClassExpression78,__InputDynamicScalar79,PgSelect80,First84,PgSelectSingle85,PgClassExpression86,__InputDynamicScalar87,PgSelect88,First92,PgSelectSingle93,PgClassExpression94,__InputDynamicScalar95,PgSelect96,First100,PgSelectSingle101,PgClassExpression102,Connection115,Constant121,Constant122,Constant123,Constant124,Constant125 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 115<br /><br />ROOT Connectionᐸ111ᐳ[115]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect116 bucket1
    Bucket2("Bucket 2 (listItem)<br />ROOT __Item{2}ᐸ116ᐳ[117]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item117,PgSelectSingle118 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 118<br /><br />ROOT PgSelectSingle{2}ᐸtypesᐳ[118]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression119,PgClassExpression120 bucket3
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    end
