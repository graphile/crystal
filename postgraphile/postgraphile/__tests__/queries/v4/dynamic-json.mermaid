%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection97{{"Connection[97∈0] ➊<br />ᐸ95ᐳ"}}:::plan
    Constant92{{"Constant[92∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Constant92 & Constant92 & Constant92 --> Connection97
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant105{{"Constant[105∈0] ➊<br />ᐸtrueᐳ"}}:::plan
    Object10 & Constant105 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect16[["PgSelect[16∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    Constant106{{"Constant[106∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    Object10 & Constant106 --> PgSelect16
    PgSelect23[["PgSelect[23∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    Constant107{{"Constant[107∈0] ➊<br />ᐸ42ᐳ"}}:::plan
    Object10 & Constant107 --> PgSelect23
    PgSelect30[["PgSelect[30∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    Constant108{{"Constant[108∈0] ➊<br />ᐸ3.1415ᐳ"}}:::plan
    Object10 & Constant108 --> PgSelect30
    PgSelect37[["PgSelect[37∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    Constant109{{"Constant[109∈0] ➊<br />ᐸ'hello, world!'ᐳ"}}:::plan
    Object10 & Constant109 --> PgSelect37
    PgSelect44[["PgSelect[44∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar43{{"__InputDynamicScalar[43∈0] ➊"}}:::plan
    Object10 & __InputDynamicScalar43 --> PgSelect44
    PgSelect51[["PgSelect[51∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar50{{"__InputDynamicScalar[50∈0] ➊"}}:::plan
    Object10 & __InputDynamicScalar50 --> PgSelect51
    PgSelect58[["PgSelect[58∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar57{{"__InputDynamicScalar[57∈0] ➊"}}:::plan
    Object10 & __InputDynamicScalar57 --> PgSelect58
    PgSelect65[["PgSelect[65∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar64{{"__InputDynamicScalar[64∈0] ➊"}}:::plan
    Object10 & __InputDynamicScalar64 --> PgSelect65
    PgSelect72[["PgSelect[72∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar71{{"__InputDynamicScalar[71∈0] ➊"}}:::plan
    Object10 & __InputDynamicScalar71 --> PgSelect72
    PgSelect79[["PgSelect[79∈0] ➊<br />ᐸjsonb_identityᐳ"]]:::plan
    __InputDynamicScalar78{{"__InputDynamicScalar[78∈0] ➊"}}:::plan
    Object10 & __InputDynamicScalar78 --> PgSelect79
    PgSelect86[["PgSelect[86∈0] ➊<br />ᐸjsonb_identityᐳ"]]:::plan
    __InputDynamicScalar85{{"__InputDynamicScalar[85∈0] ➊"}}:::plan
    Object10 & __InputDynamicScalar85 --> PgSelect86
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    First11{{"First[11∈0] ➊"}}:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelectRows12 --> First11
    PgSelect7 --> PgSelectRows12
    PgSelectSingle13{{"PgSelectSingle[13∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First11 --> PgSelectSingle13
    PgClassExpression14{{"PgClassExpression[14∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression14
    First18{{"First[18∈0] ➊"}}:::plan
    PgSelectRows19[["PgSelectRows[19∈0] ➊"]]:::plan
    PgSelectRows19 --> First18
    PgSelect16 --> PgSelectRows19
    PgSelectSingle20{{"PgSelectSingle[20∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First18 --> PgSelectSingle20
    PgClassExpression21{{"PgClassExpression[21∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle20 --> PgClassExpression21
    First25{{"First[25∈0] ➊"}}:::plan
    PgSelectRows26[["PgSelectRows[26∈0] ➊"]]:::plan
    PgSelectRows26 --> First25
    PgSelect23 --> PgSelectRows26
    PgSelectSingle27{{"PgSelectSingle[27∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First25 --> PgSelectSingle27
    PgClassExpression28{{"PgClassExpression[28∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle27 --> PgClassExpression28
    First32{{"First[32∈0] ➊"}}:::plan
    PgSelectRows33[["PgSelectRows[33∈0] ➊"]]:::plan
    PgSelectRows33 --> First32
    PgSelect30 --> PgSelectRows33
    PgSelectSingle34{{"PgSelectSingle[34∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First32 --> PgSelectSingle34
    PgClassExpression35{{"PgClassExpression[35∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle34 --> PgClassExpression35
    First39{{"First[39∈0] ➊"}}:::plan
    PgSelectRows40[["PgSelectRows[40∈0] ➊"]]:::plan
    PgSelectRows40 --> First39
    PgSelect37 --> PgSelectRows40
    PgSelectSingle41{{"PgSelectSingle[41∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First39 --> PgSelectSingle41
    PgClassExpression42{{"PgClassExpression[42∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression42
    First46{{"First[46∈0] ➊"}}:::plan
    PgSelectRows47[["PgSelectRows[47∈0] ➊"]]:::plan
    PgSelectRows47 --> First46
    PgSelect44 --> PgSelectRows47
    PgSelectSingle48{{"PgSelectSingle[48∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First46 --> PgSelectSingle48
    PgClassExpression49{{"PgClassExpression[49∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression49
    First53{{"First[53∈0] ➊"}}:::plan
    PgSelectRows54[["PgSelectRows[54∈0] ➊"]]:::plan
    PgSelectRows54 --> First53
    PgSelect51 --> PgSelectRows54
    PgSelectSingle55{{"PgSelectSingle[55∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First53 --> PgSelectSingle55
    PgClassExpression56{{"PgClassExpression[56∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression56
    First60{{"First[60∈0] ➊"}}:::plan
    PgSelectRows61[["PgSelectRows[61∈0] ➊"]]:::plan
    PgSelectRows61 --> First60
    PgSelect58 --> PgSelectRows61
    PgSelectSingle62{{"PgSelectSingle[62∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First60 --> PgSelectSingle62
    PgClassExpression63{{"PgClassExpression[63∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression63
    First67{{"First[67∈0] ➊"}}:::plan
    PgSelectRows68[["PgSelectRows[68∈0] ➊"]]:::plan
    PgSelectRows68 --> First67
    PgSelect65 --> PgSelectRows68
    PgSelectSingle69{{"PgSelectSingle[69∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First67 --> PgSelectSingle69
    PgClassExpression70{{"PgClassExpression[70∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle69 --> PgClassExpression70
    First74{{"First[74∈0] ➊"}}:::plan
    PgSelectRows75[["PgSelectRows[75∈0] ➊"]]:::plan
    PgSelectRows75 --> First74
    PgSelect72 --> PgSelectRows75
    PgSelectSingle76{{"PgSelectSingle[76∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First74 --> PgSelectSingle76
    PgClassExpression77{{"PgClassExpression[77∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression77
    First81{{"First[81∈0] ➊"}}:::plan
    PgSelectRows82[["PgSelectRows[82∈0] ➊"]]:::plan
    PgSelectRows82 --> First81
    PgSelect79 --> PgSelectRows82
    PgSelectSingle83{{"PgSelectSingle[83∈0] ➊<br />ᐸjsonb_identityᐳ"}}:::plan
    First81 --> PgSelectSingle83
    PgClassExpression84{{"PgClassExpression[84∈0] ➊<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression84
    First88{{"First[88∈0] ➊"}}:::plan
    PgSelectRows89[["PgSelectRows[89∈0] ➊"]]:::plan
    PgSelectRows89 --> First88
    PgSelect86 --> PgSelectRows89
    PgSelectSingle90{{"PgSelectSingle[90∈0] ➊<br />ᐸjsonb_identityᐳ"}}:::plan
    First88 --> PgSelectSingle90
    PgClassExpression91{{"PgClassExpression[91∈0] ➊<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    PgSelectSingle90 --> PgClassExpression91
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant113{{"Constant[113∈0] ➊<br />ᐸ[Function: applyInputConstant]ᐳ"}}:::plan
    PgSelect99[["PgSelect[99∈1] ➊<br />ᐸtypesᐳ"]]:::plan
    Object10 & Constant113 & Connection97 & Constant92 & Constant92 & Constant92 --> PgSelect99
    PgSelectRows100[["PgSelectRows[100∈1] ➊"]]:::plan
    PgSelect99 --> PgSelectRows100
    __Item101[/"__Item[101∈2]<br />ᐸ100ᐳ"\]:::itemplan
    PgSelectRows100 ==> __Item101
    PgSelectSingle102{{"PgSelectSingle[102∈2]<br />ᐸtypesᐳ"}}:::plan
    __Item101 --> PgSelectSingle102
    PgClassExpression103{{"PgClassExpression[103∈3]<br />ᐸ__types__.”json”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression103
    PgClassExpression104{{"PgClassExpression[104∈3]<br />ᐸ__types__.”jsonb”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression104

    %% define steps

    subgraph "Buckets for queries/v4/dynamic-json"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 43, 50, 57, 64, 71, 78, 85, 92, 105, 106, 107, 108, 109, 113, 10, 97<br />2: 7, 16, 23, 30, 37, 44, 51, 58, 65, 72, 79, 86<br />3: 12, 19, 26, 33, 40, 47, 54, 61, 68, 75, 82, 89<br />ᐳ: 11, 13, 14, 18, 20, 21, 25, 27, 28, 32, 34, 35, 39, 41, 42, 46, 48, 49, 53, 55, 56, 60, 62, 63, 67, 69, 70, 74, 76, 77, 81, 83, 84, 88, 90, 91"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,First11,PgSelectRows12,PgSelectSingle13,PgClassExpression14,PgSelect16,First18,PgSelectRows19,PgSelectSingle20,PgClassExpression21,PgSelect23,First25,PgSelectRows26,PgSelectSingle27,PgClassExpression28,PgSelect30,First32,PgSelectRows33,PgSelectSingle34,PgClassExpression35,PgSelect37,First39,PgSelectRows40,PgSelectSingle41,PgClassExpression42,__InputDynamicScalar43,PgSelect44,First46,PgSelectRows47,PgSelectSingle48,PgClassExpression49,__InputDynamicScalar50,PgSelect51,First53,PgSelectRows54,PgSelectSingle55,PgClassExpression56,__InputDynamicScalar57,PgSelect58,First60,PgSelectRows61,PgSelectSingle62,PgClassExpression63,__InputDynamicScalar64,PgSelect65,First67,PgSelectRows68,PgSelectSingle69,PgClassExpression70,__InputDynamicScalar71,PgSelect72,First74,PgSelectRows75,PgSelectSingle76,PgClassExpression77,__InputDynamicScalar78,PgSelect79,First81,PgSelectRows82,PgSelectSingle83,PgClassExpression84,__InputDynamicScalar85,PgSelect86,First88,PgSelectRows89,PgSelectSingle90,PgClassExpression91,Constant92,Connection97,Constant105,Constant106,Constant107,Constant108,Constant109,Constant113 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 10, 113, 97, 92<br /><br />ROOT Connectionᐸ95ᐳ[97]<br />1: PgSelect[99]<br />2: PgSelectRows[100]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect99,PgSelectRows100 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ100ᐳ[101]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item101,PgSelectSingle102 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 102<br /><br />ROOT PgSelectSingle{2}ᐸtypesᐳ[102]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression103,PgClassExpression104 bucket3
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    end
