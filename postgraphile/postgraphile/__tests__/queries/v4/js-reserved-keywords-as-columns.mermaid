%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect26[["PgSelect[26∈0] ➊<br />ᐸmaterialᐳ"]]:::plan
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant112{{"Constant[112∈0] ➊<br />ᐸ'concrete'ᐳ"}}:::plan
    Lambda71{{"Lambda[71∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Object17 & Constant112 & Lambda71 --> PgSelect26
    PgSelect33[["PgSelect[33∈0] ➊<br />ᐸmaterialᐳ"]]:::plan
    Constant113{{"Constant[113∈0] ➊<br />ᐸ'spongy'ᐳ"}}:::plan
    Object17 & Constant113 & Lambda71 --> PgSelect33
    PgSelect51[["PgSelect[51∈0] ➊<br />ᐸcropᐳ"]]:::plan
    Constant114{{"Constant[114∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object17 & Constant114 & Lambda71 --> PgSelect51
    PgSelect58[["PgSelect[58∈0] ➊<br />ᐸcropᐳ"]]:::plan
    Constant115{{"Constant[115∈0] ➊<br />ᐸ'corn'ᐳ"}}:::plan
    Object17 & Constant115 & Lambda71 --> PgSelect58
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    PgSelect43[["PgSelect[43∈0] ➊<br />ᐸcropᐳ"]]:::plan
    Object17 & Lambda71 --> PgSelect43
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    First28{{"First[28∈0] ➊"}}:::plan
    PgSelect26 --> First28
    PgSelectSingle29{{"PgSelectSingle[29∈0] ➊<br />ᐸmaterialᐳ"}}:::plan
    First28 --> PgSelectSingle29
    First35{{"First[35∈0] ➊"}}:::plan
    PgSelect33 --> First35
    PgSelectSingle36{{"PgSelectSingle[36∈0] ➊<br />ᐸmaterialᐳ"}}:::plan
    First35 --> PgSelectSingle36
    First53{{"First[53∈0] ➊"}}:::plan
    PgSelect51 --> First53
    PgSelectSingle54{{"PgSelectSingle[54∈0] ➊<br />ᐸcropᐳ"}}:::plan
    First53 --> PgSelectSingle54
    First60{{"First[60∈0] ➊"}}:::plan
    PgSelect58 --> First60
    PgSelectSingle61{{"PgSelectSingle[61∈0] ➊<br />ᐸcropᐳ"}}:::plan
    First60 --> PgSelectSingle61
    Constant116{{"Constant[116∈0] ➊<br />ᐸ[Object: null prototype] {   cursorLower: null,   cursorUppeᐳ"}}:::plan
    Constant116 --> Lambda71
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    PgSelect19[["PgSelect[19∈1] ➊<br />ᐸmaterialᐳ"]]:::plan
    Object17 & Connection18 & Lambda71 --> PgSelect19
    __Item20[/"__Item[20∈2]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelect19 ==> __Item20
    PgSelectSingle21{{"PgSelectSingle[21∈2]<br />ᐸmaterialᐳ"}}:::plan
    __Item20 --> PgSelectSingle21
    PgClassExpression22{{"PgClassExpression[22∈3]<br />ᐸ__material__.”valueOf”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__material__.”class”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    PgClassExpression24{{"PgClassExpression[24∈3]<br />ᐸ__material__.”id”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression24
    PgClassExpression30{{"PgClassExpression[30∈4] ➊<br />ᐸ__material__.”class”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression30
    PgClassExpression31{{"PgClassExpression[31∈4] ➊<br />ᐸ__material__.”id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression31
    PgClassExpression37{{"PgClassExpression[37∈5] ➊<br />ᐸ__material__.”class”ᐳ"}}:::plan
    PgSelectSingle36 --> PgClassExpression37
    PgClassExpression38{{"PgClassExpression[38∈5] ➊<br />ᐸ__material__.”id”ᐳ"}}:::plan
    PgSelectSingle36 --> PgClassExpression38
    __Item45[/"__Item[45∈6]<br />ᐸ43ᐳ"\]:::itemplan
    PgSelect43 ==> __Item45
    PgSelectSingle46{{"PgSelectSingle[46∈6]<br />ᐸcropᐳ"}}:::plan
    __Item45 --> PgSelectSingle46
    PgClassExpression47{{"PgClassExpression[47∈6]<br />ᐸ__crop__.”id”ᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression47
    PgClassExpression48{{"PgClassExpression[48∈6]<br />ᐸ__crop__.”amount”ᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression48
    PgClassExpression49{{"PgClassExpression[49∈6]<br />ᐸ__crop__.”yield”ᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression49
    PgClassExpression55{{"PgClassExpression[55∈7] ➊<br />ᐸ__crop__.”yield”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈7] ➊<br />ᐸ__crop__.”amount”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression56
    PgClassExpression62{{"PgClassExpression[62∈8] ➊<br />ᐸ__crop__.”amount”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈8] ➊<br />ᐸ__crop__.”id”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression63

    %% define steps

    subgraph "Buckets for queries/v4/js-reserved-keywords-as-columns"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 15, 16, 18, 112, 113, 114, 115, 116, 17, 71<br />2: 26, 33, 43, 51, 58<br />ᐳ: 28, 29, 35, 36, 53, 54, 60, 61"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access15,Access16,Object17,Connection18,PgSelect26,First28,PgSelectSingle29,PgSelect33,First35,PgSelectSingle36,PgSelect43,PgSelect51,First53,PgSelectSingle54,PgSelect58,First60,PgSelectSingle61,Lambda71,Constant112,Constant113,Constant114,Constant115,Constant116 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18, 71<br /><br />ROOT Connectionᐸ14ᐳ[18]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect19 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ19ᐳ[20]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item20,PgSelectSingle21 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 21<br /><br />ROOT PgSelectSingle{2}ᐸmaterialᐳ[21]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression22,PgClassExpression23,PgClassExpression24 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 29<br /><br />ROOT PgSelectSingleᐸmaterialᐳ[29]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression30,PgClassExpression31 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 36<br /><br />ROOT PgSelectSingleᐸmaterialᐳ[36]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression37,PgClassExpression38 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ43ᐳ[45]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item45,PgSelectSingle46,PgClassExpression47,PgClassExpression48,PgClassExpression49 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 54<br /><br />ROOT PgSelectSingleᐸcropᐳ[54]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression55,PgClassExpression56 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 61<br /><br />ROOT PgSelectSingleᐸcropᐳ[61]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression62,PgClassExpression63 bucket8
    Bucket0 --> Bucket1 & Bucket4 & Bucket5 & Bucket6 & Bucket7 & Bucket8
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    end
