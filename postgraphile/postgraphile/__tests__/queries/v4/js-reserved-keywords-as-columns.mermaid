%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/js-reserved-keywords-as-columns"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 9, 10, 12, 61, 62, 63, 64, 11<br />2: 15, 21, 26, 29, 35<br />3: 18, 24, 32, 38, 40<br />ᐳ: 17, 19, 23, 25, 31, 33, 37, 39"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 12<br /><br />ROOT Connectionᐸ8ᐳ[12]<br />1: PgSelect[43]<br />2: PgSelectRows[52]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 19<br /><br />ROOT PgSelectSingleᐸmaterialᐳ[19]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 25<br /><br />ROOT PgSelectSingleᐸmaterialᐳ[25]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 33<br /><br />ROOT PgSelectSingleᐸcropᐳ[33]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 39<br /><br />ROOT PgSelectSingleᐸcropᐳ[39]"):::bucket
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ40ᐳ[41]"):::bucket
    Bucket7("Bucket 7 (listItem)<br /><br />ROOT __Item{7}ᐸ52ᐳ[53]"):::bucket
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 54<br /><br />ROOT PgSelectSingle{7}ᐸmaterialᐳ[54]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6
    Bucket1 --> Bucket7
    Bucket7 --> Bucket8

    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    PgSelect15[["PgSelect[15∈0] ➊<br />ᐸmaterialᐳ"]]:::plan
    Constant61{{"Constant[61∈0] ➊<br />ᐸ'concrete'ᐳ"}}:::plan
    Object11 & Constant61 --> PgSelect15
    PgSelect21[["PgSelect[21∈0] ➊<br />ᐸmaterialᐳ"]]:::plan
    Constant62{{"Constant[62∈0] ➊<br />ᐸ'spongy'ᐳ"}}:::plan
    Object11 & Constant62 --> PgSelect21
    PgSelect29[["PgSelect[29∈0] ➊<br />ᐸcropᐳ"]]:::plan
    Constant63{{"Constant[63∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object11 & Constant63 --> PgSelect29
    PgSelect35[["PgSelect[35∈0] ➊<br />ᐸcropᐳ"]]:::plan
    Constant64{{"Constant[64∈0] ➊<br />ᐸ'corn'ᐳ"}}:::plan
    Object11 & Constant64 --> PgSelect35
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    First17{{"First[17∈0] ➊"}}:::plan
    PgSelectRows18[["PgSelectRows[18∈0] ➊"]]:::plan
    PgSelectRows18 --> First17
    PgSelect15 --> PgSelectRows18
    PgSelectSingle19{{"PgSelectSingle[19∈0] ➊<br />ᐸmaterialᐳ"}}:::plan
    First17 --> PgSelectSingle19
    First23{{"First[23∈0] ➊"}}:::plan
    PgSelectRows24[["PgSelectRows[24∈0] ➊"]]:::plan
    PgSelectRows24 --> First23
    PgSelect21 --> PgSelectRows24
    PgSelectSingle25{{"PgSelectSingle[25∈0] ➊<br />ᐸmaterialᐳ"}}:::plan
    First23 --> PgSelectSingle25
    PgSelect26[["PgSelect[26∈0] ➊<br />ᐸcropᐳ"]]:::plan
    Object11 --> PgSelect26
    First31{{"First[31∈0] ➊"}}:::plan
    PgSelectRows32[["PgSelectRows[32∈0] ➊"]]:::plan
    PgSelectRows32 --> First31
    PgSelect29 --> PgSelectRows32
    PgSelectSingle33{{"PgSelectSingle[33∈0] ➊<br />ᐸcropᐳ"}}:::plan
    First31 --> PgSelectSingle33
    First37{{"First[37∈0] ➊"}}:::plan
    PgSelectRows38[["PgSelectRows[38∈0] ➊"]]:::plan
    PgSelectRows38 --> First37
    PgSelect35 --> PgSelectRows38
    PgSelectSingle39{{"PgSelectSingle[39∈0] ➊<br />ᐸcropᐳ"}}:::plan
    First37 --> PgSelectSingle39
    PgSelectRows40[["PgSelectRows[40∈0] ➊"]]:::plan
    PgSelect26 --> PgSelectRows40
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    PgSelect43[["PgSelect[43∈1] ➊<br />ᐸmaterialᐳ"]]:::plan
    Object11 & Connection12 --> PgSelect43
    PgSelectRows52[["PgSelectRows[52∈1] ➊"]]:::plan
    PgSelect43 --> PgSelectRows52
    PgClassExpression44{{"PgClassExpression[44∈2] ➊<br />ᐸ__material__.”class”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression44
    PgClassExpression48{{"PgClassExpression[48∈2] ➊<br />ᐸ__material__.”id”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression48
    PgClassExpression45{{"PgClassExpression[45∈3] ➊<br />ᐸ__material__.”class”ᐳ"}}:::plan
    PgSelectSingle25 --> PgClassExpression45
    PgClassExpression49{{"PgClassExpression[49∈3] ➊<br />ᐸ__material__.”id”ᐳ"}}:::plan
    PgSelectSingle25 --> PgClassExpression49
    PgClassExpression46{{"PgClassExpression[46∈4] ➊<br />ᐸ__crop__.”yield”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression46
    PgClassExpression50{{"PgClassExpression[50∈4] ➊<br />ᐸ__crop__.”amount”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression50
    PgClassExpression47{{"PgClassExpression[47∈5] ➊<br />ᐸ__crop__.”amount”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression47
    PgClassExpression51{{"PgClassExpression[51∈5] ➊<br />ᐸ__crop__.”id”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression51
    __Item41[/"__Item[41∈6]<br />ᐸ40ᐳ"\]:::itemplan
    PgSelectRows40 ==> __Item41
    PgSelectSingle42{{"PgSelectSingle[42∈6]<br />ᐸcropᐳ"}}:::plan
    __Item41 --> PgSelectSingle42
    PgClassExpression55{{"PgClassExpression[55∈6]<br />ᐸ__crop__.”id”ᐳ"}}:::plan
    PgSelectSingle42 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈6]<br />ᐸ__crop__.”amount”ᐳ"}}:::plan
    PgSelectSingle42 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈6]<br />ᐸ__crop__.”yield”ᐳ"}}:::plan
    PgSelectSingle42 --> PgClassExpression57
    __Item53[/"__Item[53∈7]<br />ᐸ52ᐳ"\]:::itemplan
    PgSelectRows52 ==> __Item53
    PgSelectSingle54{{"PgSelectSingle[54∈7]<br />ᐸmaterialᐳ"}}:::plan
    __Item53 --> PgSelectSingle54
    PgClassExpression58{{"PgClassExpression[58∈8]<br />ᐸ__material__.”valueOf”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈8]<br />ᐸ__material__.”class”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression59
    PgClassExpression60{{"PgClassExpression[60∈8]<br />ᐸ__material__.”id”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression60

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access10,Object11,Connection12,PgSelect15,First17,PgSelectRows18,PgSelectSingle19,PgSelect21,First23,PgSelectRows24,PgSelectSingle25,PgSelect26,PgSelect29,First31,PgSelectRows32,PgSelectSingle33,PgSelect35,First37,PgSelectRows38,PgSelectSingle39,PgSelectRows40,Constant61,Constant62,Constant63,Constant64 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect43,PgSelectRows52 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression44,PgClassExpression48 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression45,PgClassExpression49 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression46,PgClassExpression50 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression47,PgClassExpression51 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item41,PgSelectSingle42,PgClassExpression55,PgClassExpression56,PgClassExpression57 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item53,PgSelectSingle54 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression58,PgClassExpression59,PgClassExpression60 bucket8

