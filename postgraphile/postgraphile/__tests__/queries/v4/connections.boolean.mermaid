%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/connections.boolean"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 12, 13, 94, 7<br /><br />ROOT Connectionᐸ9ᐳ[13]<br />1: PgSelect[22], PgSelect[26]<br />ᐳ: 23, 48, 69, 70, 71, 78, 79<br />2: PgSelectRows[28], PgSelectRows[38]<br />ᐳ: 27, 29, 30, 45, 47, 49, 57, 59, 61"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 12, 19, 20, 94, 7<br /><br />ROOT Connectionᐸ17ᐳ[19]<br />1: PgSelect[24], PgSelect[31]<br />ᐳ: 25, 54, 73, 74, 75, 82, 83<br />2: PgSelectRows[33], PgSelectRows[39]<br />ᐳ: 32, 34, 35, 51, 53, 55, 63, 65, 67"):::bucket
    Bucket3("Bucket 3 (listItem)<br />Deps: 48<br /><br />ROOT __Item{3}ᐸ38ᐳ[40]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 54<br /><br />ROOT __Item{4}ᐸ39ᐳ[42]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 41, 48<br /><br />ROOT PgSelectSingle{3}ᐸcompound_keyᐳ[41]"):::bucket
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 43, 54<br /><br />ROOT PgSelectSingle{4}ᐸcompound_keyᐳ[43]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2
    Bucket1 --> Bucket3
    Bucket2 --> Bucket4
    Bucket3 --> Bucket5
    Bucket4 --> Bucket6

    %% plan dependencies
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    Connection19{{"Connection[19∈0] ➊<br />ᐸ17ᐳ"}}:::plan
    Constant94{{"Constant[94∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Lambda20{{"Lambda[20∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant94 & Lambda20 --> Connection19
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    Connection13{{"Connection[13∈0] ➊<br />ᐸ9ᐳ"}}:::plan
    Constant94 --> Connection13
    Constant95{{"Constant[95∈0] ➊<br />ᐸ'WyIzNjY0MzE3ZDgwIixmYWxzZSwyLDFd'ᐳ"}}:::plan
    Constant95 --> Lambda20
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Object78{{"Object[78∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access69{{"Access[69∈1] ➊<br />ᐸ22.hasMoreᐳ"}}:::plan
    Constant94 & Access69 --> Object78
    PgSelect22[["PgSelect[22∈1] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Object12 & Connection13 & Constant94 --> PgSelect22
    Object70{{"Object[70∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant94 & Access69 --> Object70
    PgSelect26[["PgSelect[26∈1] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object12 & Connection13 --> PgSelect26
    PgCursor49{{"PgCursor[49∈1] ➊"}}:::plan
    PgSelectSingle47{{"PgSelectSingle[47∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Access48{{"Access[48∈1] ➊<br />ᐸ22.cursorDetailsᐳ"}}:::plan
    PgSelectSingle47 & Access48 --> PgCursor49
    PgCursor61{{"PgCursor[61∈1] ➊"}}:::plan
    PgSelectSingle59{{"PgSelectSingle[59∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle59 & Access48 --> PgCursor61
    PgPageInfo23{{"PgPageInfo[23∈1] ➊"}}:::plan
    Connection13 --> PgPageInfo23
    First27{{"First[27∈1] ➊"}}:::plan
    PgSelectRows28[["PgSelectRows[28∈1] ➊"]]:::plan
    PgSelectRows28 --> First27
    PgSelect26 --> PgSelectRows28
    PgSelectSingle29{{"PgSelectSingle[29∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First27 --> PgSelectSingle29
    PgClassExpression30{{"PgClassExpression[30∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression30
    PgSelectRows38[["PgSelectRows[38∈1] ➊"]]:::plan
    PgSelect22 --> PgSelectRows38
    First45{{"First[45∈1] ➊"}}:::plan
    PgSelectRows38 --> First45
    First45 --> PgSelectSingle47
    PgSelect22 --> Access48
    Last57{{"Last[57∈1] ➊"}}:::plan
    PgSelectRows38 --> Last57
    Last57 --> PgSelectSingle59
    PgSelect22 --> Access69
    Lambda71{{"Lambda[71∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object70 --> Lambda71
    Lambda79{{"Lambda[79∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object78 --> Lambda79
    PgSelect24[["PgSelect[24∈2] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Object12 & Connection19 & Lambda20 & Constant94 --> PgSelect24
    Object82{{"Object[82∈2] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access73{{"Access[73∈2] ➊<br />ᐸ24.hasMoreᐳ"}}:::plan
    Constant94 & Access73 --> Object82
    Object74{{"Object[74∈2] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant94 & Access73 --> Object74
    PgSelect31[["PgSelect[31∈2] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object12 & Connection19 --> PgSelect31
    PgCursor55{{"PgCursor[55∈2] ➊"}}:::plan
    PgSelectSingle53{{"PgSelectSingle[53∈2] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Access54{{"Access[54∈2] ➊<br />ᐸ24.cursorDetailsᐳ"}}:::plan
    PgSelectSingle53 & Access54 --> PgCursor55
    PgCursor67{{"PgCursor[67∈2] ➊"}}:::plan
    PgSelectSingle65{{"PgSelectSingle[65∈2] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle65 & Access54 --> PgCursor67
    PgPageInfo25{{"PgPageInfo[25∈2] ➊"}}:::plan
    Connection19 --> PgPageInfo25
    First32{{"First[32∈2] ➊"}}:::plan
    PgSelectRows33[["PgSelectRows[33∈2] ➊"]]:::plan
    PgSelectRows33 --> First32
    PgSelect31 --> PgSelectRows33
    PgSelectSingle34{{"PgSelectSingle[34∈2] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First32 --> PgSelectSingle34
    PgClassExpression35{{"PgClassExpression[35∈2] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle34 --> PgClassExpression35
    PgSelectRows39[["PgSelectRows[39∈2] ➊"]]:::plan
    PgSelect24 --> PgSelectRows39
    First51{{"First[51∈2] ➊"}}:::plan
    PgSelectRows39 --> First51
    First51 --> PgSelectSingle53
    PgSelect24 --> Access54
    Last63{{"Last[63∈2] ➊"}}:::plan
    PgSelectRows39 --> Last63
    Last63 --> PgSelectSingle65
    PgSelect24 --> Access73
    Lambda75{{"Lambda[75∈2] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object74 --> Lambda75
    Lambda83{{"Lambda[83∈2] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object82 --> Lambda83
    __Item40[/"__Item[40∈3]<br />ᐸ38ᐳ"\]:::itemplan
    PgSelectRows38 ==> __Item40
    PgSelectSingle41{{"PgSelectSingle[41∈3]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item40 --> PgSelectSingle41
    __Item42[/"__Item[42∈4]<br />ᐸ39ᐳ"\]:::itemplan
    PgSelectRows39 ==> __Item42
    PgSelectSingle43{{"PgSelectSingle[43∈4]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item42 --> PgSelectSingle43
    PgCursor85{{"PgCursor[85∈5]"}}:::plan
    PgSelectSingle41 & Access48 --> PgCursor85
    PgClassExpression88{{"PgClassExpression[88∈5]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression88
    PgClassExpression90{{"PgClassExpression[90∈5]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression90
    PgClassExpression92{{"PgClassExpression[92∈5]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression92
    PgCursor87{{"PgCursor[87∈6]"}}:::plan
    PgSelectSingle43 & Access54 --> PgCursor87
    PgClassExpression89{{"PgClassExpression[89∈6]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression89
    PgClassExpression91{{"PgClassExpression[91∈6]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression91
    PgClassExpression93{{"PgClassExpression[93∈6]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression93

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access10,Access11,Object12,Connection13,Connection19,Lambda20,Constant94,Constant95 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect22,PgPageInfo23,PgSelect26,First27,PgSelectRows28,PgSelectSingle29,PgClassExpression30,PgSelectRows38,First45,PgSelectSingle47,Access48,PgCursor49,Last57,PgSelectSingle59,PgCursor61,Access69,Object70,Lambda71,Object78,Lambda79 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect24,PgPageInfo25,PgSelect31,First32,PgSelectRows33,PgSelectSingle34,PgClassExpression35,PgSelectRows39,First51,PgSelectSingle53,Access54,PgCursor55,Last63,PgSelectSingle65,PgCursor67,Access73,Object74,Lambda75,Object82,Lambda83 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item40,PgSelectSingle41 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item42,PgSelectSingle43 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor85,PgClassExpression88,PgClassExpression90,PgClassExpression92 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor87,PgClassExpression89,PgClassExpression91,PgClassExpression93 bucket6

