%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect59[["PgSelect[59∈0] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Connection56{{"Connection[56∈0] ➊<br />ᐸ54ᐳ"}}:::plan
    Lambda57{{"Lambda[57∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant95{{"Constant[95∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object12 -->|rejectNull| PgSelect59
    Connection56 & Lambda57 & Constant95 --> PgSelect59
    PgSelect15[["PgSelect[15∈0] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Connection13{{"Connection[13∈0] ➊<br />ᐸ9ᐳ"}}:::plan
    Object12 -->|rejectNull| PgSelect15
    Connection13 & Constant95 --> PgSelect15
    Object35{{"Object[35∈0] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access30{{"Access[30∈0] ➊<br />ᐸ15.hasMoreᐳ"}}:::plan
    Constant95 & Access30 --> Object35
    Constant95 & Lambda57 --> Connection56
    Object79{{"Object[79∈0] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access74{{"Access[74∈0] ➊<br />ᐸ59.hasMoreᐳ"}}:::plan
    Constant95 & Access74 --> Object79
    Constant95 --> Connection13
    Object31{{"Object[31∈0] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant95 & Access30 --> Object31
    Object75{{"Object[75∈0] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant95 & Access74 --> Object75
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    PgCursor22{{"PgCursor[22∈0] ➊"}}:::plan
    PgSelectSingle20{{"PgSelectSingle[20∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Access21{{"Access[21∈0] ➊<br />ᐸ15.cursorDetailsᐳ"}}:::plan
    PgSelectSingle20 & Access21 --> PgCursor22
    PgCursor28{{"PgCursor[28∈0] ➊"}}:::plan
    PgSelectSingle26{{"PgSelectSingle[26∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle26 & Access21 --> PgCursor28
    PgSelect37[["PgSelect[37∈0] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object12 -->|rejectNull| PgSelect37
    Connection13 --> PgSelect37
    PgCursor66{{"PgCursor[66∈0] ➊"}}:::plan
    PgSelectSingle64{{"PgSelectSingle[64∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Access65{{"Access[65∈0] ➊<br />ᐸ59.cursorDetailsᐳ"}}:::plan
    PgSelectSingle64 & Access65 --> PgCursor66
    PgCursor72{{"PgCursor[72∈0] ➊"}}:::plan
    PgSelectSingle70{{"PgSelectSingle[70∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle70 & Access65 --> PgCursor72
    PgSelect81[["PgSelect[81∈0] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object12 -->|rejectNull| PgSelect81
    Connection56 --> PgSelect81
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    PgPageInfo16{{"PgPageInfo[16∈0] ➊"}}:::plan
    Connection13 --> PgPageInfo16
    First18{{"First[18∈0] ➊"}}:::plan
    PgSelectRows19[["PgSelectRows[19∈0] ➊"]]:::plan
    PgSelectRows19 --> First18
    PgSelect15 --> PgSelectRows19
    First18 --> PgSelectSingle20
    PgSelect15 --> Access21
    Last24{{"Last[24∈0] ➊"}}:::plan
    PgSelectRows19 --> Last24
    Last24 --> PgSelectSingle26
    PgSelect15 --> Access30
    Lambda32{{"Lambda[32∈0] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object31 --> Lambda32
    Lambda36{{"Lambda[36∈0] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object35 --> Lambda36
    First38{{"First[38∈0] ➊"}}:::plan
    PgSelectRows39[["PgSelectRows[39∈0] ➊"]]:::plan
    PgSelectRows39 --> First38
    PgSelect37 --> PgSelectRows39
    PgSelectSingle40{{"PgSelectSingle[40∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First38 --> PgSelectSingle40
    PgClassExpression41{{"PgClassExpression[41∈0] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression41
    Constant96{{"Constant[96∈0] ➊<br />ᐸ'WyIzNjY0MzE3ZDgwIixmYWxzZSwyLDFd'ᐳ"}}:::plan
    Constant96 --> Lambda57
    PgPageInfo60{{"PgPageInfo[60∈0] ➊"}}:::plan
    Connection56 --> PgPageInfo60
    First62{{"First[62∈0] ➊"}}:::plan
    PgSelectRows63[["PgSelectRows[63∈0] ➊"]]:::plan
    PgSelectRows63 --> First62
    PgSelect59 --> PgSelectRows63
    First62 --> PgSelectSingle64
    PgSelect59 --> Access65
    Last68{{"Last[68∈0] ➊"}}:::plan
    PgSelectRows63 --> Last68
    Last68 --> PgSelectSingle70
    PgSelect59 --> Access74
    Lambda76{{"Lambda[76∈0] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object75 --> Lambda76
    Lambda80{{"Lambda[80∈0] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object79 --> Lambda80
    First82{{"First[82∈0] ➊"}}:::plan
    PgSelectRows83[["PgSelectRows[83∈0] ➊"]]:::plan
    PgSelectRows83 --> First82
    PgSelect81 --> PgSelectRows83
    PgSelectSingle84{{"PgSelectSingle[84∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First82 --> PgSelectSingle84
    PgClassExpression85{{"PgClassExpression[85∈0] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression85
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgCursor47{{"PgCursor[47∈1]"}}:::plan
    PgSelectSingle45{{"PgSelectSingle[45∈1]<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle45 & Access21 --> PgCursor47
    __Item44[/"__Item[44∈1]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelectRows19 ==> __Item44
    __Item44 --> PgSelectSingle45
    PgClassExpression48{{"PgClassExpression[48∈1]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression48
    PgClassExpression49{{"PgClassExpression[49∈1]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression49
    PgClassExpression50{{"PgClassExpression[50∈1]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression50
    PgCursor91{{"PgCursor[91∈2]"}}:::plan
    PgSelectSingle89{{"PgSelectSingle[89∈2]<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle89 & Access65 --> PgCursor91
    __Item88[/"__Item[88∈2]<br />ᐸ63ᐳ"\]:::itemplan
    PgSelectRows63 ==> __Item88
    __Item88 --> PgSelectSingle89
    PgClassExpression92{{"PgClassExpression[92∈2]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgSelectSingle89 --> PgClassExpression92
    PgClassExpression93{{"PgClassExpression[93∈2]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle89 --> PgClassExpression93
    PgClassExpression94{{"PgClassExpression[94∈2]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle89 --> PgClassExpression94

    %% define steps

    subgraph "Buckets for queries/v4/connections.boolean"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 10, 11, 95, 96, 12, 13, 16, 57, 56, 60<br />2: 15, 37, 59, 81<br />ᐳ: 21, 30, 31, 32, 35, 36, 65, 74, 75, 76, 79, 80<br />3: 19, 39, 63, 83<br />ᐳ: 18, 20, 22, 24, 26, 28, 38, 40, 41, 62, 64, 66, 68, 70, 72, 82, 84, 85"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access10,Access11,Object12,Connection13,PgSelect15,PgPageInfo16,First18,PgSelectRows19,PgSelectSingle20,Access21,PgCursor22,Last24,PgSelectSingle26,PgCursor28,Access30,Object31,Lambda32,Object35,Lambda36,PgSelect37,First38,PgSelectRows39,PgSelectSingle40,PgClassExpression41,Connection56,Lambda57,PgSelect59,PgPageInfo60,First62,PgSelectRows63,PgSelectSingle64,Access65,PgCursor66,Last68,PgSelectSingle70,PgCursor72,Access74,Object75,Lambda76,Object79,Lambda80,PgSelect81,First82,PgSelectRows83,PgSelectSingle84,PgClassExpression85,Constant95,Constant96 bucket0
    Bucket1("Bucket 1 (listItem)<br />Deps: 21<br /><br />ROOT __Item{1}ᐸ19ᐳ[44]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item44,PgSelectSingle45,PgCursor47,PgClassExpression48,PgClassExpression49,PgClassExpression50 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 65<br /><br />ROOT __Item{2}ᐸ63ᐳ[88]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item88,PgSelectSingle89,PgCursor91,PgClassExpression92,PgClassExpression93,PgClassExpression94 bucket2
    Bucket0 --> Bucket1 & Bucket2
    end
