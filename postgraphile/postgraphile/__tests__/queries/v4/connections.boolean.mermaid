%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection77{{"Connection[77∈0] ➊<br />ᐸ75ᐳ"}}:::plan
    Constant132{{"Constant[132∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Lambda78{{"Lambda[78∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor80["PgValidateParsedCursor[80∈0] ➊"]:::plan
    Constant132 & Lambda78 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 --> Connection77
    Object19{{"Object[19∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access17 & Access18 --> Object19
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access17
    __Value2 --> Access18
    Connection20{{"Connection[20∈0] ➊<br />ᐸ16ᐳ"}}:::plan
    Constant132 --> Connection20
    Constant134{{"Constant[134∈0] ➊<br />ᐸ'WyIzNjY0MzE3ZDgwIixmYWxzZSwyLDFd'ᐳ"}}:::plan
    Constant134 --> Lambda78
    Lambda78 --> PgValidateParsedCursor80
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Object48{{"Object[48∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access41{{"Access[41∈1] ➊<br />ᐸ21.hasMoreᐳ"}}:::plan
    Constant132 & Constant7 & Constant7 & Access41 --> Object48
    List30{{"List[30∈1] ➊<br />ᐸ27,28,29ᐳ"}}:::plan
    PgClassExpression27{{"PgClassExpression[27∈1] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression28{{"PgClassExpression[28∈1] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression29{{"PgClassExpression[29∈1] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression27 & PgClassExpression28 & PgClassExpression29 --> List30
    List38{{"List[38∈1] ➊<br />ᐸ35,36,37ᐳ"}}:::plan
    PgClassExpression35{{"PgClassExpression[35∈1] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression36{{"PgClassExpression[36∈1] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression37{{"PgClassExpression[37∈1] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression35 & PgClassExpression36 & PgClassExpression37 --> List38
    Object42{{"Object[42∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant132 & Constant7 & Access41 --> Object42
    PgSelect21[["PgSelect[21∈1] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Object19 & Connection20 --> PgSelect21
    PgSelect50[["PgSelect[50∈1] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object19 & Connection20 --> PgSelect50
    PgPageInfo22{{"PgPageInfo[22∈1] ➊"}}:::plan
    Connection20 --> PgPageInfo22
    First24{{"First[24∈1] ➊"}}:::plan
    PgSelect21 --> First24
    PgSelectSingle25{{"PgSelectSingle[25∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First24 --> PgSelectSingle25
    PgCursor26{{"PgCursor[26∈1] ➊"}}:::plan
    List30 --> PgCursor26
    PgSelectSingle25 --> PgClassExpression27
    PgSelectSingle25 --> PgClassExpression28
    PgSelectSingle25 --> PgClassExpression29
    Last32{{"Last[32∈1] ➊"}}:::plan
    PgSelect21 --> Last32
    PgSelectSingle33{{"PgSelectSingle[33∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Last32 --> PgSelectSingle33
    PgCursor34{{"PgCursor[34∈1] ➊"}}:::plan
    List38 --> PgCursor34
    PgSelectSingle33 --> PgClassExpression35
    PgSelectSingle33 --> PgClassExpression36
    PgSelectSingle33 --> PgClassExpression37
    PgSelect21 --> Access41
    Lambda43{{"Lambda[43∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object42 --> Lambda43
    Lambda49{{"Lambda[49∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object48 --> Lambda49
    First51{{"First[51∈1] ➊"}}:::plan
    PgSelect50 --> First51
    PgSelectSingle52{{"PgSelectSingle[52∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    __Item55[/"__Item[55∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgSelect21 ==> __Item55
    PgSelectSingle56{{"PgSelectSingle[56∈2]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item55 --> PgSelectSingle56
    List61{{"List[61∈3]<br />ᐸ58,59,60ᐳ"}}:::plan
    PgClassExpression58{{"PgClassExpression[58∈3]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression59{{"PgClassExpression[59∈3]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression60{{"PgClassExpression[60∈3]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression58 & PgClassExpression59 & PgClassExpression60 --> List61
    PgCursor57{{"PgCursor[57∈3]"}}:::plan
    List61 --> PgCursor57
    PgSelectSingle56 --> PgClassExpression58
    PgSelectSingle56 --> PgClassExpression59
    PgSelectSingle56 --> PgClassExpression60
    PgSelect79[["PgSelect[79∈4] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Access81{{"Access[81∈4] ➊<br />ᐸ78.1ᐳ"}}:::plan
    Access82{{"Access[82∈4] ➊<br />ᐸ78.2ᐳ"}}:::plan
    Access83{{"Access[83∈4] ➊<br />ᐸ78.3ᐳ"}}:::plan
    Object19 & Connection77 & Lambda78 & Access81 & Access82 & Access83 --> PgSelect79
    Object113{{"Object[113∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access105{{"Access[105∈4] ➊<br />ᐸ79.hasMoreᐳ"}}:::plan
    Constant132 & Constant7 & Constant7 & Access105 --> Object113
    List93{{"List[93∈4] ➊<br />ᐸ90,91,92ᐳ"}}:::plan
    PgClassExpression90{{"PgClassExpression[90∈4] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression91{{"PgClassExpression[91∈4] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression92{{"PgClassExpression[92∈4] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression90 & PgClassExpression91 & PgClassExpression92 --> List93
    List102{{"List[102∈4] ➊<br />ᐸ99,100,101ᐳ"}}:::plan
    PgClassExpression99{{"PgClassExpression[99∈4] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression100{{"PgClassExpression[100∈4] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression101{{"PgClassExpression[101∈4] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression99 & PgClassExpression100 & PgClassExpression101 --> List102
    Object106{{"Object[106∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant132 & Constant7 & Access105 --> Object106
    PgSelect116[["PgSelect[116∈4] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object19 & Connection77 --> PgSelect116
    Lambda78 --> Access81
    Lambda78 --> Access82
    Lambda78 --> Access83
    PgPageInfo84{{"PgPageInfo[84∈4] ➊"}}:::plan
    Connection77 --> PgPageInfo84
    First86{{"First[86∈4] ➊"}}:::plan
    PgSelect79 --> First86
    PgSelectSingle87{{"PgSelectSingle[87∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First86 --> PgSelectSingle87
    PgCursor88{{"PgCursor[88∈4] ➊"}}:::plan
    List93 --> PgCursor88
    PgSelectSingle87 --> PgClassExpression90
    PgSelectSingle87 --> PgClassExpression91
    PgSelectSingle87 --> PgClassExpression92
    Last95{{"Last[95∈4] ➊"}}:::plan
    PgSelect79 --> Last95
    PgSelectSingle96{{"PgSelectSingle[96∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Last95 --> PgSelectSingle96
    PgCursor97{{"PgCursor[97∈4] ➊"}}:::plan
    List102 --> PgCursor97
    PgSelectSingle96 --> PgClassExpression99
    PgSelectSingle96 --> PgClassExpression100
    PgSelectSingle96 --> PgClassExpression101
    PgSelect79 --> Access105
    Lambda107{{"Lambda[107∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object106 --> Lambda107
    Lambda114{{"Lambda[114∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object113 --> Lambda114
    First117{{"First[117∈4] ➊"}}:::plan
    PgSelect116 --> First117
    PgSelectSingle118{{"PgSelectSingle[118∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First117 --> PgSelectSingle118
    PgClassExpression119{{"PgClassExpression[119∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle118 --> PgClassExpression119
    __Item122[/"__Item[122∈5]<br />ᐸ79ᐳ"\]:::itemplan
    PgSelect79 ==> __Item122
    PgSelectSingle123{{"PgSelectSingle[123∈5]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item122 --> PgSelectSingle123
    List128{{"List[128∈6]<br />ᐸ125,126,127ᐳ"}}:::plan
    PgClassExpression125{{"PgClassExpression[125∈6]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression126{{"PgClassExpression[126∈6]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression127{{"PgClassExpression[127∈6]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression125 & PgClassExpression126 & PgClassExpression127 --> List128
    PgCursor124{{"PgCursor[124∈6]"}}:::plan
    List128 --> PgCursor124
    PgSelectSingle123 --> PgClassExpression125
    PgSelectSingle123 --> PgClassExpression126
    PgSelectSingle123 --> PgClassExpression127

    %% define steps

    subgraph "Buckets for queries/v4/connections.boolean"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 17, 18, 132, 134, 19, 20, 78<br />2: PgValidateParsedCursor[80]<br />ᐳ: Connection[77]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access17,Access18,Object19,Connection20,Connection77,Lambda78,PgValidateParsedCursor80,Constant132,Constant134 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 20, 132, 7<br /><br />ROOT Connectionᐸ16ᐳ[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect21,PgPageInfo22,First24,PgSelectSingle25,PgCursor26,PgClassExpression27,PgClassExpression28,PgClassExpression29,List30,Last32,PgSelectSingle33,PgCursor34,PgClassExpression35,PgClassExpression36,PgClassExpression37,List38,Access41,Object42,Lambda43,Object48,Lambda49,PgSelect50,First51,PgSelectSingle52,PgClassExpression53 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ21ᐳ[55]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item55,PgSelectSingle56 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 56<br /><br />ROOT PgSelectSingle{2}ᐸcompound_keyᐳ[56]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor57,PgClassExpression58,PgClassExpression59,PgClassExpression60,List61 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 19, 77, 78, 132, 7<br /><br />ROOT Connectionᐸ75ᐳ[77]<br />1: PgSelect[116]<br />ᐳ: 81, 82, 83, 84, 117, 118, 119<br />2: PgSelect[79]<br />ᐳ: 86, 87, 90, 91, 92, 93, 95, 96, 99, 100, 101, 102, 105, 106, 107, 113, 114, 88, 97"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect79,Access81,Access82,Access83,PgPageInfo84,First86,PgSelectSingle87,PgCursor88,PgClassExpression90,PgClassExpression91,PgClassExpression92,List93,Last95,PgSelectSingle96,PgCursor97,PgClassExpression99,PgClassExpression100,PgClassExpression101,List102,Access105,Object106,Lambda107,Object113,Lambda114,PgSelect116,First117,PgSelectSingle118,PgClassExpression119 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ79ᐳ[122]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item122,PgSelectSingle123 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 123<br /><br />ROOT PgSelectSingle{5}ᐸcompound_keyᐳ[123]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor124,PgClassExpression125,PgClassExpression126,PgClassExpression127,List128 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
