%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection63{{"Connection[63∈0] ➊<br />ᐸ61ᐳ"}}:::plan
    Constant103{{"Constant[103∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Lambda65{{"Lambda[65∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant103 & Constant7 & Constant7 & Lambda65 --> Connection63
    Connection16{{"Connection[16∈0] ➊<br />ᐸ12ᐳ"}}:::plan
    Constant103 & Constant7 & Constant7 --> Connection16
    Object15{{"Object[15∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access14{{"Access[14∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access13 & Access14 --> Object15
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access13
    __Value2 --> Access14
    Lambda17{{"Lambda[17∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant110{{"Constant[110∈0] ➊<br />ᐸ[ 'EXTRA_ASC', 'PERSON_ID_1_ASC', 'PERSON_ID_2_ASC' ]ᐳ"}}:::plan
    Constant110 --> Lambda17
    ApplyInput18{{"ApplyInput[18∈0] ➊"}}:::plan
    Constant7 --> ApplyInput18
    Constant108{{"Constant[108∈0] ➊<br />ᐸ'WyIzNjY0MzE3ZDgwIixmYWxzZSwyLDFd'ᐳ"}}:::plan
    Constant108 --> Lambda65
    ApplyInput66{{"ApplyInput[66∈0] ➊"}}:::plan
    Constant7 --> ApplyInput66
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect19[["PgSelect[19∈1] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Object15 & Lambda17 & ApplyInput18 & Connection16 & Constant103 & Constant7 & Constant7 --> PgSelect19
    Object39{{"Object[39∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access34{{"Access[34∈1] ➊<br />ᐸ19.hasMoreᐳ"}}:::plan
    Constant103 & Constant7 & Constant7 & Access34 --> Object39
    PgSelect41[["PgSelect[41∈1] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object15 & Lambda17 & ApplyInput18 & Connection16 --> PgSelect41
    Object35{{"Object[35∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant103 & Constant7 & Access34 --> Object35
    PgCursor26{{"PgCursor[26∈1] ➊"}}:::plan
    PgSelectSingle24{{"PgSelectSingle[24∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Access25{{"Access[25∈1] ➊<br />ᐸ19.cursorDetailsᐳ"}}:::plan
    PgSelectSingle24 & Access25 --> PgCursor26
    PgCursor32{{"PgCursor[32∈1] ➊"}}:::plan
    PgSelectSingle30{{"PgSelectSingle[30∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle30 & Access25 --> PgCursor32
    PgPageInfo20{{"PgPageInfo[20∈1] ➊"}}:::plan
    Connection16 --> PgPageInfo20
    First22{{"First[22∈1] ➊"}}:::plan
    PgSelectRows23[["PgSelectRows[23∈1] ➊"]]:::plan
    PgSelectRows23 --> First22
    PgSelect19 --> PgSelectRows23
    First22 --> PgSelectSingle24
    PgSelect19 --> Access25
    Last28{{"Last[28∈1] ➊"}}:::plan
    PgSelectRows23 --> Last28
    Last28 --> PgSelectSingle30
    PgSelect19 --> Access34
    Lambda36{{"Lambda[36∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object35 --> Lambda36
    Lambda40{{"Lambda[40∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object39 --> Lambda40
    First42{{"First[42∈1] ➊"}}:::plan
    PgSelectRows43[["PgSelectRows[43∈1] ➊"]]:::plan
    PgSelectRows43 --> First42
    PgSelect41 --> PgSelectRows43
    PgSelectSingle44{{"PgSelectSingle[44∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First42 --> PgSelectSingle44
    PgClassExpression45{{"PgClassExpression[45∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression45
    __Item48[/"__Item[48∈2]<br />ᐸ23ᐳ"\]:::itemplan
    PgSelectRows23 ==> __Item48
    PgSelectSingle49{{"PgSelectSingle[49∈2]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item48 --> PgSelectSingle49
    PgCursor51{{"PgCursor[51∈3]"}}:::plan
    PgSelectSingle49 & Access25 --> PgCursor51
    PgClassExpression52{{"PgClassExpression[52∈3]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression52
    PgClassExpression53{{"PgClassExpression[53∈3]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈3]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression54
    PgSelect67[["PgSelect[67∈4] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Object15 & Lambda17 & ApplyInput66 & Connection63 & Lambda65 & Constant103 & Constant7 & Constant7 --> PgSelect67
    Object87{{"Object[87∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access82{{"Access[82∈4] ➊<br />ᐸ67.hasMoreᐳ"}}:::plan
    Constant103 & Constant7 & Constant7 & Access82 --> Object87
    PgSelect89[["PgSelect[89∈4] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object15 & Lambda17 & ApplyInput66 & Connection63 --> PgSelect89
    Object83{{"Object[83∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant103 & Constant7 & Access82 --> Object83
    PgCursor74{{"PgCursor[74∈4] ➊"}}:::plan
    PgSelectSingle72{{"PgSelectSingle[72∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Access73{{"Access[73∈4] ➊<br />ᐸ67.cursorDetailsᐳ"}}:::plan
    PgSelectSingle72 & Access73 --> PgCursor74
    PgCursor80{{"PgCursor[80∈4] ➊"}}:::plan
    PgSelectSingle78{{"PgSelectSingle[78∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    PgSelectSingle78 & Access73 --> PgCursor80
    PgPageInfo68{{"PgPageInfo[68∈4] ➊"}}:::plan
    Connection63 --> PgPageInfo68
    First70{{"First[70∈4] ➊"}}:::plan
    PgSelectRows71[["PgSelectRows[71∈4] ➊"]]:::plan
    PgSelectRows71 --> First70
    PgSelect67 --> PgSelectRows71
    First70 --> PgSelectSingle72
    PgSelect67 --> Access73
    Last76{{"Last[76∈4] ➊"}}:::plan
    PgSelectRows71 --> Last76
    Last76 --> PgSelectSingle78
    PgSelect67 --> Access82
    Lambda84{{"Lambda[84∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object83 --> Lambda84
    Lambda88{{"Lambda[88∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object87 --> Lambda88
    First90{{"First[90∈4] ➊"}}:::plan
    PgSelectRows91[["PgSelectRows[91∈4] ➊"]]:::plan
    PgSelectRows91 --> First90
    PgSelect89 --> PgSelectRows91
    PgSelectSingle92{{"PgSelectSingle[92∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First90 --> PgSelectSingle92
    PgClassExpression93{{"PgClassExpression[93∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle92 --> PgClassExpression93
    __Item96[/"__Item[96∈5]<br />ᐸ71ᐳ"\]:::itemplan
    PgSelectRows71 ==> __Item96
    PgSelectSingle97{{"PgSelectSingle[97∈5]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item96 --> PgSelectSingle97
    PgCursor99{{"PgCursor[99∈6]"}}:::plan
    PgSelectSingle97 & Access73 --> PgCursor99
    PgClassExpression100{{"PgClassExpression[100∈6]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression100
    PgClassExpression101{{"PgClassExpression[101∈6]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression101
    PgClassExpression102{{"PgClassExpression[102∈6]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression102

    %% define steps

    subgraph "Buckets for queries/v4/connections.boolean"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access13,Access14,Object15,Connection16,Lambda17,ApplyInput18,Connection63,Lambda65,ApplyInput66,Constant103,Constant108,Constant110 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 15, 17, 18, 16, 103, 7<br /><br />ROOT Connectionᐸ12ᐳ[16]<br />1: PgSelect[19], PgSelect[41]<br />ᐳ: 20, 25, 34, 35, 36, 39, 40<br />2: PgSelectRows[23], PgSelectRows[43]<br />ᐳ: 22, 24, 26, 28, 30, 32, 42, 44, 45"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect19,PgPageInfo20,First22,PgSelectRows23,PgSelectSingle24,Access25,PgCursor26,Last28,PgSelectSingle30,PgCursor32,Access34,Object35,Lambda36,Object39,Lambda40,PgSelect41,First42,PgSelectRows43,PgSelectSingle44,PgClassExpression45 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 25<br /><br />ROOT __Item{2}ᐸ23ᐳ[48]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item48,PgSelectSingle49 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 49, 25<br /><br />ROOT PgSelectSingle{2}ᐸcompound_keyᐳ[49]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor51,PgClassExpression52,PgClassExpression53,PgClassExpression54 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 15, 17, 66, 63, 65, 103, 7<br /><br />ROOT Connectionᐸ61ᐳ[63]<br />1: PgSelect[67], PgSelect[89]<br />ᐳ: 68, 73, 82, 83, 84, 87, 88<br />2: PgSelectRows[71], PgSelectRows[91]<br />ᐳ: 70, 72, 74, 76, 78, 80, 90, 92, 93"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect67,PgPageInfo68,First70,PgSelectRows71,PgSelectSingle72,Access73,PgCursor74,Last76,PgSelectSingle78,PgCursor80,Access82,Object83,Lambda84,Object87,Lambda88,PgSelect89,First90,PgSelectRows91,PgSelectSingle92,PgClassExpression93 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 73<br /><br />ROOT __Item{5}ᐸ71ᐳ[96]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item96,PgSelectSingle97 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 97, 73<br /><br />ROOT PgSelectSingle{5}ᐸcompound_keyᐳ[97]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor99,PgClassExpression100,PgClassExpression101,PgClassExpression102 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
