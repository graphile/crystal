%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Lambda82{{"Lambda[82∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant180{{"Constant[180∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant180 --> Lambda82
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection13{{"Connection[13∈0] ➊<br />ᐸ9ᐳ"}}:::plan
    Connection60{{"Connection[60∈0] ➊<br />ᐸ58ᐳ"}}:::plan
    Constant80{{"Constant[80∈0] ➊<br />ᐸnullᐳ"}}:::plan
    Constant83{{"Constant[83∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    Constant86{{"Constant[86∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant87{{"Constant[87∈0] ➊<br />ᐸ{ s: Symbol(person), n: 'person', [Symbol(pg-sql2-type-1)]: ᐳ"}}:::plan
    Constant88{{"Constant[88∈0] ➊<br />ᐸ{ name: 'person', sqlType: { t: '”c”.”person”', [Symbol(pg-sᐳ"}}:::plan
    Constant102{{"Constant[102∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant103{{"Constant[103∈0] ➊<br />ᐸ{ s: Symbol(person_first_post), n: 'person_first_post', [Symᐳ"}}:::plan
    Constant104{{"Constant[104∈0] ➊<br />ᐸ{ name: 'post', sqlType: { t: '”a”.”post”', [Symbol(pg-sql2-ᐳ"}}:::plan
    Constant118{{"Constant[118∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant119{{"Constant[119∈0] ➊<br />ᐸ{ s: Symbol(person_friends), n: 'person_friends', [Symbol(pgᐳ"}}:::plan
    Constant137{{"Constant[137∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant154{{"Constant[154∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant155{{"Constant[155∈0] ➊<br />ᐸ{ s: Symbol(person), n: 'person', [Symbol(pg-sql2-type-1)]: ᐳ"}}:::plan
    Constant170{{"Constant[170∈0] ➊<br />ᐸ[ { codec: { name: 'int4', sqlType: [Object], fromPg: [Functᐳ"}}:::plan
    Constant171{{"Constant[171∈0] ➊<br />ᐸ{ s: Symbol(post), n: 'post', [Symbol(pg-sql2-type-1)]: 'IDEᐳ"}}:::plan
    Constant181{{"Constant[181∈0] ➊<br />ᐸ§{ cursorLower: null, cursorUpper: null, first: null, last: ᐳ"}}:::plan
    Constant182{{"Constant[182∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: { s: Symbol(person), nᐳ"}}:::plan
    Constant183{{"Constant[183∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: { s: Symbol(person_firᐳ"}}:::plan
    Constant184{{"Constant[184∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: { s: Symbol(person_friᐳ"}}:::plan
    Constant185{{"Constant[185∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: { s: Symbol(person_friᐳ"}}:::plan
    Constant186{{"Constant[186∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: { s: Symbol(person), nᐳ"}}:::plan
    Constant187{{"Constant[187∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: [Object], fragment: [Oᐳ"}}:::plan
    PgSelect14[["PgSelect[14∈1] ➊<br />ᐸpostᐳ"]]:::plan
    Object12{{"Object[12∈1] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Lambda85{{"Lambda[85∈1] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Lambda90{{"Lambda[90∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda95{{"Lambda[95∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda106{{"Lambda[106∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda111{{"Lambda[111∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda122{{"Lambda[122∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda127{{"Lambda[127∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda141{{"Lambda[141∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda146{{"Lambda[146∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda158{{"Lambda[158∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda163{{"Lambda[163∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda174{{"Lambda[174∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda179{{"Lambda[179∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object12 & Connection13 & Lambda85 & Lambda90 & Lambda95 & Lambda106 & Lambda111 & Lambda122 & Lambda127 & Lambda141 & Lambda146 & Lambda85 & Lambda158 & Lambda163 & Lambda82 & Lambda85 & Lambda174 & Lambda179 --> PgSelect14
    Object89{{"Object[89∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda82 & Constant86 & Constant87 & Constant88 --> Object89
    Object105{{"Object[105∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda82 & Constant102 & Constant103 & Constant104 --> Object105
    Object121{{"Object[121∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda82 & Constant118 & Constant119 & Constant88 --> Object121
    Object140{{"Object[140∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda82 & Constant137 & Constant119 & Constant88 --> Object140
    Object157{{"Object[157∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda82 & Constant154 & Constant155 & Constant88 --> Object157
    Object173{{"Object[173∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda82 & Constant170 & Constant171 & Constant104 --> Object173
    Access10{{"Access[10∈1] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈1] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    __Value2 --> Access10
    __Value2 --> Access11
    PgPageInfo73{{"PgPageInfo[73∈1] ➊"}}:::plan
    Connection60 --> PgPageInfo73
    Constant181 --> Lambda85
    Object89 --> Lambda90
    Constant182 --> Lambda95
    Object105 --> Lambda106
    Constant183 --> Lambda111
    Object121 --> Lambda122
    Constant184 --> Lambda127
    Object140 --> Lambda141
    Constant185 --> Lambda146
    Object157 --> Lambda158
    Constant186 --> Lambda163
    Object173 --> Lambda174
    Constant187 --> Lambda179
    __Item15[/"__Item[15∈2]<br />ᐸ14ᐳ"\]:::itemplan
    PgSelect14 ==> __Item15
    PgSelectSingle16{{"PgSelectSingle[16∈2]<br />ᐸpostᐳ"}}:::plan
    __Item15 --> PgSelectSingle16
    PgCursor17{{"PgCursor[17∈3]"}}:::plan
    List19{{"List[19∈3]<br />ᐸ18ᐳ"}}:::plan
    List19 --> PgCursor17
    PgClassExpression18{{"PgClassExpression[18∈3]<br />ᐸ__post__.”id”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression18
    PgClassExpression18 --> List19
    PgClassExpression21{{"PgClassExpression[21∈3]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression21
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ”a”.”post_...(__post__)ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression23
    PgSelectSingle30{{"PgSelectSingle[30∈3]<br />ᐸpersonᐳ"}}:::plan
    RemapKeys164{{"RemapKeys[164∈3]<br />ᐸ16:{”0”:3,”1”:4,”2”:5,”3”:6,”4”:7,”5”:8,”6”:9,”7”:10,”8”:11,”9”:12,”10”:13}ᐳ"}}:::plan
    RemapKeys164 --> PgSelectSingle30
    PgSelectSingle16 --> RemapKeys164
    Object131{{"Object[131∈4]<br />ᐸ{rows,first,last,shouldReverseOrder,fetchOneExtra}ᐳ"}}:::plan
    Access129{{"Access[129∈4]<br />ᐸ164.8ᐳ"}}:::plan
    Access129 & Constant80 & Constant80 & Lambda82 & Constant83 --> Object131
    Object148{{"Object[148∈4]<br />ᐸ{rows,first,last,shouldReverseOrder,fetchOneExtra}ᐳ"}}:::plan
    Access147{{"Access[147∈4]<br />ᐸ164.9ᐳ"}}:::plan
    Access147 & Constant80 & Constant80 & Lambda82 & Constant83 --> Object148
    PgClassExpression31{{"PgClassExpression[31∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression31
    PgClassExpression32{{"PgClassExpression[32∈4]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression32
    PgClassExpression34{{"PgClassExpression[34∈4]<br />ᐸ”c”.”perso..._person__)ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression34
    PgSelectSingle41{{"PgSelectSingle[41∈4]<br />ᐸperson_first_postᐳ"}}:::plan
    RemapKeys112{{"RemapKeys[112∈4]<br />ᐸ30:{”0”:2,”1”:3,”2”:4,”3”:5,”4”:6,”5”:7}ᐳ"}}:::plan
    RemapKeys112 --> PgSelectSingle41
    First69{{"First[69∈4]"}}:::plan
    Lambda149{{"Lambda[149∈4]<br />ᐸreverseIfNecessaryᐳ"}}:::plan
    Lambda149 --> First69
    PgSelectSingle70{{"PgSelectSingle[70∈4]<br />ᐸperson_friendsᐳ"}}:::plan
    First69 --> PgSelectSingle70
    PgClassExpression71{{"PgClassExpression[71∈4]<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression71
    First75{{"First[75∈4]"}}:::plan
    Lambda132{{"Lambda[132∈4]<br />ᐸreverseIfNecessaryᐳ"}}:::plan
    Lambda132 --> First75
    PgSelectSingle76{{"PgSelectSingle[76∈4]<br />ᐸperson_friendsᐳ"}}:::plan
    First75 --> PgSelectSingle76
    PgCursor77{{"PgCursor[77∈4]"}}:::plan
    List79{{"List[79∈4]<br />ᐸ78ᐳ"}}:::plan
    List79 --> PgCursor77
    PgClassExpression78{{"PgClassExpression[78∈4]<br />ᐸrow_number...tion by 1)ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression78
    PgClassExpression78 --> List79
    PgSelectSingle30 --> RemapKeys112
    RemapKeys164 --> Access129
    Object131 --> Lambda132
    RemapKeys164 --> Access147
    Object148 --> Lambda149
    PgClassExpression42{{"PgClassExpression[42∈5]<br />ᐸ__person_f...ost__.”id”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression42
    PgClassExpression43{{"PgClassExpression[43∈5]<br />ᐸ__person_f...”headline”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression43
    PgClassExpression45{{"PgClassExpression[45∈5]<br />ᐸ”a”.”post_...st_post__)ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression45
    PgSelectSingle52{{"PgSelectSingle[52∈5]<br />ᐸpersonᐳ"}}:::plan
    RemapKeys96{{"RemapKeys[96∈5]<br />ᐸ41:{”0”:3,”1”:4,”2”:5}ᐳ"}}:::plan
    RemapKeys96 --> PgSelectSingle52
    PgSelectSingle41 --> RemapKeys96
    PgClassExpression53{{"PgClassExpression[53∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression54
    PgClassExpression56{{"PgClassExpression[56∈6]<br />ᐸ”c”.”perso..._person__)ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression56
    __Item62[/"__Item[62∈7]<br />ᐸ132ᐳ"\]:::itemplan
    Lambda132 ==> __Item62
    PgSelectSingle63{{"PgSelectSingle[63∈7]<br />ᐸperson_friendsᐳ"}}:::plan
    __Item62 --> PgSelectSingle63
    PgClassExpression64{{"PgClassExpression[64∈8]<br />ᐸ__person_friends__.”id”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression64
    PgClassExpression65{{"PgClassExpression[65∈8]<br />ᐸ__person_f...full_name”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression65
    PgClassExpression67{{"PgClassExpression[67∈8]<br />ᐸ”c”.”perso...friends__)ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression67

    %% define steps

    subgraph "Buckets for queries/v4/posts"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Connection13,Connection60,Constant80,Lambda82,Constant83,Constant86,Constant87,Constant88,Constant102,Constant103,Constant104,Constant118,Constant119,Constant137,Constant154,Constant155,Constant170,Constant171,Constant180,Constant181,Constant182,Constant183,Constant184,Constant185,Constant186,Constant187 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 2, 13, 82, 60, 181, 86, 87, 88, 182, 102, 103, 104, 183, 118, 119, 184, 137, 185, 154, 155, 186, 170, 171, 187, 80, 83<br /><br />ROOT Connectionᐸ9ᐳ[13]<br />1: <br />ᐳ: 10, 11, 73, 85, 89, 95, 105, 111, 121, 127, 140, 146, 157, 163, 173, 179, 12, 90, 106, 122, 141, 158, 174<br />2: PgSelect[14]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,Access10,Access11,Object12,PgSelect14,PgPageInfo73,Lambda85,Object89,Lambda90,Lambda95,Object105,Lambda106,Lambda111,Object121,Lambda122,Lambda127,Object140,Lambda141,Lambda146,Object157,Lambda158,Lambda163,Object173,Lambda174,Lambda179 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 80, 82, 83, 60, 73<br /><br />ROOT __Item{2}ᐸ14ᐳ[15]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item15,PgSelectSingle16 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 16, 80, 82, 83, 60, 73<br /><br />ROOT PgSelectSingle{2}ᐸpostᐳ[16]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor17,PgClassExpression18,List19,PgClassExpression21,PgClassExpression23,PgSelectSingle30,RemapKeys164 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 30, 164, 80, 82, 83, 60, 73<br /><br />ROOT PgSelectSingle{3}ᐸpersonᐳ[30]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression31,PgClassExpression32,PgClassExpression34,PgSelectSingle41,First69,PgSelectSingle70,PgClassExpression71,First75,PgSelectSingle76,PgCursor77,PgClassExpression78,List79,RemapKeys112,Access129,Object131,Lambda132,Access147,Object148,Lambda149 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 41<br /><br />ROOT PgSelectSingle{4}ᐸperson_first_postᐳ[41]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression42,PgClassExpression43,PgClassExpression45,PgSelectSingle52,RemapKeys96 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 52<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[52]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgClassExpression53,PgClassExpression54,PgClassExpression56 bucket6
    Bucket7("Bucket 7 (listItem)<br /><br />ROOT __Item{7}ᐸ132ᐳ[62]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item62,PgSelectSingle63 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 63<br /><br />ROOT PgSelectSingle{7}ᐸperson_friendsᐳ[63]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression64,PgClassExpression65,PgClassExpression67 bucket8
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5 & Bucket7
    Bucket5 --> Bucket6
    Bucket7 --> Bucket8
    end
