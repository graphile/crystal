%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect36[["PgSelect[36∈0] ➊<br />ᐸmachineᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgClassExpression31{{"PgClassExpression[31∈0] ➊<br />ᐸ__building...nstructor”ᐳ"}}:::plan
    Connection34{{"Connection[34∈0] ➊<br />ᐸ32ᐳ"}}:::plan
    Object10 & PgClassExpression31 & Connection34 --> PgSelect36
    PgSelect49[["PgSelect[49∈0] ➊<br />ᐸrelational_itemsᐳ"]]:::plan
    Connection47{{"Connection[47∈0] ➊<br />ᐸ45ᐳ"}}:::plan
    Object10 -->|rejectNull| PgSelect49
    Connection47 --> PgSelect49
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸmachineᐳ"]]:::plan
    Constant70{{"Constant[70∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object10 & Constant70 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect15[["PgSelect[15∈0] ➊<br />ᐸbuildingᐳ"]]:::plan
    PgClassExpression14{{"PgClassExpression[14∈0] ➊<br />ᐸ__machine_...nstructor”ᐳ"}}:::plan
    Object10 & PgClassExpression14 --> PgSelect15
    PgSelect24[["PgSelect[24∈0] ➊<br />ᐸbuildingᐳ"]]:::plan
    Constant71{{"Constant[71∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Object10 & Constant71 --> PgSelect24
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    First11{{"First[11∈0] ➊"}}:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelectRows12 --> First11
    PgSelect7 --> PgSelectRows12
    PgSelectSingle13{{"PgSelectSingle[13∈0] ➊<br />ᐸmachineᐳ"}}:::plan
    First11 --> PgSelectSingle13
    PgSelectSingle13 --> PgClassExpression14
    First17{{"First[17∈0] ➊"}}:::plan
    PgSelectRows18[["PgSelectRows[18∈0] ➊"]]:::plan
    PgSelectRows18 --> First17
    PgSelect15 --> PgSelectRows18
    PgSelectSingle19{{"PgSelectSingle[19∈0] ➊<br />ᐸbuildingᐳ"}}:::plan
    First17 --> PgSelectSingle19
    PgClassExpression20{{"PgClassExpression[20∈0] ➊<br />ᐸ__building__.”id”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression20
    PgClassExpression21{{"PgClassExpression[21∈0] ➊<br />ᐸ__building...nstructor”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression21
    PgClassExpression22{{"PgClassExpression[22∈0] ➊<br />ᐸ__machine__.”input”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression22
    First26{{"First[26∈0] ➊"}}:::plan
    PgSelectRows27[["PgSelectRows[27∈0] ➊"]]:::plan
    PgSelectRows27 --> First26
    PgSelect24 --> PgSelectRows27
    PgSelectSingle28{{"PgSelectSingle[28∈0] ➊<br />ᐸbuildingᐳ"}}:::plan
    First26 --> PgSelectSingle28
    PgSelectSingle28 --> PgClassExpression31
    PgSelectRows37[["PgSelectRows[37∈0] ➊"]]:::plan
    PgSelect36 --> PgSelectRows37
    PgClassExpression43{{"PgClassExpression[43∈0] ➊<br />ᐸ__building__.”name”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression43
    PgSelectRows50[["PgSelectRows[50∈0] ➊"]]:::plan
    PgSelect49 --> PgSelectRows50
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    __Item38[/"__Item[38∈1]<br />ᐸ37ᐳ"\]:::itemplan
    PgSelectRows37 ==> __Item38
    PgSelectSingle39{{"PgSelectSingle[39∈1]<br />ᐸmachineᐳ"}}:::plan
    __Item38 --> PgSelectSingle39
    PgClassExpression40{{"PgClassExpression[40∈1]<br />ᐸ__machine__.”id”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression40
    PgClassExpression41{{"PgClassExpression[41∈1]<br />ᐸ__machine_...nstructor”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression41
    PgClassExpression42{{"PgClassExpression[42∈1]<br />ᐸ__machine__.”input”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression42
    __Item51[/"__Item[51∈2]<br />ᐸ50ᐳ"\]:::itemplan
    PgSelectRows50 ==> __Item51
    PgSelectSingle52{{"PgSelectSingle[52∈2]<br />ᐸrelational_itemsᐳ"}}:::plan
    __Item51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈2]<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    PgClassExpression61{{"PgClassExpression[61∈2]<br />ᐸ__relation...nstructor”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression61
    PgClassExpression62{{"PgClassExpression[62∈2]<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression62
    PgSelect54[["PgSelect[54∈3]<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopic"]]:::plan
    Object10 & PgClassExpression53 --> PgSelect54
    PgSelect64[["PgSelect[64∈3]<br />ᐸrelational_statusᐳ<br />ᐳRelationalStatus"]]:::plan
    Object10 & PgClassExpression53 --> PgSelect64
    First58{{"First[58∈3]"}}:::plan
    PgSelectRows59[["PgSelectRows[59∈3]"]]:::plan
    PgSelectRows59 --> First58
    PgSelect54 --> PgSelectRows59
    PgSelectSingle60{{"PgSelectSingle[60∈3]<br />ᐸrelational_topicsᐳ"}}:::plan
    First58 --> PgSelectSingle60
    PgClassExpression63{{"PgClassExpression[63∈3]<br />ᐸ__relation...__.”title”ᐳ"}}:::plan
    PgSelectSingle60 --> PgClassExpression63
    First66{{"First[66∈3]"}}:::plan
    PgSelectRows67[["PgSelectRows[67∈3]"]]:::plan
    PgSelectRows67 --> First66
    PgSelect64 --> PgSelectRows67
    PgSelectSingle68{{"PgSelectSingle[68∈3]<br />ᐸrelational_statusᐳ"}}:::plan
    First66 --> PgSelectSingle68
    PgClassExpression69{{"PgClassExpression[69∈3]<br />ᐸ__relation...s__.”note”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression69

    %% define steps

    subgraph "Buckets for queries/v4/js-reserved-keywords"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 29, 70, 71, 10, 34, 47<br />2: PgSelect[7], PgSelect[24], PgSelect[49]<br />3: 12, 27, 50<br />ᐳ: 11, 13, 14, 22, 26, 28, 31, 43<br />4: PgSelect[15], PgSelect[36]<br />5: PgSelectRows[18], PgSelectRows[37]<br />ᐳ: 17, 19, 20, 21"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,First11,PgSelectRows12,PgSelectSingle13,PgClassExpression14,PgSelect15,First17,PgSelectRows18,PgSelectSingle19,PgClassExpression20,PgClassExpression21,PgClassExpression22,PgSelect24,First26,PgSelectRows27,PgSelectSingle28,PgClassExpression31,Connection34,PgSelect36,PgSelectRows37,PgClassExpression43,Connection47,PgSelect49,PgSelectRows50,Constant70,Constant71 bucket0
    Bucket1("Bucket 1 (listItem)<br /><br />ROOT __Item{1}ᐸ37ᐳ[38]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item38,PgSelectSingle39,PgClassExpression40,PgClassExpression41,PgClassExpression42 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 10<br /><br />ROOT __Item{2}ᐸ50ᐳ[51]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item51,PgSelectSingle52,PgClassExpression53,PgClassExpression61,PgClassExpression62 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />RelationalTopic,RelationalStatus<br />Deps: 10, 53, 52, 61, 62<br />ᐳRelationalTopic<br />ᐳRelationalStatus<br /><br />1: PgSelect[54], PgSelect[64]<br />2: PgSelectRows[59], PgSelectRows[67]<br />ᐳ: 58, 60, 63, 66, 68, 69"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect54,First58,PgSelectRows59,PgSelectSingle60,PgClassExpression63,PgSelect64,First66,PgSelectRows67,PgSelectSingle68,PgClassExpression69 bucket3
    Bucket0 --> Bucket1 & Bucket2
    Bucket2 --> Bucket3
    end
