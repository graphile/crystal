%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access12
    __Value2 --> Access13
    Lambda16{{"Lambda[16∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant154{{"Constant[154∈0] ➊<br />ᐸ[ 'PRIMARY_KEY_ASC' ]ᐳ"}}:::plan
    Constant154 --> Lambda16
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant6{{"Constant[6∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Connection15{{"Connection[15∈0] ➊<br />ᐸ11ᐳ"}}:::plan
    Connection61{{"Connection[61∈0] ➊<br />ᐸ59ᐳ"}}:::plan
    Connection107{{"Connection[107∈0] ➊<br />ᐸ105ᐳ"}}:::plan
    Constant149{{"Constant[149∈0] ➊<br />ᐸ'192.168.0.0'ᐳ"}}:::plan
    Constant151{{"Constant[151∈0] ➊<br />ᐸ'192.168.0.0/16'ᐳ"}}:::plan
    Constant153{{"Constant[153∈0] ➊<br />ᐸ'08:00:2b:01:02:03'ᐳ"}}:::plan
    PgSelect17[["PgSelect[17∈1] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Object14 & Lambda16 & Constant149 & Connection15 --> PgSelect17
    Object38{{"Object[38∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access33{{"Access[33∈1] ➊<br />ᐸ17.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access33 --> Object38
    PgSelect40[["PgSelect[40∈1] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object14 & Lambda16 & Constant149 & Connection15 --> PgSelect40
    Object34{{"Object[34∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access33 --> Object34
    PgCursor24{{"PgCursor[24∈1] ➊"}}:::plan
    PgSelectSingle22{{"PgSelectSingle[22∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    Access23{{"Access[23∈1] ➊<br />ᐸ17.cursorDetailsᐳ"}}:::plan
    PgSelectSingle22 & Access23 --> PgCursor24
    PgCursor30{{"PgCursor[30∈1] ➊"}}:::plan
    PgSelectSingle28{{"PgSelectSingle[28∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    PgSelectSingle28 & Access23 --> PgCursor30
    PgPageInfo18{{"PgPageInfo[18∈1] ➊"}}:::plan
    Connection15 --> PgPageInfo18
    First20{{"First[20∈1] ➊"}}:::plan
    PgSelectRows21[["PgSelectRows[21∈1] ➊"]]:::plan
    PgSelectRows21 --> First20
    PgSelect17 --> PgSelectRows21
    First20 --> PgSelectSingle22
    PgSelect17 --> Access23
    Last26{{"Last[26∈1] ➊"}}:::plan
    PgSelectRows21 --> Last26
    Last26 --> PgSelectSingle28
    PgSelect17 --> Access33
    Lambda35{{"Lambda[35∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object34 --> Lambda35
    Lambda39{{"Lambda[39∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object38 --> Lambda39
    First41{{"First[41∈1] ➊"}}:::plan
    PgSelectRows42[["PgSelectRows[42∈1] ➊"]]:::plan
    PgSelectRows42 --> First41
    PgSelect40 --> PgSelectRows42
    PgSelectSingle43{{"PgSelectSingle[43∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    First41 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    __Item47[/"__Item[47∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgSelectRows21 ==> __Item47
    PgSelectSingle48{{"PgSelectSingle[48∈2]<br />ᐸnetworkᐳ"}}:::plan
    __Item47 --> PgSelectSingle48
    PgCursor50{{"PgCursor[50∈3]"}}:::plan
    PgSelectSingle48 & Access23 --> PgCursor50
    PgClassExpression51{{"PgClassExpression[51∈3]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression51
    PgClassExpression52{{"PgClassExpression[52∈3]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression52
    PgClassExpression53{{"PgClassExpression[53∈3]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈3]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression54
    PgSelect63[["PgSelect[63∈4] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Object14 & Lambda16 & Constant151 & Connection61 --> PgSelect63
    Object84{{"Object[84∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access79{{"Access[79∈4] ➊<br />ᐸ63.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access79 --> Object84
    PgSelect86[["PgSelect[86∈4] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object14 & Lambda16 & Constant151 & Connection61 --> PgSelect86
    Object80{{"Object[80∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access79 --> Object80
    PgCursor70{{"PgCursor[70∈4] ➊"}}:::plan
    PgSelectSingle68{{"PgSelectSingle[68∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    Access69{{"Access[69∈4] ➊<br />ᐸ63.cursorDetailsᐳ"}}:::plan
    PgSelectSingle68 & Access69 --> PgCursor70
    PgCursor76{{"PgCursor[76∈4] ➊"}}:::plan
    PgSelectSingle74{{"PgSelectSingle[74∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    PgSelectSingle74 & Access69 --> PgCursor76
    PgPageInfo64{{"PgPageInfo[64∈4] ➊"}}:::plan
    Connection61 --> PgPageInfo64
    First66{{"First[66∈4] ➊"}}:::plan
    PgSelectRows67[["PgSelectRows[67∈4] ➊"]]:::plan
    PgSelectRows67 --> First66
    PgSelect63 --> PgSelectRows67
    First66 --> PgSelectSingle68
    PgSelect63 --> Access69
    Last72{{"Last[72∈4] ➊"}}:::plan
    PgSelectRows67 --> Last72
    Last72 --> PgSelectSingle74
    PgSelect63 --> Access79
    Lambda81{{"Lambda[81∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object80 --> Lambda81
    Lambda85{{"Lambda[85∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object84 --> Lambda85
    First87{{"First[87∈4] ➊"}}:::plan
    PgSelectRows88[["PgSelectRows[88∈4] ➊"]]:::plan
    PgSelectRows88 --> First87
    PgSelect86 --> PgSelectRows88
    PgSelectSingle89{{"PgSelectSingle[89∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    First87 --> PgSelectSingle89
    PgClassExpression90{{"PgClassExpression[90∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle89 --> PgClassExpression90
    __Item93[/"__Item[93∈5]<br />ᐸ67ᐳ"\]:::itemplan
    PgSelectRows67 ==> __Item93
    PgSelectSingle94{{"PgSelectSingle[94∈5]<br />ᐸnetworkᐳ"}}:::plan
    __Item93 --> PgSelectSingle94
    PgCursor96{{"PgCursor[96∈6]"}}:::plan
    PgSelectSingle94 & Access69 --> PgCursor96
    PgClassExpression97{{"PgClassExpression[97∈6]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression97
    PgClassExpression98{{"PgClassExpression[98∈6]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression98
    PgClassExpression99{{"PgClassExpression[99∈6]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression99
    PgClassExpression100{{"PgClassExpression[100∈6]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression100
    PgSelect109[["PgSelect[109∈7] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Object14 & Lambda16 & Constant153 & Connection107 --> PgSelect109
    Object130{{"Object[130∈7] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access125{{"Access[125∈7] ➊<br />ᐸ109.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access125 --> Object130
    PgSelect132[["PgSelect[132∈7] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object14 & Lambda16 & Constant153 & Connection107 --> PgSelect132
    Object126{{"Object[126∈7] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access125 --> Object126
    PgCursor116{{"PgCursor[116∈7] ➊"}}:::plan
    PgSelectSingle114{{"PgSelectSingle[114∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    Access115{{"Access[115∈7] ➊<br />ᐸ109.cursorDetailsᐳ"}}:::plan
    PgSelectSingle114 & Access115 --> PgCursor116
    PgCursor122{{"PgCursor[122∈7] ➊"}}:::plan
    PgSelectSingle120{{"PgSelectSingle[120∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    PgSelectSingle120 & Access115 --> PgCursor122
    PgPageInfo110{{"PgPageInfo[110∈7] ➊"}}:::plan
    Connection107 --> PgPageInfo110
    First112{{"First[112∈7] ➊"}}:::plan
    PgSelectRows113[["PgSelectRows[113∈7] ➊"]]:::plan
    PgSelectRows113 --> First112
    PgSelect109 --> PgSelectRows113
    First112 --> PgSelectSingle114
    PgSelect109 --> Access115
    Last118{{"Last[118∈7] ➊"}}:::plan
    PgSelectRows113 --> Last118
    Last118 --> PgSelectSingle120
    PgSelect109 --> Access125
    Lambda127{{"Lambda[127∈7] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object126 --> Lambda127
    Lambda131{{"Lambda[131∈7] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object130 --> Lambda131
    First133{{"First[133∈7] ➊"}}:::plan
    PgSelectRows134[["PgSelectRows[134∈7] ➊"]]:::plan
    PgSelectRows134 --> First133
    PgSelect132 --> PgSelectRows134
    PgSelectSingle135{{"PgSelectSingle[135∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    First133 --> PgSelectSingle135
    PgClassExpression136{{"PgClassExpression[136∈7] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle135 --> PgClassExpression136
    __Item139[/"__Item[139∈8]<br />ᐸ113ᐳ"\]:::itemplan
    PgSelectRows113 ==> __Item139
    PgSelectSingle140{{"PgSelectSingle[140∈8]<br />ᐸnetworkᐳ"}}:::plan
    __Item139 --> PgSelectSingle140
    PgCursor142{{"PgCursor[142∈9]"}}:::plan
    PgSelectSingle140 & Access115 --> PgCursor142
    PgClassExpression143{{"PgClassExpression[143∈9]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression143
    PgClassExpression144{{"PgClassExpression[144∈9]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression144
    PgClassExpression145{{"PgClassExpression[145∈9]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression145
    PgClassExpression146{{"PgClassExpression[146∈9]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression146

    %% define steps

    subgraph "Buckets for queries/v4/network_types"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant6,Access12,Access13,Object14,Connection15,Lambda16,Connection61,Connection107,Constant149,Constant151,Constant153,Constant154 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 16, 149, 15, 6<br /><br />ROOT Connectionᐸ11ᐳ[15]<br />1: PgSelect[17], PgSelect[40]<br />ᐳ: 18, 23, 33, 34, 35, 38, 39<br />2: PgSelectRows[21], PgSelectRows[42]<br />ᐳ: 20, 22, 24, 26, 28, 30, 41, 43, 44"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect17,PgPageInfo18,First20,PgSelectRows21,PgSelectSingle22,Access23,PgCursor24,Last26,PgSelectSingle28,PgCursor30,Access33,Object34,Lambda35,Object38,Lambda39,PgSelect40,First41,PgSelectRows42,PgSelectSingle43,PgClassExpression44 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 23<br /><br />ROOT __Item{2}ᐸ21ᐳ[47]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item47,PgSelectSingle48 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 48, 23<br /><br />ROOT PgSelectSingle{2}ᐸnetworkᐳ[48]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor50,PgClassExpression51,PgClassExpression52,PgClassExpression53,PgClassExpression54 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 14, 16, 151, 61, 6<br /><br />ROOT Connectionᐸ59ᐳ[61]<br />1: PgSelect[63], PgSelect[86]<br />ᐳ: 64, 69, 79, 80, 81, 84, 85<br />2: PgSelectRows[67], PgSelectRows[88]<br />ᐳ: 66, 68, 70, 72, 74, 76, 87, 89, 90"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect63,PgPageInfo64,First66,PgSelectRows67,PgSelectSingle68,Access69,PgCursor70,Last72,PgSelectSingle74,PgCursor76,Access79,Object80,Lambda81,Object84,Lambda85,PgSelect86,First87,PgSelectRows88,PgSelectSingle89,PgClassExpression90 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 69<br /><br />ROOT __Item{5}ᐸ67ᐳ[93]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item93,PgSelectSingle94 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 94, 69<br /><br />ROOT PgSelectSingle{5}ᐸnetworkᐳ[94]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor96,PgClassExpression97,PgClassExpression98,PgClassExpression99,PgClassExpression100 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 14, 16, 153, 107, 6<br /><br />ROOT Connectionᐸ105ᐳ[107]<br />1: PgSelect[109], PgSelect[132]<br />ᐳ: 110, 115, 125, 126, 127, 130, 131<br />2: PgSelectRows[113], PgSelectRows[134]<br />ᐳ: 112, 114, 116, 118, 120, 122, 133, 135, 136"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgSelect109,PgPageInfo110,First112,PgSelectRows113,PgSelectSingle114,Access115,PgCursor116,Last118,PgSelectSingle120,PgCursor122,Access125,Object126,Lambda127,Object130,Lambda131,PgSelect132,First133,PgSelectRows134,PgSelectSingle135,PgClassExpression136 bucket7
    Bucket8("Bucket 8 (listItem)<br />Deps: 115<br /><br />ROOT __Item{8}ᐸ113ᐳ[139]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item139,PgSelectSingle140 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 140, 115<br /><br />ROOT PgSelectSingle{8}ᐸnetworkᐳ[140]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgCursor142,PgClassExpression143,PgClassExpression144,PgClassExpression145,PgClassExpression146 bucket9
    Bucket0 --> Bucket1 & Bucket4 & Bucket7
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    end
