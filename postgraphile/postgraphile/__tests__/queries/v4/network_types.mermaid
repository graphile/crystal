%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection15{{"Connection[15∈0] ➊<br />ᐸ11ᐳ"}}:::plan
    Constant6{{"Constant[6∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 --> Connection15
    Connection61{{"Connection[61∈0] ➊<br />ᐸ59ᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 --> Connection61
    Connection107{{"Connection[107∈0] ➊<br />ᐸ105ᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 --> Connection107
    __InputObject9{{"__InputObject[9∈0] ➊"}}:::plan
    Constant149{{"Constant[149∈0] ➊<br />ᐸ'192.168.0.0'ᐳ"}}:::plan
    Constant6 & Constant149 --> __InputObject9
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    __InputObject57{{"__InputObject[57∈0] ➊"}}:::plan
    Constant151{{"Constant[151∈0] ➊<br />ᐸ'192.168.0.0/16'ᐳ"}}:::plan
    Constant6 & Constant151 --> __InputObject57
    __InputObject103{{"__InputObject[103∈0] ➊"}}:::plan
    Constant153{{"Constant[153∈0] ➊<br />ᐸ'08:00:2b:01:02:03'ᐳ"}}:::plan
    Constant6 & Constant153 --> __InputObject103
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access12
    __Value2 --> Access13
    ApplyInput17{{"ApplyInput[17∈0] ➊"}}:::plan
    __InputObject9 --> ApplyInput17
    ApplyInput63{{"ApplyInput[63∈0] ➊"}}:::plan
    __InputObject57 --> ApplyInput63
    ApplyInput109{{"ApplyInput[109∈0] ➊"}}:::plan
    __InputObject103 --> ApplyInput109
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant155{{"Constant[155∈0] ➊<br />ᐸ[Function: applyInputConstant]ᐳ"}}:::plan
    PgSelect18[["PgSelect[18∈1] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Object14 & Constant155 & ApplyInput17 & Connection15 & Constant6 & Constant6 & Constant6 --> PgSelect18
    Object38{{"Object[38∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access33{{"Access[33∈1] ➊<br />ᐸ18.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access33 --> Object38
    PgSelect40[["PgSelect[40∈1] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object14 & Constant155 & ApplyInput17 & Connection15 --> PgSelect40
    Object34{{"Object[34∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access33 --> Object34
    PgCursor25{{"PgCursor[25∈1] ➊"}}:::plan
    PgSelectSingle23{{"PgSelectSingle[23∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    Access24{{"Access[24∈1] ➊<br />ᐸ18.cursorDetailsᐳ"}}:::plan
    PgSelectSingle23 & Access24 --> PgCursor25
    PgCursor31{{"PgCursor[31∈1] ➊"}}:::plan
    PgSelectSingle29{{"PgSelectSingle[29∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    PgSelectSingle29 & Access24 --> PgCursor31
    PgPageInfo19{{"PgPageInfo[19∈1] ➊"}}:::plan
    Connection15 --> PgPageInfo19
    First21{{"First[21∈1] ➊"}}:::plan
    PgSelectRows22[["PgSelectRows[22∈1] ➊"]]:::plan
    PgSelectRows22 --> First21
    PgSelect18 --> PgSelectRows22
    First21 --> PgSelectSingle23
    PgSelect18 --> Access24
    Last27{{"Last[27∈1] ➊"}}:::plan
    PgSelectRows22 --> Last27
    Last27 --> PgSelectSingle29
    PgSelect18 --> Access33
    Lambda35{{"Lambda[35∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object34 --> Lambda35
    Lambda39{{"Lambda[39∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object38 --> Lambda39
    First41{{"First[41∈1] ➊"}}:::plan
    PgSelectRows42[["PgSelectRows[42∈1] ➊"]]:::plan
    PgSelectRows42 --> First41
    PgSelect40 --> PgSelectRows42
    PgSelectSingle43{{"PgSelectSingle[43∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    First41 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    __Item47[/"__Item[47∈2]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelectRows22 ==> __Item47
    PgSelectSingle48{{"PgSelectSingle[48∈2]<br />ᐸnetworkᐳ"}}:::plan
    __Item47 --> PgSelectSingle48
    PgCursor50{{"PgCursor[50∈3]"}}:::plan
    PgSelectSingle48 & Access24 --> PgCursor50
    PgClassExpression51{{"PgClassExpression[51∈3]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression51
    PgClassExpression52{{"PgClassExpression[52∈3]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression52
    PgClassExpression53{{"PgClassExpression[53∈3]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈3]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression54
    PgSelect64[["PgSelect[64∈4] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Object14 & Constant155 & ApplyInput63 & Connection61 & Constant6 & Constant6 & Constant6 --> PgSelect64
    Object84{{"Object[84∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access79{{"Access[79∈4] ➊<br />ᐸ64.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access79 --> Object84
    PgSelect86[["PgSelect[86∈4] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object14 & Constant155 & ApplyInput63 & Connection61 --> PgSelect86
    Object80{{"Object[80∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access79 --> Object80
    PgCursor71{{"PgCursor[71∈4] ➊"}}:::plan
    PgSelectSingle69{{"PgSelectSingle[69∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    Access70{{"Access[70∈4] ➊<br />ᐸ64.cursorDetailsᐳ"}}:::plan
    PgSelectSingle69 & Access70 --> PgCursor71
    PgCursor77{{"PgCursor[77∈4] ➊"}}:::plan
    PgSelectSingle75{{"PgSelectSingle[75∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    PgSelectSingle75 & Access70 --> PgCursor77
    PgPageInfo65{{"PgPageInfo[65∈4] ➊"}}:::plan
    Connection61 --> PgPageInfo65
    First67{{"First[67∈4] ➊"}}:::plan
    PgSelectRows68[["PgSelectRows[68∈4] ➊"]]:::plan
    PgSelectRows68 --> First67
    PgSelect64 --> PgSelectRows68
    First67 --> PgSelectSingle69
    PgSelect64 --> Access70
    Last73{{"Last[73∈4] ➊"}}:::plan
    PgSelectRows68 --> Last73
    Last73 --> PgSelectSingle75
    PgSelect64 --> Access79
    Lambda81{{"Lambda[81∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object80 --> Lambda81
    Lambda85{{"Lambda[85∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object84 --> Lambda85
    First87{{"First[87∈4] ➊"}}:::plan
    PgSelectRows88[["PgSelectRows[88∈4] ➊"]]:::plan
    PgSelectRows88 --> First87
    PgSelect86 --> PgSelectRows88
    PgSelectSingle89{{"PgSelectSingle[89∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    First87 --> PgSelectSingle89
    PgClassExpression90{{"PgClassExpression[90∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle89 --> PgClassExpression90
    __Item93[/"__Item[93∈5]<br />ᐸ68ᐳ"\]:::itemplan
    PgSelectRows68 ==> __Item93
    PgSelectSingle94{{"PgSelectSingle[94∈5]<br />ᐸnetworkᐳ"}}:::plan
    __Item93 --> PgSelectSingle94
    PgCursor96{{"PgCursor[96∈6]"}}:::plan
    PgSelectSingle94 & Access70 --> PgCursor96
    PgClassExpression97{{"PgClassExpression[97∈6]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression97
    PgClassExpression98{{"PgClassExpression[98∈6]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression98
    PgClassExpression99{{"PgClassExpression[99∈6]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression99
    PgClassExpression100{{"PgClassExpression[100∈6]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression100
    PgSelect110[["PgSelect[110∈7] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Object14 & Constant155 & ApplyInput109 & Connection107 & Constant6 & Constant6 & Constant6 --> PgSelect110
    Object130{{"Object[130∈7] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access125{{"Access[125∈7] ➊<br />ᐸ110.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access125 --> Object130
    PgSelect132[["PgSelect[132∈7] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object14 & Constant155 & ApplyInput109 & Connection107 --> PgSelect132
    Object126{{"Object[126∈7] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access125 --> Object126
    PgCursor117{{"PgCursor[117∈7] ➊"}}:::plan
    PgSelectSingle115{{"PgSelectSingle[115∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    Access116{{"Access[116∈7] ➊<br />ᐸ110.cursorDetailsᐳ"}}:::plan
    PgSelectSingle115 & Access116 --> PgCursor117
    PgCursor123{{"PgCursor[123∈7] ➊"}}:::plan
    PgSelectSingle121{{"PgSelectSingle[121∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    PgSelectSingle121 & Access116 --> PgCursor123
    PgPageInfo111{{"PgPageInfo[111∈7] ➊"}}:::plan
    Connection107 --> PgPageInfo111
    First113{{"First[113∈7] ➊"}}:::plan
    PgSelectRows114[["PgSelectRows[114∈7] ➊"]]:::plan
    PgSelectRows114 --> First113
    PgSelect110 --> PgSelectRows114
    First113 --> PgSelectSingle115
    PgSelect110 --> Access116
    Last119{{"Last[119∈7] ➊"}}:::plan
    PgSelectRows114 --> Last119
    Last119 --> PgSelectSingle121
    PgSelect110 --> Access125
    Lambda127{{"Lambda[127∈7] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object126 --> Lambda127
    Lambda131{{"Lambda[131∈7] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object130 --> Lambda131
    First133{{"First[133∈7] ➊"}}:::plan
    PgSelectRows134[["PgSelectRows[134∈7] ➊"]]:::plan
    PgSelectRows134 --> First133
    PgSelect132 --> PgSelectRows134
    PgSelectSingle135{{"PgSelectSingle[135∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    First133 --> PgSelectSingle135
    PgClassExpression136{{"PgClassExpression[136∈7] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle135 --> PgClassExpression136
    __Item139[/"__Item[139∈8]<br />ᐸ114ᐳ"\]:::itemplan
    PgSelectRows114 ==> __Item139
    PgSelectSingle140{{"PgSelectSingle[140∈8]<br />ᐸnetworkᐳ"}}:::plan
    __Item139 --> PgSelectSingle140
    PgCursor142{{"PgCursor[142∈9]"}}:::plan
    PgSelectSingle140 & Access116 --> PgCursor142
    PgClassExpression143{{"PgClassExpression[143∈9]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression143
    PgClassExpression144{{"PgClassExpression[144∈9]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression144
    PgClassExpression145{{"PgClassExpression[145∈9]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression145
    PgClassExpression146{{"PgClassExpression[146∈9]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle140 --> PgClassExpression146

    %% define steps

    subgraph "Buckets for queries/v4/network_types"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant6,__InputObject9,Access12,Access13,Object14,Connection15,ApplyInput17,__InputObject57,Connection61,ApplyInput63,__InputObject103,Connection107,ApplyInput109,Constant149,Constant151,Constant153,Constant155 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 155, 17, 15, 6<br /><br />ROOT Connectionᐸ11ᐳ[15]<br />1: PgSelect[18], PgSelect[40]<br />ᐳ: 19, 24, 33, 34, 35, 38, 39<br />2: PgSelectRows[22], PgSelectRows[42]<br />ᐳ: 21, 23, 25, 27, 29, 31, 41, 43, 44"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect18,PgPageInfo19,First21,PgSelectRows22,PgSelectSingle23,Access24,PgCursor25,Last27,PgSelectSingle29,PgCursor31,Access33,Object34,Lambda35,Object38,Lambda39,PgSelect40,First41,PgSelectRows42,PgSelectSingle43,PgClassExpression44 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 24<br /><br />ROOT __Item{2}ᐸ22ᐳ[47]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item47,PgSelectSingle48 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 48, 24<br /><br />ROOT PgSelectSingle{2}ᐸnetworkᐳ[48]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor50,PgClassExpression51,PgClassExpression52,PgClassExpression53,PgClassExpression54 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 14, 155, 63, 61, 6<br /><br />ROOT Connectionᐸ59ᐳ[61]<br />1: PgSelect[64], PgSelect[86]<br />ᐳ: 65, 70, 79, 80, 81, 84, 85<br />2: PgSelectRows[68], PgSelectRows[88]<br />ᐳ: 67, 69, 71, 73, 75, 77, 87, 89, 90"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect64,PgPageInfo65,First67,PgSelectRows68,PgSelectSingle69,Access70,PgCursor71,Last73,PgSelectSingle75,PgCursor77,Access79,Object80,Lambda81,Object84,Lambda85,PgSelect86,First87,PgSelectRows88,PgSelectSingle89,PgClassExpression90 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 70<br /><br />ROOT __Item{5}ᐸ68ᐳ[93]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item93,PgSelectSingle94 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 94, 70<br /><br />ROOT PgSelectSingle{5}ᐸnetworkᐳ[94]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor96,PgClassExpression97,PgClassExpression98,PgClassExpression99,PgClassExpression100 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 14, 155, 109, 107, 6<br /><br />ROOT Connectionᐸ105ᐳ[107]<br />1: PgSelect[110], PgSelect[132]<br />ᐳ: 111, 116, 125, 126, 127, 130, 131<br />2: PgSelectRows[114], PgSelectRows[134]<br />ᐳ: 113, 115, 117, 119, 121, 123, 133, 135, 136"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgSelect110,PgPageInfo111,First113,PgSelectRows114,PgSelectSingle115,Access116,PgCursor117,Last119,PgSelectSingle121,PgCursor123,Access125,Object126,Lambda127,Object130,Lambda131,PgSelect132,First133,PgSelectRows134,PgSelectSingle135,PgClassExpression136 bucket7
    Bucket8("Bucket 8 (listItem)<br />Deps: 116<br /><br />ROOT __Item{8}ᐸ114ᐳ[139]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item139,PgSelectSingle140 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 140, 116<br /><br />ROOT PgSelectSingle{8}ᐸnetworkᐳ[140]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgCursor142,PgClassExpression143,PgClassExpression144,PgClassExpression145,PgClassExpression146 bucket9
    Bucket0 --> Bucket1 & Bucket4 & Bucket7
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    end
