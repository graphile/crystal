%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object21{{"Object[21∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access19{{"Access[19∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access20{{"Access[20∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access19 & Access20 --> Object21
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access19
    __Value2 --> Access20
    Lambda183{{"Lambda[183∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant227{{"Constant[227∈0] ➊<br />ᐸ[Object: null prototype] {   cursorLower: null,   cursorUppeᐳ"}}:::plan
    Constant227 --> Lambda183
    Lambda191{{"Lambda[191∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant228{{"Constant[228∈0] ➊<br />ᐸ[Object: null prototype] {   cursorLower: null,   cursorUppeᐳ"}}:::plan
    Constant228 --> Lambda191
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant6{{"Constant[6∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Connection22{{"Connection[22∈0] ➊<br />ᐸ18ᐳ"}}:::plan
    Connection78{{"Connection[78∈0] ➊<br />ᐸ76ᐳ"}}:::plan
    Connection134{{"Connection[134∈0] ➊<br />ᐸ132ᐳ"}}:::plan
    PgSelect23[["PgSelect[23∈1] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Constant224{{"Constant[224∈1] ➊<br />ᐸ'192.168.0.0'ᐳ"}}:::plan
    Object21 & Constant224 & Connection22 & Lambda183 --> PgSelect23
    Object48{{"Object[48∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access40{{"Access[40∈1] ➊<br />ᐸ23.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access40 --> Object48
    PgSelect50[["PgSelect[50∈1] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object21 & Constant224 & Connection22 & Lambda191 --> PgSelect50
    Object41{{"Object[41∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access40 --> Object41
    PgPageInfo24{{"PgPageInfo[24∈1] ➊"}}:::plan
    Connection22 --> PgPageInfo24
    First26{{"First[26∈1] ➊"}}:::plan
    PgSelect23 --> First26
    PgSelectSingle27{{"PgSelectSingle[27∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    First26 --> PgSelectSingle27
    PgCursor28{{"PgCursor[28∈1] ➊"}}:::plan
    List30{{"List[30∈1] ➊<br />ᐸ29ᐳ"}}:::plan
    List30 --> PgCursor28
    PgClassExpression29{{"PgClassExpression[29∈1] ➊<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle27 --> PgClassExpression29
    PgClassExpression29 --> List30
    Last32{{"Last[32∈1] ➊"}}:::plan
    PgSelect23 --> Last32
    PgSelectSingle33{{"PgSelectSingle[33∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    Last32 --> PgSelectSingle33
    PgCursor34{{"PgCursor[34∈1] ➊"}}:::plan
    List36{{"List[36∈1] ➊<br />ᐸ35ᐳ"}}:::plan
    List36 --> PgCursor34
    PgClassExpression35{{"PgClassExpression[35∈1] ➊<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression35
    PgClassExpression35 --> List36
    PgSelect23 --> Access40
    Lambda42{{"Lambda[42∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object41 --> Lambda42
    Lambda49{{"Lambda[49∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object48 --> Lambda49
    First51{{"First[51∈1] ➊"}}:::plan
    PgSelect50 --> First51
    PgSelectSingle52{{"PgSelectSingle[52∈1] ➊<br />ᐸnetworkᐳ"}}:::plan
    First51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    __Item55[/"__Item[55∈2]<br />ᐸ23ᐳ"\]:::itemplan
    PgSelect23 ==> __Item55
    PgSelectSingle56{{"PgSelectSingle[56∈2]<br />ᐸnetworkᐳ"}}:::plan
    __Item55 --> PgSelectSingle56
    PgCursor57{{"PgCursor[57∈3]"}}:::plan
    List59{{"List[59∈3]<br />ᐸ58ᐳ"}}:::plan
    List59 --> PgCursor57
    PgClassExpression58{{"PgClassExpression[58∈3]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression58
    PgClassExpression58 --> List59
    PgClassExpression61{{"PgClassExpression[61∈3]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression61
    PgClassExpression62{{"PgClassExpression[62∈3]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈3]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression63
    PgSelect79[["PgSelect[79∈4] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Constant225{{"Constant[225∈4] ➊<br />ᐸ'192.168.0.0/16'ᐳ"}}:::plan
    Object21 & Constant225 & Connection78 & Lambda183 --> PgSelect79
    Object104{{"Object[104∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access96{{"Access[96∈4] ➊<br />ᐸ79.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access96 --> Object104
    PgSelect106[["PgSelect[106∈4] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object21 & Constant225 & Connection78 & Lambda191 --> PgSelect106
    Object97{{"Object[97∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access96 --> Object97
    PgPageInfo80{{"PgPageInfo[80∈4] ➊"}}:::plan
    Connection78 --> PgPageInfo80
    First82{{"First[82∈4] ➊"}}:::plan
    PgSelect79 --> First82
    PgSelectSingle83{{"PgSelectSingle[83∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    First82 --> PgSelectSingle83
    PgCursor84{{"PgCursor[84∈4] ➊"}}:::plan
    List86{{"List[86∈4] ➊<br />ᐸ85ᐳ"}}:::plan
    List86 --> PgCursor84
    PgClassExpression85{{"PgClassExpression[85∈4] ➊<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression85
    PgClassExpression85 --> List86
    Last88{{"Last[88∈4] ➊"}}:::plan
    PgSelect79 --> Last88
    PgSelectSingle89{{"PgSelectSingle[89∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    Last88 --> PgSelectSingle89
    PgCursor90{{"PgCursor[90∈4] ➊"}}:::plan
    List92{{"List[92∈4] ➊<br />ᐸ91ᐳ"}}:::plan
    List92 --> PgCursor90
    PgClassExpression91{{"PgClassExpression[91∈4] ➊<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle89 --> PgClassExpression91
    PgClassExpression91 --> List92
    PgSelect79 --> Access96
    Lambda98{{"Lambda[98∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object97 --> Lambda98
    Lambda105{{"Lambda[105∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object104 --> Lambda105
    First107{{"First[107∈4] ➊"}}:::plan
    PgSelect106 --> First107
    PgSelectSingle108{{"PgSelectSingle[108∈4] ➊<br />ᐸnetworkᐳ"}}:::plan
    First107 --> PgSelectSingle108
    PgClassExpression109{{"PgClassExpression[109∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle108 --> PgClassExpression109
    __Item111[/"__Item[111∈5]<br />ᐸ79ᐳ"\]:::itemplan
    PgSelect79 ==> __Item111
    PgSelectSingle112{{"PgSelectSingle[112∈5]<br />ᐸnetworkᐳ"}}:::plan
    __Item111 --> PgSelectSingle112
    PgCursor113{{"PgCursor[113∈6]"}}:::plan
    List115{{"List[115∈6]<br />ᐸ114ᐳ"}}:::plan
    List115 --> PgCursor113
    PgClassExpression114{{"PgClassExpression[114∈6]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression114
    PgClassExpression114 --> List115
    PgClassExpression117{{"PgClassExpression[117∈6]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression117
    PgClassExpression118{{"PgClassExpression[118∈6]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression118
    PgClassExpression119{{"PgClassExpression[119∈6]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression119
    PgSelect135[["PgSelect[135∈7] ➊<br />ᐸnetwork+1ᐳ"]]:::plan
    Constant226{{"Constant[226∈7] ➊<br />ᐸ'08:00:2b:01:02:03'ᐳ"}}:::plan
    Object21 & Constant226 & Connection134 & Lambda183 --> PgSelect135
    Object160{{"Object[160∈7] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access152{{"Access[152∈7] ➊<br />ᐸ135.hasMoreᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 & Access152 --> Object160
    PgSelect162[["PgSelect[162∈7] ➊<br />ᐸnetwork(aggregate)ᐳ"]]:::plan
    Object21 & Constant226 & Connection134 & Lambda191 --> PgSelect162
    Object153{{"Object[153∈7] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant6 & Constant6 & Access152 --> Object153
    PgPageInfo136{{"PgPageInfo[136∈7] ➊"}}:::plan
    Connection134 --> PgPageInfo136
    First138{{"First[138∈7] ➊"}}:::plan
    PgSelect135 --> First138
    PgSelectSingle139{{"PgSelectSingle[139∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    First138 --> PgSelectSingle139
    PgCursor140{{"PgCursor[140∈7] ➊"}}:::plan
    List142{{"List[142∈7] ➊<br />ᐸ141ᐳ"}}:::plan
    List142 --> PgCursor140
    PgClassExpression141{{"PgClassExpression[141∈7] ➊<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle139 --> PgClassExpression141
    PgClassExpression141 --> List142
    Last144{{"Last[144∈7] ➊"}}:::plan
    PgSelect135 --> Last144
    PgSelectSingle145{{"PgSelectSingle[145∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    Last144 --> PgSelectSingle145
    PgCursor146{{"PgCursor[146∈7] ➊"}}:::plan
    List148{{"List[148∈7] ➊<br />ᐸ147ᐳ"}}:::plan
    List148 --> PgCursor146
    PgClassExpression147{{"PgClassExpression[147∈7] ➊<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle145 --> PgClassExpression147
    PgClassExpression147 --> List148
    PgSelect135 --> Access152
    Lambda154{{"Lambda[154∈7] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object153 --> Lambda154
    Lambda161{{"Lambda[161∈7] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object160 --> Lambda161
    First163{{"First[163∈7] ➊"}}:::plan
    PgSelect162 --> First163
    PgSelectSingle164{{"PgSelectSingle[164∈7] ➊<br />ᐸnetworkᐳ"}}:::plan
    First163 --> PgSelectSingle164
    PgClassExpression165{{"PgClassExpression[165∈7] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle164 --> PgClassExpression165
    __Item167[/"__Item[167∈8]<br />ᐸ135ᐳ"\]:::itemplan
    PgSelect135 ==> __Item167
    PgSelectSingle168{{"PgSelectSingle[168∈8]<br />ᐸnetworkᐳ"}}:::plan
    __Item167 --> PgSelectSingle168
    PgCursor169{{"PgCursor[169∈9]"}}:::plan
    List171{{"List[171∈9]<br />ᐸ170ᐳ"}}:::plan
    List171 --> PgCursor169
    PgClassExpression170{{"PgClassExpression[170∈9]<br />ᐸ__network__.”id”ᐳ"}}:::plan
    PgSelectSingle168 --> PgClassExpression170
    PgClassExpression170 --> List171
    PgClassExpression173{{"PgClassExpression[173∈9]<br />ᐸ__network__.”inet”ᐳ"}}:::plan
    PgSelectSingle168 --> PgClassExpression173
    PgClassExpression174{{"PgClassExpression[174∈9]<br />ᐸ__network__.”cidr”ᐳ"}}:::plan
    PgSelectSingle168 --> PgClassExpression174
    PgClassExpression175{{"PgClassExpression[175∈9]<br />ᐸ__network__.”macaddr”ᐳ"}}:::plan
    PgSelectSingle168 --> PgClassExpression175

    %% define steps

    subgraph "Buckets for queries/v4/network_types"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant6,Access19,Access20,Object21,Connection22,Connection78,Connection134,Lambda183,Lambda191,Constant227,Constant228 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 21, 22, 183, 6, 191<br /><br />ROOT Connectionᐸ18ᐳ[22]<br />1: <br />ᐳ: PgPageInfo[24], Constant[224]<br />2: PgSelect[23], PgSelect[50]<br />ᐳ: 26, 27, 29, 30, 32, 33, 35, 36, 40, 41, 42, 48, 49, 51, 52, 53, 28, 34"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect23,PgPageInfo24,First26,PgSelectSingle27,PgCursor28,PgClassExpression29,List30,Last32,PgSelectSingle33,PgCursor34,PgClassExpression35,List36,Access40,Object41,Lambda42,Object48,Lambda49,PgSelect50,First51,PgSelectSingle52,PgClassExpression53,Constant224 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ23ᐳ[55]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item55,PgSelectSingle56 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 56<br /><br />ROOT PgSelectSingle{2}ᐸnetworkᐳ[56]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor57,PgClassExpression58,List59,PgClassExpression61,PgClassExpression62,PgClassExpression63 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 21, 78, 183, 6, 191<br /><br />ROOT Connectionᐸ76ᐳ[78]<br />1: <br />ᐳ: PgPageInfo[80], Constant[225]<br />2: PgSelect[79], PgSelect[106]<br />ᐳ: 82, 83, 85, 86, 88, 89, 91, 92, 96, 97, 98, 104, 105, 107, 108, 109, 84, 90"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect79,PgPageInfo80,First82,PgSelectSingle83,PgCursor84,PgClassExpression85,List86,Last88,PgSelectSingle89,PgCursor90,PgClassExpression91,List92,Access96,Object97,Lambda98,Object104,Lambda105,PgSelect106,First107,PgSelectSingle108,PgClassExpression109,Constant225 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ79ᐳ[111]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item111,PgSelectSingle112 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 112<br /><br />ROOT PgSelectSingle{5}ᐸnetworkᐳ[112]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor113,PgClassExpression114,List115,PgClassExpression117,PgClassExpression118,PgClassExpression119 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 21, 134, 183, 6, 191<br /><br />ROOT Connectionᐸ132ᐳ[134]<br />1: <br />ᐳ: PgPageInfo[136], Constant[226]<br />2: PgSelect[135], PgSelect[162]<br />ᐳ: 138, 139, 141, 142, 144, 145, 147, 148, 152, 153, 154, 160, 161, 163, 164, 165, 140, 146"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgSelect135,PgPageInfo136,First138,PgSelectSingle139,PgCursor140,PgClassExpression141,List142,Last144,PgSelectSingle145,PgCursor146,PgClassExpression147,List148,Access152,Object153,Lambda154,Object160,Lambda161,PgSelect162,First163,PgSelectSingle164,PgClassExpression165,Constant226 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ135ᐳ[167]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item167,PgSelectSingle168 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 168<br /><br />ROOT PgSelectSingle{8}ᐸnetworkᐳ[168]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgCursor169,PgClassExpression170,List171,PgClassExpression173,PgClassExpression174,PgClassExpression175 bucket9
    Bucket0 --> Bucket1 & Bucket4 & Bucket7
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    end
