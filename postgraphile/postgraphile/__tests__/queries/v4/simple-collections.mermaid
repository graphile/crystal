%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect63[["PgSelect[63∈0] ➊<br />ᐸpostᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Lambda54{{"Lambda[54∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant126{{"Constant[126∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Object10 & Lambda54 & Constant126 & Constant126 --> PgSelect63
    PgSelect73[["PgSelect[73∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Lambda11{{"Lambda[11∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant131{{"Constant[131∈0] ➊<br />ᐸ3ᐳ"}}:::plan
    Constant132{{"Constant[132∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object10 & Lambda11 & Constant131 & Constant132 --> PgSelect73
    PgSelect19[["PgSelect[19∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 & Lambda11 & Constant126 --> PgSelect19
    PgSelect52[["PgSelect[52∈0] ➊<br />ᐸpostᐳ"]]:::plan
    Object10 & Lambda54 & Constant126 --> PgSelect52
    PgSelect83[["PgSelect[83∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Constant133{{"Constant[133∈0] ➊<br />ᐸ0ᐳ"}}:::plan
    Object10 & Lambda11 & Constant133 --> PgSelect83
    PgSelect118[["PgSelect[118∈0] ➊<br />ᐸpostᐳ"]]:::plan
    Lambda120{{"Lambda[120∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Object10 & Lambda120 & Constant131 --> PgSelect118
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 & Lambda11 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect30[["PgSelect[30∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Lambda32{{"Lambda[32∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Object10 & Lambda32 --> PgSelect30
    PgSelect41[["PgSelect[41∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Lambda43{{"Lambda[43∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Object10 & Lambda43 --> PgSelect41
    PgSelect94[["PgSelect[94∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Lambda96{{"Lambda[96∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Object10 & Lambda96 --> PgSelect94
    PgSelect105[["PgSelect[105∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 & Lambda11 --> PgSelect105
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    Constant6{{"Constant[6∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Constant6 --> Lambda11
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelect7 --> PgSelectRows12
    PgSelectRows22[["PgSelectRows[22∈0] ➊"]]:::plan
    PgSelect19 --> PgSelectRows22
    Constant139{{"Constant[139∈0] ➊<br />ᐸ[ 'NAME_ASC' ]ᐳ"}}:::plan
    Constant139 --> Lambda32
    PgSelectRows33[["PgSelectRows[33∈0] ➊"]]:::plan
    PgSelect30 --> PgSelectRows33
    Constant140{{"Constant[140∈0] ➊<br />ᐸ[ 'NAME_DESC' ]ᐳ"}}:::plan
    Constant140 --> Lambda43
    PgSelectRows44[["PgSelectRows[44∈0] ➊"]]:::plan
    PgSelect41 --> PgSelectRows44
    Constant6 --> Lambda54
    PgSelectRows55[["PgSelectRows[55∈0] ➊"]]:::plan
    PgSelect52 --> PgSelectRows55
    PgSelectRows66[["PgSelectRows[66∈0] ➊"]]:::plan
    PgSelect63 --> PgSelectRows66
    PgSelectRows76[["PgSelectRows[76∈0] ➊"]]:::plan
    PgSelect73 --> PgSelectRows76
    PgSelectRows86[["PgSelectRows[86∈0] ➊"]]:::plan
    PgSelect83 --> PgSelectRows86
    Constant141{{"Constant[141∈0] ➊<br />ᐸ[ 'PRIMARY_KEY_ASC' ]ᐳ"}}:::plan
    Constant141 --> Lambda96
    PgSelectRows97[["PgSelectRows[97∈0] ➊"]]:::plan
    PgSelect94 --> PgSelectRows97
    PgSelectRows108[["PgSelectRows[108∈0] ➊"]]:::plan
    PgSelect105 --> PgSelectRows108
    Constant142{{"Constant[142∈0] ➊<br />ᐸ[ 'AUTHOR_ID_DESC', 'HEADLINE_DESC' ]ᐳ"}}:::plan
    Constant142 --> Lambda120
    PgSelectRows121[["PgSelectRows[121∈0] ➊"]]:::plan
    PgSelect118 --> PgSelectRows121
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    __Item13[/"__Item[13∈1]<br />ᐸ12ᐳ"\]:::itemplan
    PgSelectRows12 ==> __Item13
    PgSelectSingle14{{"PgSelectSingle[14∈1]<br />ᐸpersonᐳ"}}:::plan
    __Item13 --> PgSelectSingle14
    PgClassExpression15{{"PgClassExpression[15∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression15
    PgClassExpression16{{"PgClassExpression[16∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression16
    PgClassExpression17{{"PgClassExpression[17∈1]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression17
    __Item23[/"__Item[23∈2]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelectRows22 ==> __Item23
    PgSelectSingle24{{"PgSelectSingle[24∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item23 --> PgSelectSingle24
    PgClassExpression25{{"PgClassExpression[25∈2]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression25
    PgClassExpression26{{"PgClassExpression[26∈2]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression26
    PgClassExpression27{{"PgClassExpression[27∈2]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression27
    __Item34[/"__Item[34∈3]<br />ᐸ33ᐳ"\]:::itemplan
    PgSelectRows33 ==> __Item34
    PgSelectSingle35{{"PgSelectSingle[35∈3]<br />ᐸpersonᐳ"}}:::plan
    __Item34 --> PgSelectSingle35
    PgClassExpression36{{"PgClassExpression[36∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle35 --> PgClassExpression36
    PgClassExpression37{{"PgClassExpression[37∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle35 --> PgClassExpression37
    PgClassExpression38{{"PgClassExpression[38∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle35 --> PgClassExpression38
    __Item45[/"__Item[45∈4]<br />ᐸ44ᐳ"\]:::itemplan
    PgSelectRows44 ==> __Item45
    PgSelectSingle46{{"PgSelectSingle[46∈4]<br />ᐸpersonᐳ"}}:::plan
    __Item45 --> PgSelectSingle46
    PgClassExpression47{{"PgClassExpression[47∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression47
    PgClassExpression48{{"PgClassExpression[48∈4]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression48
    PgClassExpression49{{"PgClassExpression[49∈4]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression49
    __Item56[/"__Item[56∈5]<br />ᐸ55ᐳ"\]:::itemplan
    PgSelectRows55 ==> __Item56
    PgSelectSingle57{{"PgSelectSingle[57∈5]<br />ᐸpostᐳ"}}:::plan
    __Item56 --> PgSelectSingle57
    PgClassExpression58{{"PgClassExpression[58∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression59
    __Item67[/"__Item[67∈6]<br />ᐸ66ᐳ"\]:::itemplan
    PgSelectRows66 ==> __Item67
    PgSelectSingle68{{"PgSelectSingle[68∈6]<br />ᐸpostᐳ"}}:::plan
    __Item67 --> PgSelectSingle68
    PgClassExpression69{{"PgClassExpression[69∈6]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression69
    PgClassExpression70{{"PgClassExpression[70∈6]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression70
    __Item77[/"__Item[77∈7]<br />ᐸ76ᐳ"\]:::itemplan
    PgSelectRows76 ==> __Item77
    PgSelectSingle78{{"PgSelectSingle[78∈7]<br />ᐸpersonᐳ"}}:::plan
    __Item77 --> PgSelectSingle78
    PgClassExpression79{{"PgClassExpression[79∈7]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression79
    PgClassExpression80{{"PgClassExpression[80∈7]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression80
    PgClassExpression81{{"PgClassExpression[81∈7]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression81
    __Item87[/"__Item[87∈8]<br />ᐸ86ᐳ"\]:::itemplan
    PgSelectRows86 ==> __Item87
    PgSelectSingle88{{"PgSelectSingle[88∈8]<br />ᐸpersonᐳ"}}:::plan
    __Item87 --> PgSelectSingle88
    PgClassExpression89{{"PgClassExpression[89∈8]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle88 --> PgClassExpression89
    PgClassExpression90{{"PgClassExpression[90∈8]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle88 --> PgClassExpression90
    PgClassExpression91{{"PgClassExpression[91∈8]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle88 --> PgClassExpression91
    __Item98[/"__Item[98∈9]<br />ᐸ97ᐳ"\]:::itemplan
    PgSelectRows97 ==> __Item98
    PgSelectSingle99{{"PgSelectSingle[99∈9]<br />ᐸpersonᐳ"}}:::plan
    __Item98 --> PgSelectSingle99
    PgClassExpression100{{"PgClassExpression[100∈9]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression100
    PgClassExpression101{{"PgClassExpression[101∈9]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression101
    PgClassExpression102{{"PgClassExpression[102∈9]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression102
    __Item109[/"__Item[109∈10]<br />ᐸ108ᐳ"\]:::itemplan
    PgSelectRows108 ==> __Item109
    PgSelectSingle110{{"PgSelectSingle[110∈10]<br />ᐸpersonᐳ"}}:::plan
    __Item109 --> PgSelectSingle110
    PgClassExpression111{{"PgClassExpression[111∈10]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle110 --> PgClassExpression111
    PgClassExpression112{{"PgClassExpression[112∈10]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle110 --> PgClassExpression112
    PgClassExpression113{{"PgClassExpression[113∈10]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle110 --> PgClassExpression113
    __Item122[/"__Item[122∈11]<br />ᐸ121ᐳ"\]:::itemplan
    PgSelectRows121 ==> __Item122
    PgSelectSingle123{{"PgSelectSingle[123∈11]<br />ᐸpostᐳ"}}:::plan
    __Item122 --> PgSelectSingle123
    PgClassExpression124{{"PgClassExpression[124∈11]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression124
    PgClassExpression125{{"PgClassExpression[125∈11]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression125

    %% define steps

    subgraph "Buckets for queries/v4/simple-collections"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 6, 8, 9, 126, 131, 132, 133, 139, 140, 141, 142, 10, 11, 32, 43, 54, 96, 120<br />2: 7, 19, 30, 41, 52, 63, 73, 83, 94, 105, 118<br />3: 12, 22, 33, 44, 55, 66, 76, 86, 97, 108, 121"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant6,PgSelect7,Access8,Access9,Object10,Lambda11,PgSelectRows12,PgSelect19,PgSelectRows22,PgSelect30,Lambda32,PgSelectRows33,PgSelect41,Lambda43,PgSelectRows44,PgSelect52,Lambda54,PgSelectRows55,PgSelect63,PgSelectRows66,PgSelect73,PgSelectRows76,PgSelect83,PgSelectRows86,PgSelect94,Lambda96,PgSelectRows97,PgSelect105,PgSelectRows108,PgSelect118,Lambda120,PgSelectRows121,Constant126,Constant131,Constant132,Constant133,Constant139,Constant140,Constant141,Constant142 bucket0
    Bucket1("Bucket 1 (listItem)<br /><br />ROOT __Item{1}ᐸ12ᐳ[13]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item13,PgSelectSingle14,PgClassExpression15,PgClassExpression16,PgClassExpression17 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ22ᐳ[23]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item23,PgSelectSingle24,PgClassExpression25,PgClassExpression26,PgClassExpression27 bucket2
    Bucket3("Bucket 3 (listItem)<br /><br />ROOT __Item{3}ᐸ33ᐳ[34]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item34,PgSelectSingle35,PgClassExpression36,PgClassExpression37,PgClassExpression38 bucket3
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ44ᐳ[45]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item45,PgSelectSingle46,PgClassExpression47,PgClassExpression48,PgClassExpression49 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ55ᐳ[56]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item56,PgSelectSingle57,PgClassExpression58,PgClassExpression59 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ66ᐳ[67]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item67,PgSelectSingle68,PgClassExpression69,PgClassExpression70 bucket6
    Bucket7("Bucket 7 (listItem)<br /><br />ROOT __Item{7}ᐸ76ᐳ[77]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item77,PgSelectSingle78,PgClassExpression79,PgClassExpression80,PgClassExpression81 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ86ᐳ[87]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item87,PgSelectSingle88,PgClassExpression89,PgClassExpression90,PgClassExpression91 bucket8
    Bucket9("Bucket 9 (listItem)<br /><br />ROOT __Item{9}ᐸ97ᐳ[98]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item98,PgSelectSingle99,PgClassExpression100,PgClassExpression101,PgClassExpression102 bucket9
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ108ᐳ[109]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item109,PgSelectSingle110,PgClassExpression111,PgClassExpression112,PgClassExpression113 bucket10
    Bucket11("Bucket 11 (listItem)<br /><br />ROOT __Item{11}ᐸ121ᐳ[122]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,__Item122,PgSelectSingle123,PgClassExpression124,PgClassExpression125 bucket11
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6 & Bucket7 & Bucket8 & Bucket9 & Bucket10 & Bucket11
    end
