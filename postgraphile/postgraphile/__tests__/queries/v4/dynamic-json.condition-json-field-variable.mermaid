%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object21{{"Object[21∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access19{{"Access[19∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access20{{"Access[20∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access19 & Access20 --> Object21
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access19
    __Value2 --> Access20
    Lambda72{{"Lambda[72∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant89{{"Constant[89∈0] ➊<br />ᐸ[Object: null prototype] {   cursorLower: null,   cursorUppeᐳ"}}:::plan
    Constant89 --> Lambda72
    __Value0["__Value[0∈0] ➊<br />ᐸvariableValuesᐳ"]:::plan
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection22{{"Connection[22∈0] ➊<br />ᐸ18ᐳ"}}:::plan
    Connection40{{"Connection[40∈0] ➊<br />ᐸ38ᐳ"}}:::plan
    Connection59{{"Connection[59∈0] ➊<br />ᐸ57ᐳ"}}:::plan
    PgSelect23[["PgSelect[23∈1] ➊<br />ᐸmy_tableᐳ"]]:::plan
    __InputDynamicScalar15{{"__InputDynamicScalar[15∈1] ➊"}}:::plan
    Object21 & __InputDynamicScalar15 & Connection22 & Lambda72 --> PgSelect23
    Access16{{"Access[16∈1] ➊<br />ᐸ0.myValᐳ"}}:::plan
    Access16 --> __InputDynamicScalar15
    __Value0 --> Access16
    __Item24[/"__Item[24∈2]<br />ᐸ23ᐳ"\]:::itemplan
    PgSelect23 ==> __Item24
    PgSelectSingle25{{"PgSelectSingle[25∈2]<br />ᐸmy_tableᐳ"}}:::plan
    __Item24 --> PgSelectSingle25
    PgClassExpression26{{"PgClassExpression[26∈3]<br />ᐸ__my_table__.”id”ᐳ"}}:::plan
    PgSelectSingle25 --> PgClassExpression26
    PgClassExpression27{{"PgClassExpression[27∈3]<br />ᐸ__my_table...json_data”ᐳ"}}:::plan
    PgSelectSingle25 --> PgClassExpression27
    PgSelect41[["PgSelect[41∈4] ➊<br />ᐸmy_tableᐳ"]]:::plan
    __InputDynamicScalar37{{"__InputDynamicScalar[37∈4] ➊"}}:::plan
    Object21 & __InputDynamicScalar37 & Connection40 & Lambda72 --> PgSelect41
    __Item42[/"__Item[42∈5]<br />ᐸ41ᐳ"\]:::itemplan
    PgSelect41 ==> __Item42
    PgSelectSingle43{{"PgSelectSingle[43∈5]<br />ᐸmy_tableᐳ"}}:::plan
    __Item42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈6]<br />ᐸ__my_table__.”id”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈6]<br />ᐸ__my_table...json_data”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression45
    PgSelect60[["PgSelect[60∈7] ➊<br />ᐸmy_tableᐳ"]]:::plan
    Access55{{"Access[55∈7] ➊<br />ᐸ0.myVal2ᐳ"}}:::plan
    Object21 & Access55 & Connection59 & Lambda72 --> PgSelect60
    __Value0 --> Access55
    __Item61[/"__Item[61∈8]<br />ᐸ60ᐳ"\]:::itemplan
    PgSelect60 ==> __Item61
    PgSelectSingle62{{"PgSelectSingle[62∈8]<br />ᐸmy_tableᐳ"}}:::plan
    __Item61 --> PgSelectSingle62
    PgClassExpression63{{"PgClassExpression[63∈9]<br />ᐸ__my_table__.”id”ᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression63
    PgClassExpression64{{"PgClassExpression[64∈9]<br />ᐸ__my_table...json_data”ᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression64

    %% define steps

    subgraph "Buckets for queries/v4/dynamic-json.condition-json-field-variable"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value2,__Value4,Access19,Access20,Object21,Connection22,Connection40,Connection59,Lambda72,Constant89 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 0, 21, 22, 72<br /><br />ROOT Connectionᐸ18ᐳ[22]<br />1: <br />ᐳ: Access[16], __InputDynamicScalar[15]<br />2: PgSelect[23]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__InputDynamicScalar15,Access16,PgSelect23 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ23ᐳ[24]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item24,PgSelectSingle25 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 25<br /><br />ROOT PgSelectSingle{2}ᐸmy_tableᐳ[25]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression26,PgClassExpression27 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 21, 40, 72<br /><br />ROOT Connectionᐸ38ᐳ[40]<br />1: <br />ᐳ: __InputDynamicScalar[37]<br />2: PgSelect[41]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__InputDynamicScalar37,PgSelect41 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ41ᐳ[42]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item42,PgSelectSingle43 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 43<br /><br />ROOT PgSelectSingle{5}ᐸmy_tableᐳ[43]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgClassExpression44,PgClassExpression45 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 0, 21, 59, 72<br /><br />ROOT Connectionᐸ57ᐳ[59]<br />1: <br />ᐳ: Access[55]<br />2: PgSelect[60]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,Access55,PgSelect60 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ60ᐳ[61]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item61,PgSelectSingle62 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 62<br /><br />ROOT PgSelectSingle{8}ᐸmy_tableᐳ[62]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression63,PgClassExpression64 bucket9
    Bucket0 --> Bucket1 & Bucket4 & Bucket7
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    end
