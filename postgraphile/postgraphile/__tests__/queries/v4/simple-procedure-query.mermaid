%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect41[["PgSelect[41∈0] ➊<br />ᐸint_set_queryᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgFromExpression43{{"PgFromExpression[43∈0] ➊"}}:::plan
    Object11 & PgFromExpression43 --> PgSelect41
    PgSelect8[["PgSelect[8∈0] ➊<br />ᐸcompound_type_set_queryᐳ"]]:::plan
    Constant85{{"Constant[85∈0] ➊<br />ᐸ5ᐳ"}}:::plan
    Object11 & Constant85 --> PgSelect8
    PgSelect25[["PgSelect[25∈0] ➊<br />ᐸtable_set_queryᐳ"]]:::plan
    Object11 --> PgSelect25
    PgSelect33[["PgSelect[33∈0] ➊<br />ᐸtable_set_queryᐳ"]]:::plan
    Constant86{{"Constant[86∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Object11 --> PgSelect33
    Constant86 -- 2 --> PgSelect33
    Constant87{{"Constant[87∈0] ➊<br />ᐸ6ᐳ"}}:::plan
    Constant85 & Constant87 --> PgFromExpression43
    PgSelect48[["PgSelect[48∈0] ➊<br />ᐸstatic_big_integerᐳ"]]:::plan
    Object11 --> PgSelect48
    PgSelect54[["PgSelect[54∈0] ➊<br />ᐸquery_interval_setᐳ"]]:::plan
    Object11 --> PgSelect54
    PgSelect67[["PgSelect[67∈0] ➊<br />ᐸpostᐳ"]]:::plan
    Constant88{{"Constant[88∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object11 & Constant88 --> PgSelect67
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelect8 --> PgSelectRows12
    PgSelectRows27[["PgSelectRows[27∈0] ➊"]]:::plan
    PgSelect25 --> PgSelectRows27
    PgSelectRows35[["PgSelectRows[35∈0] ➊"]]:::plan
    PgSelect33 --> PgSelectRows35
    PgSelectRows44[["PgSelectRows[44∈0] ➊"]]:::plan
    PgSelect41 --> PgSelectRows44
    PgSelectRows50[["PgSelectRows[50∈0] ➊"]]:::plan
    PgSelect48 --> PgSelectRows50
    PgSelectRows56[["PgSelectRows[56∈0] ➊"]]:::plan
    PgSelect54 --> PgSelectRows56
    PgSelectRows69[["PgSelectRows[69∈0] ➊"]]:::plan
    PgSelect67 --> PgSelectRows69
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgFromExpression78{{"PgFromExpression[78∈0] ➊"}}:::plan
    __Item13[/"__Item[13∈1]<br />ᐸ12ᐳ"\]:::itemplan
    PgSelectRows12 ==> __Item13
    PgSelectSingle14{{"PgSelectSingle[14∈1]<br />ᐸcompound_type_set_queryᐳ"}}:::plan
    __Item13 --> PgSelectSingle14
    PgClassExpression15{{"PgClassExpression[15∈1]<br />ᐸ__compound...uery__.”a”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression15
    PgClassExpression16{{"PgClassExpression[16∈1]<br />ᐸ__compound...uery__.”b”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression16
    PgClassExpression17{{"PgClassExpression[17∈1]<br />ᐸ__compound...uery__.”c”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression17
    PgClassExpression18{{"PgClassExpression[18∈1]<br />ᐸ__compound...uery__.”d”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression18
    PgClassExpression19{{"PgClassExpression[19∈1]<br />ᐸ__compound...uery__.”e”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression19
    PgClassExpression20{{"PgClassExpression[20∈1]<br />ᐸ__compound...uery__.”f”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression20
    PgClassExpression21{{"PgClassExpression[21∈1]<br />ᐸ__compound...uery__.”g”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression21
    __Item28[/"__Item[28∈2]<br />ᐸ27ᐳ"\]:::itemplan
    PgSelectRows27 ==> __Item28
    PgSelectSingle29{{"PgSelectSingle[29∈2]<br />ᐸtable_set_queryᐳ"}}:::plan
    __Item28 --> PgSelectSingle29
    PgClassExpression30{{"PgClassExpression[30∈2]<br />ᐸ__table_se...full_name”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression30
    __Item36[/"__Item[36∈3]<br />ᐸ35ᐳ"\]:::itemplan
    PgSelectRows35 ==> __Item36
    PgSelectSingle37{{"PgSelectSingle[37∈3]<br />ᐸtable_set_queryᐳ"}}:::plan
    __Item36 --> PgSelectSingle37
    PgClassExpression38{{"PgClassExpression[38∈3]<br />ᐸ__table_se...full_name”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression38
    __Item45[/"__Item[45∈4]<br />ᐸ44ᐳ"\]:::itemplan
    PgSelectRows44 ==> __Item45
    PgSelectSingle46{{"PgSelectSingle[46∈4]<br />ᐸint_set_queryᐳ"}}:::plan
    __Item45 --> PgSelectSingle46
    PgClassExpression47{{"PgClassExpression[47∈4]<br />ᐸ__int_set_query__.vᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression47
    __Item51[/"__Item[51∈5]<br />ᐸ50ᐳ"\]:::itemplan
    PgSelectRows50 ==> __Item51
    PgSelectSingle52{{"PgSelectSingle[52∈5]<br />ᐸstatic_big_integerᐳ"}}:::plan
    __Item51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈5]<br />ᐸ__static_b...nteger__.vᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    __Item57[/"__Item[57∈6]<br />ᐸ56ᐳ"\]:::itemplan
    PgSelectRows56 ==> __Item57
    PgSelectSingle58{{"PgSelectSingle[58∈6]<br />ᐸquery_interval_setᐳ"}}:::plan
    __Item57 --> PgSelectSingle58
    PgClassExpression59{{"PgClassExpression[59∈6]<br />ᐸ__query_in...al_set__.vᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression59
    PgSelect74[["PgSelect[74∈7]<br />ᐸpost_computed_interval_setᐳ"]]:::plan
    PgClassExpression73{{"PgClassExpression[73∈7]<br />ᐸ__post__ᐳ"}}:::plan
    Object11 & PgClassExpression73 & PgFromExpression78 --> PgSelect74
    __Item70[/"__Item[70∈7]<br />ᐸ69ᐳ"\]:::itemplan
    PgSelectRows69 ==> __Item70
    PgSelectSingle71{{"PgSelectSingle[71∈7]<br />ᐸpostᐳ"}}:::plan
    __Item70 --> PgSelectSingle71
    PgClassExpression72{{"PgClassExpression[72∈7]<br />ᐸ__post__.”id”ᐳ"}}:::plan
    PgSelectSingle71 --> PgClassExpression72
    PgSelectSingle71 --> PgClassExpression73
    PgSelectRows79[["PgSelectRows[79∈7]"]]:::plan
    PgSelect74 --> PgSelectRows79
    __Item80[/"__Item[80∈8]<br />ᐸ79ᐳ"\]:::itemplan
    PgSelectRows79 ==> __Item80
    PgSelectSingle81{{"PgSelectSingle[81∈8]<br />ᐸpost_computed_interval_setᐳ"}}:::plan
    __Item80 --> PgSelectSingle81
    PgClassExpression82{{"PgClassExpression[82∈8]<br />ᐸ__post_com...al_set__.vᐳ"}}:::plan
    PgSelectSingle81 --> PgClassExpression82

    %% define steps

    subgraph "Buckets for queries/v4/simple-procedure-query"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 9, 10, 78, 85, 86, 87, 88, 11, 43<br />2: 8, 25, 33, 41, 48, 54, 67<br />3: 12, 27, 35, 44, 50, 56, 69"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect8,Access9,Access10,Object11,PgSelectRows12,PgSelect25,PgSelectRows27,PgSelect33,PgSelectRows35,PgSelect41,PgFromExpression43,PgSelectRows44,PgSelect48,PgSelectRows50,PgSelect54,PgSelectRows56,PgSelect67,PgSelectRows69,PgFromExpression78,Constant85,Constant86,Constant87,Constant88 bucket0
    Bucket1("Bucket 1 (listItem)<br /><br />ROOT __Item{1}ᐸ12ᐳ[13]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item13,PgSelectSingle14,PgClassExpression15,PgClassExpression16,PgClassExpression17,PgClassExpression18,PgClassExpression19,PgClassExpression20,PgClassExpression21 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ27ᐳ[28]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item28,PgSelectSingle29,PgClassExpression30 bucket2
    Bucket3("Bucket 3 (listItem)<br /><br />ROOT __Item{3}ᐸ35ᐳ[36]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item36,PgSelectSingle37,PgClassExpression38 bucket3
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ44ᐳ[45]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item45,PgSelectSingle46,PgClassExpression47 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ50ᐳ[51]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item51,PgSelectSingle52,PgClassExpression53 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ56ᐳ[57]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item57,PgSelectSingle58,PgClassExpression59 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 11, 78, 7<br /><br />ROOT __Item{7}ᐸ69ᐳ[70]<br />1: <br />ᐳ: 71, 72, 73<br />2: PgSelect[74]<br />3: PgSelectRows[79]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item70,PgSelectSingle71,PgClassExpression72,PgClassExpression73,PgSelect74,PgSelectRows79 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ79ᐳ[80]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item80,PgSelectSingle81,PgClassExpression82 bucket8
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6 & Bucket7
    Bucket7 --> Bucket8
    end
