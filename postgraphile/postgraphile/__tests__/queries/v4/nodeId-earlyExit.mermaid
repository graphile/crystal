%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect21[["PgSelect[21∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    ApplyInput20{{"ApplyInput[20∈0] ➊"}}:::plan
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    ApplyInput20 -->|rejectNull| PgSelect21
    Object17 & Connection18 --> PgSelect21
    PgSelect48[["PgSelect[48∈0] ➊<br />ᐸpostᐳ"]]:::plan
    ApplyInput47{{"ApplyInput[47∈0] ➊"}}:::plan
    Connection45{{"Connection[45∈0] ➊<br />ᐸ43ᐳ"}}:::plan
    ApplyInput47 -->|rejectNull| PgSelect48
    Object17 & Connection45 --> PgSelect48
    __InputObject12{{"__InputObject[12∈0] ➊"}}:::plan
    Constant67{{"Constant[67∈0] ➊<br />ᐸ'Twenty Seventwo'ᐳ"}}:::plan
    Constant67 --> __InputObject12
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    PgSelect34[["PgSelect[34∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Access32{{"Access[32∈0] ➊<br />ᐸ31.1ᐳ"}}:::plan
    Object17 -->|rejectNull| PgSelect34
    Access32 --> PgSelect34
    __InputObject41{{"__InputObject[41∈0] ➊"}}:::plan
    Constant69{{"Constant[69∈0] ➊<br />ᐸ'Is that a cooking show?'ᐳ"}}:::plan
    Constant69 --> __InputObject41
    PgSelect61[["PgSelect[61∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Access59{{"Access[59∈0] ➊<br />ᐸ58.1ᐳ"}}:::plan
    Object17 -->|rejectNull| PgSelect61
    Access59 --> PgSelect61
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    __InputObject12 --> ApplyInput20
    PgSelectRows22[["PgSelectRows[22∈0] ➊"]]:::plan
    PgSelect21 --> PgSelectRows22
    Lambda31{{"Lambda[31∈0] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant68{{"Constant[68∈0] ➊<br />ᐸ'WyJwZW9wbGUiLDZd'ᐳ"}}:::plan
    Constant68 --> Lambda31
    Lambda31 --> Access32
    First36{{"First[36∈0] ➊"}}:::plan
    PgSelectRows37[["PgSelectRows[37∈0] ➊"]]:::plan
    PgSelectRows37 --> First36
    PgSelect34 --> PgSelectRows37
    PgSelectSingle38{{"PgSelectSingle[38∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First36 --> PgSelectSingle38
    PgClassExpression39{{"PgClassExpression[39∈0] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle38 --> PgClassExpression39
    __InputObject41 --> ApplyInput47
    PgSelectRows49[["PgSelectRows[49∈0] ➊"]]:::plan
    PgSelect48 --> PgSelectRows49
    Lambda58{{"Lambda[58∈0] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant70{{"Constant[70∈0] ➊<br />ᐸ'WyJwb3N0cyIsM10='ᐳ"}}:::plan
    Constant70 --> Lambda58
    Lambda58 --> Access59
    First63{{"First[63∈0] ➊"}}:::plan
    PgSelectRows64[["PgSelectRows[64∈0] ➊"]]:::plan
    PgSelectRows64 --> First63
    PgSelect61 --> PgSelectRows64
    PgSelectSingle65{{"PgSelectSingle[65∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First63 --> PgSelectSingle65
    PgClassExpression66{{"PgClassExpression[66∈0] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle65 --> PgClassExpression66
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant25{{"Constant[25∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Constant52{{"Constant[52∈0] ➊<br />ᐸ'posts'ᐳ"}}:::plan
    List27{{"List[27∈1]<br />ᐸ25,26ᐳ"}}:::plan
    PgClassExpression26{{"PgClassExpression[26∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant25 & PgClassExpression26 --> List27
    __Item23[/"__Item[23∈1]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelectRows22 ==> __Item23
    PgSelectSingle24{{"PgSelectSingle[24∈1]<br />ᐸpersonᐳ"}}:::plan
    __Item23 --> PgSelectSingle24
    PgSelectSingle24 --> PgClassExpression26
    Lambda28{{"Lambda[28∈1]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List27 --> Lambda28
    PgClassExpression29{{"PgClassExpression[29∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression29
    List54{{"List[54∈2]<br />ᐸ52,53ᐳ"}}:::plan
    PgClassExpression53{{"PgClassExpression[53∈2]<br />ᐸ__post__.”id”ᐳ"}}:::plan
    Constant52 & PgClassExpression53 --> List54
    __Item50[/"__Item[50∈2]<br />ᐸ49ᐳ"\]:::itemplan
    PgSelectRows49 ==> __Item50
    PgSelectSingle51{{"PgSelectSingle[51∈2]<br />ᐸpostᐳ"}}:::plan
    __Item50 --> PgSelectSingle51
    PgSelectSingle51 --> PgClassExpression53
    Lambda55{{"Lambda[55∈2]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List54 --> Lambda55
    PgClassExpression56{{"PgClassExpression[56∈2]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression56

    %% define steps

    subgraph "Buckets for queries/v4/nodeId-earlyExit"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 10, 15, 16, 25, 52, 67, 68, 69, 70, 12, 17, 18, 20, 31, 32, 41, 45, 47, 58, 59<br />2: 21, 34, 48, 61<br />3: 22, 37, 49, 64<br />ᐳ: 36, 38, 39, 63, 65, 66"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,__InputObject12,Access15,Access16,Object17,Connection18,ApplyInput20,PgSelect21,PgSelectRows22,Constant25,Lambda31,Access32,PgSelect34,First36,PgSelectRows37,PgSelectSingle38,PgClassExpression39,__InputObject41,Connection45,ApplyInput47,PgSelect48,PgSelectRows49,Constant52,Lambda58,Access59,PgSelect61,First63,PgSelectRows64,PgSelectSingle65,PgClassExpression66,Constant67,Constant68,Constant69,Constant70 bucket0
    Bucket1("Bucket 1 (listItem)<br />Deps: 25<br /><br />ROOT __Item{1}ᐸ22ᐳ[23]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item23,PgSelectSingle24,PgClassExpression26,List27,Lambda28,PgClassExpression29 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 52<br /><br />ROOT __Item{2}ᐸ49ᐳ[50]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item50,PgSelectSingle51,PgClassExpression53,List54,Lambda55,PgClassExpression56 bucket2
    Bucket0 --> Bucket1 & Bucket2
    end
