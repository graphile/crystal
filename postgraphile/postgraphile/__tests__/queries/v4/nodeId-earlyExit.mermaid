%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection19{{"Connection[19∈0] ➊<br />ᐸ15ᐳ"}}:::plan
    Constant10{{"Constant[10∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Constant10 & Constant10 & Constant10 --> Connection19
    Connection47{{"Connection[47∈0] ➊<br />ᐸ45ᐳ"}}:::plan
    Constant10 & Constant10 & Constant10 --> Connection47
    __InputObject13{{"__InputObject[13∈0] ➊"}}:::plan
    Constant71{{"Constant[71∈0] ➊<br />ᐸ'Twenty Seventwo'ᐳ"}}:::plan
    Constant10 & Constant71 --> __InputObject13
    Object18{{"Object[18∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    PgSelect35[["PgSelect[35∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Access33{{"Access[33∈0] ➊<br />ᐸ32.1ᐳ"}}:::plan
    Object18 -->|rejectNull| PgSelect35
    Access33 --> PgSelect35
    __InputObject43{{"__InputObject[43∈0] ➊"}}:::plan
    Constant74{{"Constant[74∈0] ➊<br />ᐸ'Is that a cooking show?'ᐳ"}}:::plan
    Constant10 & Constant74 --> __InputObject43
    PgSelect63[["PgSelect[63∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Access61{{"Access[61∈0] ➊<br />ᐸ60.1ᐳ"}}:::plan
    Object18 -->|rejectNull| PgSelect63
    Access61 --> PgSelect63
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access16
    __Value2 --> Access17
    Lambda20{{"Lambda[20∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant76{{"Constant[76∈0] ➊<br />ᐸ[ 'PRIMARY_KEY_ASC' ]ᐳ"}}:::plan
    Constant76 --> Lambda20
    ApplyInput21{{"ApplyInput[21∈0] ➊"}}:::plan
    __InputObject13 --> ApplyInput21
    Lambda32{{"Lambda[32∈0] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant72{{"Constant[72∈0] ➊<br />ᐸ'WyJwZW9wbGUiLDZd'ᐳ"}}:::plan
    Constant72 --> Lambda32
    Lambda32 --> Access33
    First37{{"First[37∈0] ➊"}}:::plan
    PgSelectRows38[["PgSelectRows[38∈0] ➊"]]:::plan
    PgSelectRows38 --> First37
    PgSelect35 --> PgSelectRows38
    PgSelectSingle39{{"PgSelectSingle[39∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First37 --> PgSelectSingle39
    Lambda48{{"Lambda[48∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant76 --> Lambda48
    ApplyInput49{{"ApplyInput[49∈0] ➊"}}:::plan
    __InputObject43 --> ApplyInput49
    Lambda60{{"Lambda[60∈0] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant75{{"Constant[75∈0] ➊<br />ᐸ'WyJwb3N0cyIsM10='ᐳ"}}:::plan
    Constant75 --> Lambda60
    Lambda60 --> Access61
    First65{{"First[65∈0] ➊"}}:::plan
    PgSelectRows66[["PgSelectRows[66∈0] ➊"]]:::plan
    PgSelectRows66 --> First65
    PgSelect63 --> PgSelectRows66
    PgSelectSingle67{{"PgSelectSingle[67∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First65 --> PgSelectSingle67
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant26{{"Constant[26∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Constant54{{"Constant[54∈0] ➊<br />ᐸ'posts'ᐳ"}}:::plan
    PgSelect22[["PgSelect[22∈1] ➊<br />ᐸpersonᐳ"]]:::plan
    Object18 & Lambda20 & ApplyInput21 & Connection19 & Constant10 & Constant10 & Constant10 --> PgSelect22
    PgSelectRows23[["PgSelectRows[23∈1] ➊"]]:::plan
    PgSelect22 --> PgSelectRows23
    __Item24[/"__Item[24∈2]<br />ᐸ23ᐳ"\]:::itemplan
    PgSelectRows23 ==> __Item24
    PgSelectSingle25{{"PgSelectSingle[25∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item24 --> PgSelectSingle25
    List28{{"List[28∈3]<br />ᐸ26,27ᐳ"}}:::plan
    PgClassExpression27{{"PgClassExpression[27∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant26 & PgClassExpression27 --> List28
    PgSelectSingle25 --> PgClassExpression27
    Lambda29{{"Lambda[29∈3]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List28 --> Lambda29
    PgClassExpression30{{"PgClassExpression[30∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle25 --> PgClassExpression30
    PgClassExpression40{{"PgClassExpression[40∈4] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression40
    PgSelect50[["PgSelect[50∈5] ➊<br />ᐸpostᐳ"]]:::plan
    Object18 & Lambda48 & ApplyInput49 & Connection47 & Constant10 & Constant10 & Constant10 --> PgSelect50
    PgSelectRows51[["PgSelectRows[51∈5] ➊"]]:::plan
    PgSelect50 --> PgSelectRows51
    __Item52[/"__Item[52∈6]<br />ᐸ51ᐳ"\]:::itemplan
    PgSelectRows51 ==> __Item52
    PgSelectSingle53{{"PgSelectSingle[53∈6]<br />ᐸpostᐳ"}}:::plan
    __Item52 --> PgSelectSingle53
    List56{{"List[56∈7]<br />ᐸ54,55ᐳ"}}:::plan
    PgClassExpression55{{"PgClassExpression[55∈7]<br />ᐸ__post__.”id”ᐳ"}}:::plan
    Constant54 & PgClassExpression55 --> List56
    PgSelectSingle53 --> PgClassExpression55
    Lambda57{{"Lambda[57∈7]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List56 --> Lambda57
    PgClassExpression58{{"PgClassExpression[58∈7]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression58
    PgClassExpression68{{"PgClassExpression[68∈8] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression68

    %% define steps

    subgraph "Buckets for queries/v4/nodeId-earlyExit"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 10, 16, 17, 26, 54, 71, 72, 74, 75, 76, 13, 18, 19, 20, 21, 32, 33, 43, 47, 48, 49, 60, 61<br />2: PgSelect[35], PgSelect[63]<br />3: PgSelectRows[38], PgSelectRows[66]<br />ᐳ: 37, 39, 65, 67"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant10,__InputObject13,Access16,Access17,Object18,Connection19,Lambda20,ApplyInput21,Constant26,Lambda32,Access33,PgSelect35,First37,PgSelectRows38,PgSelectSingle39,__InputObject43,Connection47,Lambda48,ApplyInput49,Constant54,Lambda60,Access61,PgSelect63,First65,PgSelectRows66,PgSelectSingle67,Constant71,Constant72,Constant74,Constant75,Constant76 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 20, 21, 19, 10, 26<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: PgSelect[22]<br />2: PgSelectRows[23]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect22,PgSelectRows23 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 26<br /><br />ROOT __Item{2}ᐸ23ᐳ[24]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item24,PgSelectSingle25 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 25, 26<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[25]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression27,List28,Lambda29,PgClassExpression30 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 39<br /><br />ROOT PgSelectSingleᐸpersonᐳ[39]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression40 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 18, 48, 49, 47, 10, 54<br /><br />ROOT Connectionᐸ45ᐳ[47]<br />1: PgSelect[50]<br />2: PgSelectRows[51]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgSelect50,PgSelectRows51 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 54<br /><br />ROOT __Item{6}ᐸ51ᐳ[52]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item52,PgSelectSingle53 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 53, 54<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[53]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression55,List56,Lambda57,PgClassExpression58 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 67<br /><br />ROOT PgSelectSingleᐸpersonᐳ[67]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression68 bucket8
    Bucket0 --> Bucket1 & Bucket4 & Bucket5 & Bucket8
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7
    end
