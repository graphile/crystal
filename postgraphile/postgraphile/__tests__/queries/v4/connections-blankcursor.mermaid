%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    Constant110{{"Constant[110∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor21["PgValidateParsedCursor[21∈0] ➊"]:::plan
    Constant110 & Lambda19 & PgValidateParsedCursor21 & PgValidateParsedCursor21 & PgValidateParsedCursor21 & PgValidateParsedCursor21 & PgValidateParsedCursor21 --> Connection18
    Connection68{{"Connection[68∈0] ➊<br />ᐸ66ᐳ"}}:::plan
    Lambda69{{"Lambda[69∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor71["PgValidateParsedCursor[71∈0] ➊"]:::plan
    Constant110 & Lambda69 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 --> Connection68
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    Constant141{{"Constant[141∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant141 --> Lambda19
    Lambda19 --> PgValidateParsedCursor21
    Constant144{{"Constant[144∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant144 --> Lambda69
    Lambda69 --> PgValidateParsedCursor71
    Lambda115{{"Lambda[115∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant145{{"Constant[145∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    Constant145 --> Lambda115
    Lambda123{{"Lambda[123∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant142{{"Constant[142∈0] ➊<br />ᐸ[Object: null prototype] {   cursorLower: null,   cursorUppeᐳ"}}:::plan
    Constant142 --> Lambda123
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant41{{"Constant[41∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    PgSelect20[["PgSelect[20∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access22{{"Access[22∈1] ➊<br />ᐸ19.1ᐳ"}}:::plan
    Object17 & Connection18 & Lambda19 & Access22 & Lambda115 --> PgSelect20
    PgSelect42[["PgSelect[42∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection18 & Lambda123 --> PgSelect42
    Lambda19 --> Access22
    PgPageInfo23{{"PgPageInfo[23∈1] ➊"}}:::plan
    Connection18 --> PgPageInfo23
    First25{{"First[25∈1] ➊"}}:::plan
    PgSelect20 --> First25
    PgSelectSingle26{{"PgSelectSingle[26∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First25 --> PgSelectSingle26
    PgCursor27{{"PgCursor[27∈1] ➊"}}:::plan
    List30{{"List[30∈1] ➊<br />ᐸ29ᐳ"}}:::plan
    List30 --> PgCursor27
    PgClassExpression29{{"PgClassExpression[29∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression29
    PgClassExpression29 --> List30
    Last32{{"Last[32∈1] ➊"}}:::plan
    PgSelect20 --> Last32
    PgSelectSingle33{{"PgSelectSingle[33∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Last32 --> PgSelectSingle33
    PgCursor34{{"PgCursor[34∈1] ➊"}}:::plan
    List37{{"List[37∈1] ➊<br />ᐸ36ᐳ"}}:::plan
    List37 --> PgCursor34
    PgClassExpression36{{"PgClassExpression[36∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression36
    PgClassExpression36 --> List37
    Access39{{"Access[39∈1] ➊<br />ᐸ20.hasMoreᐳ"}}:::plan
    PgSelect20 --> Access39
    First43{{"First[43∈1] ➊"}}:::plan
    PgSelect42 --> First43
    PgSelectSingle44{{"PgSelectSingle[44∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First43 --> PgSelectSingle44
    PgClassExpression45{{"PgClassExpression[45∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression45
    __Item48[/"__Item[48∈2]<br />ᐸ20ᐳ"\]:::itemplan
    PgSelect20 ==> __Item48
    PgSelectSingle49{{"PgSelectSingle[49∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item48 --> PgSelectSingle49
    PgCursor50{{"PgCursor[50∈3]"}}:::plan
    List52{{"List[52∈3]<br />ᐸ51ᐳ"}}:::plan
    List52 --> PgCursor50
    PgClassExpression51{{"PgClassExpression[51∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression51
    PgClassExpression51 --> List52
    PgClassExpression54{{"PgClassExpression[54∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression54
    PgClassExpression55{{"PgClassExpression[55∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression57
    PgSelect70[["PgSelect[70∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access72{{"Access[72∈4] ➊<br />ᐸ69.1ᐳ"}}:::plan
    Object17 & Connection68 & Lambda69 & Access72 & Lambda115 --> PgSelect70
    PgSelect92[["PgSelect[92∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection68 & Lambda123 --> PgSelect92
    Lambda69 --> Access72
    PgPageInfo73{{"PgPageInfo[73∈4] ➊"}}:::plan
    Connection68 --> PgPageInfo73
    First75{{"First[75∈4] ➊"}}:::plan
    PgSelect70 --> First75
    PgSelectSingle76{{"PgSelectSingle[76∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First75 --> PgSelectSingle76
    PgCursor77{{"PgCursor[77∈4] ➊"}}:::plan
    List80{{"List[80∈4] ➊<br />ᐸ79ᐳ"}}:::plan
    List80 --> PgCursor77
    PgClassExpression79{{"PgClassExpression[79∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression79
    PgClassExpression79 --> List80
    Last82{{"Last[82∈4] ➊"}}:::plan
    PgSelect70 --> Last82
    PgSelectSingle83{{"PgSelectSingle[83∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Last82 --> PgSelectSingle83
    PgCursor84{{"PgCursor[84∈4] ➊"}}:::plan
    List87{{"List[87∈4] ➊<br />ᐸ86ᐳ"}}:::plan
    List87 --> PgCursor84
    PgClassExpression86{{"PgClassExpression[86∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression86
    PgClassExpression86 --> List87
    Access89{{"Access[89∈4] ➊<br />ᐸ70.hasMoreᐳ"}}:::plan
    PgSelect70 --> Access89
    First93{{"First[93∈4] ➊"}}:::plan
    PgSelect92 --> First93
    PgSelectSingle94{{"PgSelectSingle[94∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First93 --> PgSelectSingle94
    PgClassExpression95{{"PgClassExpression[95∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle94 --> PgClassExpression95
    __Item98[/"__Item[98∈5]<br />ᐸ70ᐳ"\]:::itemplan
    PgSelect70 ==> __Item98
    PgSelectSingle99{{"PgSelectSingle[99∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item98 --> PgSelectSingle99
    PgCursor100{{"PgCursor[100∈6]"}}:::plan
    List102{{"List[102∈6]<br />ᐸ101ᐳ"}}:::plan
    List102 --> PgCursor100
    PgClassExpression101{{"PgClassExpression[101∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression101
    PgClassExpression101 --> List102
    PgClassExpression104{{"PgClassExpression[104∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression104
    PgClassExpression105{{"PgClassExpression[105∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression105
    PgClassExpression106{{"PgClassExpression[106∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression106
    PgClassExpression107{{"PgClassExpression[107∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle99 --> PgClassExpression107

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 15, 16, 41, 110, 141, 142, 144, 145, 17, 19, 69, 115, 123<br />2: 21, 71<br />ᐳ: Connection[18], Connection[68]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access15,Access16,Object17,Connection18,Lambda19,PgValidateParsedCursor21,Constant41,Connection68,Lambda69,PgValidateParsedCursor71,Constant110,Lambda115,Lambda123,Constant141,Constant142,Constant144,Constant145 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18, 19, 115, 123, 41<br /><br />ROOT Connectionᐸ14ᐳ[18]<br />1: PgSelect[42]<br />ᐳ: 22, 23, 43, 44, 45<br />2: PgSelect[20]<br />ᐳ: 25, 26, 29, 30, 32, 33, 36, 37, 39, 27, 34"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect20,Access22,PgPageInfo23,First25,PgSelectSingle26,PgCursor27,PgClassExpression29,List30,Last32,PgSelectSingle33,PgCursor34,PgClassExpression36,List37,Access39,PgSelect42,First43,PgSelectSingle44,PgClassExpression45 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ20ᐳ[48]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item48,PgSelectSingle49 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 49<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[49]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor50,PgClassExpression51,List52,PgClassExpression54,PgClassExpression55,PgClassExpression56,PgClassExpression57 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 17, 68, 69, 115, 123, 41<br /><br />ROOT Connectionᐸ66ᐳ[68]<br />1: PgSelect[92]<br />ᐳ: 72, 73, 93, 94, 95<br />2: PgSelect[70]<br />ᐳ: 75, 76, 79, 80, 82, 83, 86, 87, 89, 77, 84"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect70,Access72,PgPageInfo73,First75,PgSelectSingle76,PgCursor77,PgClassExpression79,List80,Last82,PgSelectSingle83,PgCursor84,PgClassExpression86,List87,Access89,PgSelect92,First93,PgSelectSingle94,PgClassExpression95 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ70ᐳ[98]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item98,PgSelectSingle99 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 99<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[99]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor100,PgClassExpression101,List102,PgClassExpression104,PgClassExpression105,PgClassExpression106,PgClassExpression107 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
