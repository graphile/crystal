%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection15{{"Connection[15∈0] ➊<br />ᐸ11ᐳ"}}:::plan
    Constant174{{"Constant[174∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda16{{"Lambda[16∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor18["PgValidateParsedCursor[18∈0] ➊"]:::plan
    Constant174 & Lambda16 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 --> Connection15
    Connection68{{"Connection[68∈0] ➊<br />ᐸ66ᐳ"}}:::plan
    Lambda69{{"Lambda[69∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor71["PgValidateParsedCursor[71∈0] ➊"]:::plan
    Constant174 & Lambda69 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 --> Connection68
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access12
    __Value2 --> Access13
    Constant175{{"Constant[175∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant175 --> Lambda16
    Lambda16 --> PgValidateParsedCursor18
    Constant176{{"Constant[176∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant176 --> Lambda69
    Lambda69 --> PgValidateParsedCursor71
    Lambda117{{"Lambda[117∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant183{{"Constant[183∈0] ➊<br />ᐸ§{ first: 2, last: null, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant183 --> Lambda117
    Lambda120{{"Lambda[120∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant184{{"Constant[184∈0] ➊<br />ᐸ§{ cursorLower: null, cursorUpper: null, first: 2, last: nulᐳ"}}:::plan
    Constant184 --> Lambda120
    Lambda133{{"Lambda[133∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant177{{"Constant[177∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant177 --> Lambda133
    Lambda135{{"Lambda[135∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant178{{"Constant[178∈0] ➊<br />ᐸ§{ cursorLower: null, cursorUpper: null, first: null, last: ᐳ"}}:::plan
    Constant178 --> Lambda135
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Constant121{{"Constant[121∈0] ➊<br />ᐸ[ { codec: { name: 'int4', sqlType: [Object], fromPg: [Functᐳ"}}:::plan
    Constant122{{"Constant[122∈0] ➊<br />ᐸ{ s: Symbol(person), n: 'person', [Symbol(pg-sql2-type-1)]: ᐳ"}}:::plan
    Constant123{{"Constant[123∈0] ➊<br />ᐸ{ name: 'person', sqlType: { t: '”c”.”person”', [Symbol(pg-sᐳ"}}:::plan
    Constant136{{"Constant[136∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant150{{"Constant[150∈0] ➊<br />ᐸ[ { codec: { name: 'int4', sqlType: [Object], fromPg: [Functᐳ"}}:::plan
    Constant164{{"Constant[164∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant179{{"Constant[179∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: [Object], fragment: [Oᐳ"}}:::plan
    Constant180{{"Constant[180∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: { s: Symbol(person), nᐳ"}}:::plan
    Constant181{{"Constant[181∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: [Object], fragment: [Oᐳ"}}:::plan
    Constant182{{"Constant[182∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: { s: Symbol(person), nᐳ"}}:::plan
    PgSelect17[["PgSelect[17∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access19{{"Access[19∈1] ➊<br />ᐸ16.1ᐳ"}}:::plan
    Lambda125{{"Lambda[125∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda131{{"Lambda[131∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object14 & Connection15 & Lambda16 & Constant174 & Access19 & Lambda117 & Lambda120 & Lambda125 & Lambda131 --> PgSelect17
    PgSelect46[["PgSelect[46∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Lambda140{{"Lambda[140∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda145{{"Lambda[145∈1] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object14 & Connection15 & Lambda133 & Lambda135 & Lambda140 & Lambda145 --> PgSelect46
    Object43{{"Object[43∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access37{{"Access[37∈1] ➊<br />ᐸ17.hasMoreᐳ"}}:::plan
    Constant174 & Constant7 & Constant7 & Access37 --> Object43
    Object124{{"Object[124∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda117 & Constant121 & Constant122 & Constant123 --> Object124
    Object139{{"Object[139∈1] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda133 & Constant136 & Constant122 & Constant123 --> Object139
    Object38{{"Object[38∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant174 & Constant7 & Access37 --> Object38
    Lambda16 --> Access19
    PgPageInfo20{{"PgPageInfo[20∈1] ➊"}}:::plan
    Connection15 --> PgPageInfo20
    First22{{"First[22∈1] ➊"}}:::plan
    PgSelect17 --> First22
    PgSelectSingle23{{"PgSelectSingle[23∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First22 --> PgSelectSingle23
    PgCursor24{{"PgCursor[24∈1] ➊"}}:::plan
    List27{{"List[27∈1] ➊<br />ᐸ26ᐳ"}}:::plan
    List27 --> PgCursor24
    PgClassExpression26{{"PgClassExpression[26∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle23 --> PgClassExpression26
    PgClassExpression26 --> List27
    Last29{{"Last[29∈1] ➊"}}:::plan
    PgSelect17 --> Last29
    PgSelectSingle30{{"PgSelectSingle[30∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Last29 --> PgSelectSingle30
    PgCursor31{{"PgCursor[31∈1] ➊"}}:::plan
    List34{{"List[34∈1] ➊<br />ᐸ33ᐳ"}}:::plan
    List34 --> PgCursor31
    PgClassExpression33{{"PgClassExpression[33∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression33
    PgClassExpression33 --> List34
    PgSelect17 --> Access37
    Lambda39{{"Lambda[39∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object38 --> Lambda39
    Lambda44{{"Lambda[44∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object43 --> Lambda44
    First47{{"First[47∈1] ➊"}}:::plan
    PgSelect46 --> First47
    PgSelectSingle48{{"PgSelectSingle[48∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First47 --> PgSelectSingle48
    PgClassExpression49{{"PgClassExpression[49∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression49
    Object124 --> Lambda125
    Constant179 --> Lambda131
    Object139 --> Lambda140
    Constant180 --> Lambda145
    __Item52[/"__Item[52∈2]<br />ᐸ17ᐳ"\]:::itemplan
    PgSelect17 ==> __Item52
    PgSelectSingle53{{"PgSelectSingle[53∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item52 --> PgSelectSingle53
    PgCursor54{{"PgCursor[54∈3]"}}:::plan
    List56{{"List[56∈3]<br />ᐸ55ᐳ"}}:::plan
    List56 --> PgCursor54
    PgClassExpression55{{"PgClassExpression[55∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression55
    PgClassExpression55 --> List56
    PgClassExpression58{{"PgClassExpression[58∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression59
    PgClassExpression60{{"PgClassExpression[60∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression61
    PgSelect70[["PgSelect[70∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access72{{"Access[72∈4] ➊<br />ᐸ69.1ᐳ"}}:::plan
    Lambda154{{"Lambda[154∈4] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda159{{"Lambda[159∈4] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object14 & Connection68 & Lambda69 & Constant174 & Access72 & Lambda117 & Lambda120 & Lambda154 & Lambda159 --> PgSelect70
    PgSelect99[["PgSelect[99∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Lambda168{{"Lambda[168∈4] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda173{{"Lambda[173∈4] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object14 & Connection68 & Lambda133 & Lambda135 & Lambda168 & Lambda173 --> PgSelect99
    Object96{{"Object[96∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access90{{"Access[90∈4] ➊<br />ᐸ70.hasMoreᐳ"}}:::plan
    Constant174 & Constant7 & Constant7 & Access90 --> Object96
    Object153{{"Object[153∈4] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda117 & Constant150 & Constant122 & Constant123 --> Object153
    Object167{{"Object[167∈4] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda133 & Constant164 & Constant122 & Constant123 --> Object167
    Object91{{"Object[91∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant174 & Constant7 & Access90 --> Object91
    Lambda69 --> Access72
    PgPageInfo73{{"PgPageInfo[73∈4] ➊"}}:::plan
    Connection68 --> PgPageInfo73
    First75{{"First[75∈4] ➊"}}:::plan
    PgSelect70 --> First75
    PgSelectSingle76{{"PgSelectSingle[76∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First75 --> PgSelectSingle76
    PgCursor77{{"PgCursor[77∈4] ➊"}}:::plan
    List80{{"List[80∈4] ➊<br />ᐸ79ᐳ"}}:::plan
    List80 --> PgCursor77
    PgClassExpression79{{"PgClassExpression[79∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression79
    PgClassExpression79 --> List80
    Last82{{"Last[82∈4] ➊"}}:::plan
    PgSelect70 --> Last82
    PgSelectSingle83{{"PgSelectSingle[83∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Last82 --> PgSelectSingle83
    PgCursor84{{"PgCursor[84∈4] ➊"}}:::plan
    List87{{"List[87∈4] ➊<br />ᐸ86ᐳ"}}:::plan
    List87 --> PgCursor84
    PgClassExpression86{{"PgClassExpression[86∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression86
    PgClassExpression86 --> List87
    PgSelect70 --> Access90
    Lambda92{{"Lambda[92∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object91 --> Lambda92
    Lambda97{{"Lambda[97∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object96 --> Lambda97
    First100{{"First[100∈4] ➊"}}:::plan
    PgSelect99 --> First100
    PgSelectSingle101{{"PgSelectSingle[101∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First100 --> PgSelectSingle101
    PgClassExpression102{{"PgClassExpression[102∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression102
    Object153 --> Lambda154
    Constant181 --> Lambda159
    Object167 --> Lambda168
    Constant182 --> Lambda173
    __Item105[/"__Item[105∈5]<br />ᐸ70ᐳ"\]:::itemplan
    PgSelect70 ==> __Item105
    PgSelectSingle106{{"PgSelectSingle[106∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item105 --> PgSelectSingle106
    PgCursor107{{"PgCursor[107∈6]"}}:::plan
    List109{{"List[109∈6]<br />ᐸ108ᐳ"}}:::plan
    List109 --> PgCursor107
    PgClassExpression108{{"PgClassExpression[108∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression108
    PgClassExpression108 --> List109
    PgClassExpression111{{"PgClassExpression[111∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression111
    PgClassExpression112{{"PgClassExpression[112∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression112
    PgClassExpression113{{"PgClassExpression[113∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression113
    PgClassExpression114{{"PgClassExpression[114∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression114

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 12, 13, 121, 122, 123, 136, 150, 164, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 14, 16, 69, 117, 120, 133, 135<br />2: 18, 71<br />ᐳ: Connection[15], Connection[68]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access12,Access13,Object14,Connection15,Lambda16,PgValidateParsedCursor18,Connection68,Lambda69,PgValidateParsedCursor71,Lambda117,Lambda120,Constant121,Constant122,Constant123,Lambda133,Lambda135,Constant136,Constant150,Constant164,Constant174,Constant175,Constant176,Constant177,Constant178,Constant179,Constant180,Constant181,Constant182,Constant183,Constant184 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 15, 16, 174, 117, 120, 7, 133, 135, 121, 122, 123, 179, 136, 180<br /><br />ROOT Connectionᐸ11ᐳ[15]<br />1: <br />ᐳ: 19, 20, 124, 131, 139, 145, 125, 140<br />2: PgSelect[17], PgSelect[46]<br />ᐳ: 22, 23, 26, 27, 29, 30, 33, 34, 37, 38, 39, 43, 44, 47, 48, 49, 24, 31"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect17,Access19,PgPageInfo20,First22,PgSelectSingle23,PgCursor24,PgClassExpression26,List27,Last29,PgSelectSingle30,PgCursor31,PgClassExpression33,List34,Access37,Object38,Lambda39,Object43,Lambda44,PgSelect46,First47,PgSelectSingle48,PgClassExpression49,Object124,Lambda125,Lambda131,Object139,Lambda140,Lambda145 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ17ᐳ[52]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item52,PgSelectSingle53 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 53<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[53]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor54,PgClassExpression55,List56,PgClassExpression58,PgClassExpression59,PgClassExpression60,PgClassExpression61 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 14, 68, 69, 174, 117, 120, 7, 133, 135, 150, 122, 123, 181, 164, 182<br /><br />ROOT Connectionᐸ66ᐳ[68]<br />1: <br />ᐳ: 72, 73, 153, 159, 167, 173, 154, 168<br />2: PgSelect[70], PgSelect[99]<br />ᐳ: 75, 76, 79, 80, 82, 83, 86, 87, 90, 91, 92, 96, 97, 100, 101, 102, 77, 84"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect70,Access72,PgPageInfo73,First75,PgSelectSingle76,PgCursor77,PgClassExpression79,List80,Last82,PgSelectSingle83,PgCursor84,PgClassExpression86,List87,Access90,Object91,Lambda92,Object96,Lambda97,PgSelect99,First100,PgSelectSingle101,PgClassExpression102,Object153,Lambda154,Lambda159,Object167,Lambda168,Lambda173 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ70ᐳ[105]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item105,PgSelectSingle106 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 106<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[106]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor107,PgClassExpression108,List109,PgClassExpression111,PgClassExpression112,PgClassExpression113,PgClassExpression114 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
