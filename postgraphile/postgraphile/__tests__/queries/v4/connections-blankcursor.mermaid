%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    Constant126{{"Constant[126∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor21["PgValidateParsedCursor[21∈0] ➊"]:::plan
    Constant126 & Lambda19 & PgValidateParsedCursor21 & PgValidateParsedCursor21 & PgValidateParsedCursor21 & PgValidateParsedCursor21 & PgValidateParsedCursor21 & PgValidateParsedCursor21 --> Connection18
    Connection77{{"Connection[77∈0] ➊<br />ᐸ75ᐳ"}}:::plan
    Lambda78{{"Lambda[78∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor80["PgValidateParsedCursor[80∈0] ➊"]:::plan
    Constant126 & Lambda78 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 & PgValidateParsedCursor80 --> Connection77
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    Constant127{{"Constant[127∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant127 --> Lambda19
    Lambda19 --> PgValidateParsedCursor21
    Constant129{{"Constant[129∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant129 --> Lambda78
    Lambda78 --> PgValidateParsedCursor80
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    PgSelect20[["PgSelect[20∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access22{{"Access[22∈1] ➊<br />ᐸ19.1ᐳ"}}:::plan
    Object17 & Connection18 & Lambda19 & Access22 --> PgSelect20
    Object48{{"Object[48∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access40{{"Access[40∈1] ➊<br />ᐸ20.hasMoreᐳ"}}:::plan
    Constant126 & Constant7 & Constant7 & Access40 --> Object48
    Object41{{"Object[41∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant126 & Constant7 & Access40 --> Object41
    PgSelect51[["PgSelect[51∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection18 --> PgSelect51
    Lambda19 --> Access22
    PgPageInfo23{{"PgPageInfo[23∈1] ➊"}}:::plan
    Connection18 --> PgPageInfo23
    First25{{"First[25∈1] ➊"}}:::plan
    PgSelect20 --> First25
    PgSelectSingle26{{"PgSelectSingle[26∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First25 --> PgSelectSingle26
    PgCursor27{{"PgCursor[27∈1] ➊"}}:::plan
    List30{{"List[30∈1] ➊<br />ᐸ29ᐳ"}}:::plan
    List30 --> PgCursor27
    PgClassExpression29{{"PgClassExpression[29∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression29
    PgClassExpression29 --> List30
    Last32{{"Last[32∈1] ➊"}}:::plan
    PgSelect20 --> Last32
    PgSelectSingle33{{"PgSelectSingle[33∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Last32 --> PgSelectSingle33
    PgCursor34{{"PgCursor[34∈1] ➊"}}:::plan
    List37{{"List[37∈1] ➊<br />ᐸ36ᐳ"}}:::plan
    List37 --> PgCursor34
    PgClassExpression36{{"PgClassExpression[36∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression36
    PgClassExpression36 --> List37
    PgSelect20 --> Access40
    Lambda42{{"Lambda[42∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object41 --> Lambda42
    Lambda49{{"Lambda[49∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object48 --> Lambda49
    First52{{"First[52∈1] ➊"}}:::plan
    PgSelect51 --> First52
    PgSelectSingle53{{"PgSelectSingle[53∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First52 --> PgSelectSingle53
    PgClassExpression54{{"PgClassExpression[54∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression54
    __Item57[/"__Item[57∈2]<br />ᐸ20ᐳ"\]:::itemplan
    PgSelect20 ==> __Item57
    PgSelectSingle58{{"PgSelectSingle[58∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item57 --> PgSelectSingle58
    PgCursor59{{"PgCursor[59∈3]"}}:::plan
    List61{{"List[61∈3]<br />ᐸ60ᐳ"}}:::plan
    List61 --> PgCursor59
    PgClassExpression60{{"PgClassExpression[60∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression60
    PgClassExpression60 --> List61
    PgClassExpression63{{"PgClassExpression[63∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression63
    PgClassExpression64{{"PgClassExpression[64∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression64
    PgClassExpression65{{"PgClassExpression[65∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression65
    PgClassExpression66{{"PgClassExpression[66∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression66
    PgSelect79[["PgSelect[79∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access81{{"Access[81∈4] ➊<br />ᐸ78.1ᐳ"}}:::plan
    Object17 & Connection77 & Lambda78 & Access81 --> PgSelect79
    Object107{{"Object[107∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access99{{"Access[99∈4] ➊<br />ᐸ79.hasMoreᐳ"}}:::plan
    Constant126 & Constant7 & Constant7 & Access99 --> Object107
    Object100{{"Object[100∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant126 & Constant7 & Access99 --> Object100
    PgSelect110[["PgSelect[110∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection77 --> PgSelect110
    Lambda78 --> Access81
    PgPageInfo82{{"PgPageInfo[82∈4] ➊"}}:::plan
    Connection77 --> PgPageInfo82
    First84{{"First[84∈4] ➊"}}:::plan
    PgSelect79 --> First84
    PgSelectSingle85{{"PgSelectSingle[85∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First84 --> PgSelectSingle85
    PgCursor86{{"PgCursor[86∈4] ➊"}}:::plan
    List89{{"List[89∈4] ➊<br />ᐸ88ᐳ"}}:::plan
    List89 --> PgCursor86
    PgClassExpression88{{"PgClassExpression[88∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle85 --> PgClassExpression88
    PgClassExpression88 --> List89
    Last91{{"Last[91∈4] ➊"}}:::plan
    PgSelect79 --> Last91
    PgSelectSingle92{{"PgSelectSingle[92∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Last91 --> PgSelectSingle92
    PgCursor93{{"PgCursor[93∈4] ➊"}}:::plan
    List96{{"List[96∈4] ➊<br />ᐸ95ᐳ"}}:::plan
    List96 --> PgCursor93
    PgClassExpression95{{"PgClassExpression[95∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle92 --> PgClassExpression95
    PgClassExpression95 --> List96
    PgSelect79 --> Access99
    Lambda101{{"Lambda[101∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object100 --> Lambda101
    Lambda108{{"Lambda[108∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object107 --> Lambda108
    First111{{"First[111∈4] ➊"}}:::plan
    PgSelect110 --> First111
    PgSelectSingle112{{"PgSelectSingle[112∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First111 --> PgSelectSingle112
    PgClassExpression113{{"PgClassExpression[113∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression113
    __Item116[/"__Item[116∈5]<br />ᐸ79ᐳ"\]:::itemplan
    PgSelect79 ==> __Item116
    PgSelectSingle117{{"PgSelectSingle[117∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item116 --> PgSelectSingle117
    PgCursor118{{"PgCursor[118∈6]"}}:::plan
    List120{{"List[120∈6]<br />ᐸ119ᐳ"}}:::plan
    List120 --> PgCursor118
    PgClassExpression119{{"PgClassExpression[119∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression119
    PgClassExpression119 --> List120
    PgClassExpression122{{"PgClassExpression[122∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression122
    PgClassExpression123{{"PgClassExpression[123∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression123
    PgClassExpression124{{"PgClassExpression[124∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression124
    PgClassExpression125{{"PgClassExpression[125∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression125

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 15, 16, 126, 127, 129, 17, 19, 78<br />2: 21, 80<br />ᐳ: Connection[18], Connection[77]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access15,Access16,Object17,Connection18,Lambda19,PgValidateParsedCursor21,Connection77,Lambda78,PgValidateParsedCursor80,Constant126,Constant127,Constant129 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18, 19, 126, 7<br /><br />ROOT Connectionᐸ14ᐳ[18]<br />1: PgSelect[51]<br />ᐳ: 22, 23, 52, 53, 54<br />2: PgSelect[20]<br />ᐳ: 25, 26, 29, 30, 32, 33, 36, 37, 40, 41, 42, 48, 49, 27, 34"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect20,Access22,PgPageInfo23,First25,PgSelectSingle26,PgCursor27,PgClassExpression29,List30,Last32,PgSelectSingle33,PgCursor34,PgClassExpression36,List37,Access40,Object41,Lambda42,Object48,Lambda49,PgSelect51,First52,PgSelectSingle53,PgClassExpression54 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ20ᐳ[57]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item57,PgSelectSingle58 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 58<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[58]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor59,PgClassExpression60,List61,PgClassExpression63,PgClassExpression64,PgClassExpression65,PgClassExpression66 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 17, 77, 78, 126, 7<br /><br />ROOT Connectionᐸ75ᐳ[77]<br />1: PgSelect[110]<br />ᐳ: 81, 82, 111, 112, 113<br />2: PgSelect[79]<br />ᐳ: 84, 85, 88, 89, 91, 92, 95, 96, 99, 100, 101, 107, 108, 86, 93"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect79,Access81,PgPageInfo82,First84,PgSelectSingle85,PgCursor86,PgClassExpression88,List89,Last91,PgSelectSingle92,PgCursor93,PgClassExpression95,List96,Access99,Object100,Lambda101,Object107,Lambda108,PgSelect110,First111,PgSelectSingle112,PgClassExpression113 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ79ᐳ[116]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item116,PgSelectSingle117 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 117<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[117]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor118,PgClassExpression119,List120,PgClassExpression122,PgClassExpression123,PgClassExpression124,PgClassExpression125 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
