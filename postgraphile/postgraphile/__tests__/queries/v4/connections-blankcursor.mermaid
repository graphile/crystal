%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    Connection15{{"Connection[15∈0] ➊<br />ᐸ11ᐳ"}}:::plan
    Constant105{{"Constant[105∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda17{{"Lambda[17∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant105 & Lambda17 --> Connection15
    Connection63{{"Connection[63∈0] ➊<br />ᐸ61ᐳ"}}:::plan
    Lambda65{{"Lambda[65∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant105 & Lambda65 --> Connection63
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access12
    __Value2 --> Access13
    Lambda16{{"Lambda[16∈0] ➊<br />ᐸextractList_grafast_pgSelectApplyᐳ"}}:::plan
    Constant111{{"Constant[111∈0] ➊<br />ᐸ[ 'PRIMARY_KEY_ASC' ]ᐳ"}}:::plan
    Constant111 --> Lambda16
    Constant106{{"Constant[106∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant106 --> Lambda17
    Constant109{{"Constant[109∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant109 --> Lambda65
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    PgSelect18[["PgSelect[18∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Lambda16 & Connection15 & Lambda17 & Constant105 --> PgSelect18
    Object39{{"Object[39∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access34{{"Access[34∈1] ➊<br />ᐸ18.hasMoreᐳ"}}:::plan
    Constant105 & Constant7 & Constant7 & Access34 --> Object39
    Object35{{"Object[35∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant105 & Constant7 & Access34 --> Object35
    PgSelect41[["PgSelect[41∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Lambda16 & Connection15 --> PgSelect41
    PgCursor25{{"PgCursor[25∈1] ➊"}}:::plan
    PgSelectSingle23{{"PgSelectSingle[23∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Access24{{"Access[24∈1] ➊<br />ᐸ18.cursorDetailsᐳ"}}:::plan
    PgSelectSingle23 & Access24 --> PgCursor25
    PgCursor31{{"PgCursor[31∈1] ➊"}}:::plan
    PgSelectSingle29{{"PgSelectSingle[29∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle29 & Access24 --> PgCursor31
    PgPageInfo19{{"PgPageInfo[19∈1] ➊"}}:::plan
    Connection15 --> PgPageInfo19
    First21{{"First[21∈1] ➊"}}:::plan
    PgSelectRows22[["PgSelectRows[22∈1] ➊"]]:::plan
    PgSelectRows22 --> First21
    PgSelect18 --> PgSelectRows22
    First21 --> PgSelectSingle23
    PgSelect18 --> Access24
    Last27{{"Last[27∈1] ➊"}}:::plan
    PgSelectRows22 --> Last27
    Last27 --> PgSelectSingle29
    PgSelect18 --> Access34
    Lambda36{{"Lambda[36∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object35 --> Lambda36
    Lambda40{{"Lambda[40∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object39 --> Lambda40
    First42{{"First[42∈1] ➊"}}:::plan
    PgSelectRows43[["PgSelectRows[43∈1] ➊"]]:::plan
    PgSelectRows43 --> First42
    PgSelect41 --> PgSelectRows43
    PgSelectSingle44{{"PgSelectSingle[44∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First42 --> PgSelectSingle44
    PgClassExpression45{{"PgClassExpression[45∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression45
    __Item48[/"__Item[48∈2]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelectRows22 ==> __Item48
    PgSelectSingle49{{"PgSelectSingle[49∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item48 --> PgSelectSingle49
    PgCursor51{{"PgCursor[51∈3]"}}:::plan
    PgSelectSingle49 & Access24 --> PgCursor51
    PgClassExpression52{{"PgClassExpression[52∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression52
    PgClassExpression53{{"PgClassExpression[53∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression54
    PgClassExpression55{{"PgClassExpression[55∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression56
    PgSelect66[["PgSelect[66∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Lambda16 & Connection63 & Lambda65 & Constant105 --> PgSelect66
    Object87{{"Object[87∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access82{{"Access[82∈4] ➊<br />ᐸ66.hasMoreᐳ"}}:::plan
    Constant105 & Constant7 & Constant7 & Access82 --> Object87
    Object83{{"Object[83∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant105 & Constant7 & Access82 --> Object83
    PgSelect89[["PgSelect[89∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Lambda16 & Connection63 --> PgSelect89
    PgCursor73{{"PgCursor[73∈4] ➊"}}:::plan
    PgSelectSingle71{{"PgSelectSingle[71∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Access72{{"Access[72∈4] ➊<br />ᐸ66.cursorDetailsᐳ"}}:::plan
    PgSelectSingle71 & Access72 --> PgCursor73
    PgCursor79{{"PgCursor[79∈4] ➊"}}:::plan
    PgSelectSingle77{{"PgSelectSingle[77∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle77 & Access72 --> PgCursor79
    PgPageInfo67{{"PgPageInfo[67∈4] ➊"}}:::plan
    Connection63 --> PgPageInfo67
    First69{{"First[69∈4] ➊"}}:::plan
    PgSelectRows70[["PgSelectRows[70∈4] ➊"]]:::plan
    PgSelectRows70 --> First69
    PgSelect66 --> PgSelectRows70
    First69 --> PgSelectSingle71
    PgSelect66 --> Access72
    Last75{{"Last[75∈4] ➊"}}:::plan
    PgSelectRows70 --> Last75
    Last75 --> PgSelectSingle77
    PgSelect66 --> Access82
    Lambda84{{"Lambda[84∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object83 --> Lambda84
    Lambda88{{"Lambda[88∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object87 --> Lambda88
    First90{{"First[90∈4] ➊"}}:::plan
    PgSelectRows91[["PgSelectRows[91∈4] ➊"]]:::plan
    PgSelectRows91 --> First90
    PgSelect89 --> PgSelectRows91
    PgSelectSingle92{{"PgSelectSingle[92∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First90 --> PgSelectSingle92
    PgClassExpression93{{"PgClassExpression[93∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle92 --> PgClassExpression93
    __Item96[/"__Item[96∈5]<br />ᐸ70ᐳ"\]:::itemplan
    PgSelectRows70 ==> __Item96
    PgSelectSingle97{{"PgSelectSingle[97∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item96 --> PgSelectSingle97
    PgCursor99{{"PgCursor[99∈6]"}}:::plan
    PgSelectSingle97 & Access72 --> PgCursor99
    PgClassExpression100{{"PgClassExpression[100∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression100
    PgClassExpression101{{"PgClassExpression[101∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression101
    PgClassExpression102{{"PgClassExpression[102∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression102
    PgClassExpression103{{"PgClassExpression[103∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression103
    PgClassExpression104{{"PgClassExpression[104∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression104

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access12,Access13,Object14,Connection15,Lambda16,Lambda17,Connection63,Lambda65,Constant105,Constant106,Constant109,Constant111 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 16, 15, 17, 105, 7<br /><br />ROOT Connectionᐸ11ᐳ[15]<br />1: PgSelect[18], PgSelect[41]<br />ᐳ: 19, 24, 34, 35, 36, 39, 40<br />2: PgSelectRows[22], PgSelectRows[43]<br />ᐳ: 21, 23, 25, 27, 29, 31, 42, 44, 45"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect18,PgPageInfo19,First21,PgSelectRows22,PgSelectSingle23,Access24,PgCursor25,Last27,PgSelectSingle29,PgCursor31,Access34,Object35,Lambda36,Object39,Lambda40,PgSelect41,First42,PgSelectRows43,PgSelectSingle44,PgClassExpression45 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 24<br /><br />ROOT __Item{2}ᐸ22ᐳ[48]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item48,PgSelectSingle49 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 49, 24<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[49]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor51,PgClassExpression52,PgClassExpression53,PgClassExpression54,PgClassExpression55,PgClassExpression56 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 14, 16, 63, 65, 105, 7<br /><br />ROOT Connectionᐸ61ᐳ[63]<br />1: PgSelect[66], PgSelect[89]<br />ᐳ: 67, 72, 82, 83, 84, 87, 88<br />2: PgSelectRows[70], PgSelectRows[91]<br />ᐳ: 69, 71, 73, 75, 77, 79, 90, 92, 93"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect66,PgPageInfo67,First69,PgSelectRows70,PgSelectSingle71,Access72,PgCursor73,Last75,PgSelectSingle77,PgCursor79,Access82,Object83,Lambda84,Object87,Lambda88,PgSelect89,First90,PgSelectRows91,PgSelectSingle92,PgClassExpression93 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 72<br /><br />ROOT __Item{5}ᐸ70ᐳ[96]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item96,PgSelectSingle97 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 97, 72<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[97]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor99,PgClassExpression100,PgClassExpression101,PgClassExpression102,PgClassExpression103,PgClassExpression104 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
