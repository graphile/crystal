%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/relay/defaultNodeIdCodec.Query.node"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (polymorphic)<br />__typename: Lambda[10]<br />Deps: 2, 9, 10, 72, 74, 78, 82, 86, 90, 94, 4"):::bucket
    Bucket2("Bucket 2 (polymorphicPartition)<br />|Query<br />Deps: 72, 4<br />ᐳQuery"):::bucket
    Bucket3("Bucket 3 (polymorphicPartition)<br />|Post<br />Deps: 18, 100, 74<br />ᐳPost<br /><br />1: PgSelect[15]<br />2: PgSelectRows[20]<br />ᐳ: 19, 21, 75, 76, 77"):::bucket
    Bucket4("Bucket 4 (polymorphicPartition)<br />|Person<br />Deps: 18, 100, 78<br />ᐳPerson<br /><br />1: PgSelect[25]<br />2: PgSelectRows[30]<br />ᐳ: 29, 31, 79, 80, 81, 98, 99"):::bucket
    Bucket5("Bucket 5 (polymorphicPartition)<br />|Film<br />Deps: 18, 100, 82<br />ᐳFilm<br /><br />1: PgSelect[35]<br />2: PgSelectRows[40]<br />ᐳ: 39, 41, 83, 84, 85"):::bucket
    Bucket6("Bucket 6 (polymorphicPartition)<br />|Studio<br />Deps: 18, 100, 86<br />ᐳStudio<br /><br />1: PgSelect[45]<br />2: PgSelectRows[50]<br />ᐳ: 49, 51, 87, 88, 89"):::bucket
    Bucket7("Bucket 7 (polymorphicPartition)<br />|TvShow<br />Deps: 18, 100, 90<br />ᐳTvShow<br /><br />1: PgSelect[55]<br />2: PgSelectRows[60]<br />ᐳ: 59, 61, 91, 92, 93"):::bucket
    Bucket8("Bucket 8 (polymorphicPartition)<br />|TvEpisode<br />Deps: 18, 100, 94<br />ᐳTvEpisode<br /><br />1: PgSelect[65]<br />2: PgSelectRows[70]<br />ᐳ: 69, 71, 95, 96, 97"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6 & Bucket7 & Bucket8

    %% plan dependencies
    Access6{{"Access[6∈0] ➊<br />ᐸ0.aliceᐳ"}}:::plan
    __Value0["__Value[0∈0] ➊<br />ᐸvariableValuesᐳ"]:::plan
    __Value0 --> Access6
    Lambda9{{"Lambda[9∈0] ➊<br />ᐸdecodeNodeIdWithCodecsᐳ<br />Dependents: 2"}}:::plan
    Access6 -->|rejectNull| Lambda9
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    Object18{{"Object[18∈1] ➊^<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈1] ➊<br />ᐸ2.pgSettingsᐳ<br />ᐳPost<br />ᐳPerson<br />ᐳFilm<br />ᐳStudio<br />ᐳTvShow<br />ᐳTvEpisode"}}:::plan
    Access17{{"Access[17∈1] ➊<br />ᐸ2.withPgClientᐳ<br />ᐳPost<br />ᐳPerson<br />ᐳFilm<br />ᐳStudio<br />ᐳTvShow<br />ᐳTvEpisode"}}:::plan
    Access16 & Access17 --> Object18
    __Value2 --> Access16
    __Value2 --> Access17
    Access100{{"Access[100∈1] ➊<br />ᐸ9.pipeString.1ᐳ<br />ᐳPost<br />ᐳPerson<br />ᐳFilm<br />ᐳStudio<br />ᐳTvShow<br />ᐳTvEpisode<br />More deps:<br />- Lambda[9]"}}:::plan
    Lambda73{{"Lambda[73∈2] ➊<br />ᐸrawEncodeᐳ<br />ᐳQuery<br />More deps:<br />- Constantᐸ'query'ᐳ[72]"}}:::plan
    PgSelect15[["PgSelect[15∈3] ➊<br />ᐸpostᐳ<br />ᐳPost"]]:::plan
    Access100 -->|rejectNull| PgSelect15
    Object18 --> PgSelect15
    List76{{"List[76∈3] ➊^<br />ᐸ74,75ᐳ<br />More deps:<br />- Constantᐸ'posts'ᐳ[74]"}}:::plan
    PgClassExpression75{{"PgClassExpression[75∈3] ➊^<br />ᐸ__post__.”id”ᐳ"}}:::plan
    PgClassExpression75 --> List76
    First19{{"First[19∈3] ➊^"}}:::plan
    PgSelectRows20[["PgSelectRows[20∈3] ➊^"]]:::plan
    PgSelectRows20 --> First19
    PgSelect15 --> PgSelectRows20
    PgSelectSingle21{{"PgSelectSingle[21∈3] ➊^<br />ᐸpostᐳ"}}:::plan
    First19 --> PgSelectSingle21
    PgSelectSingle21 --> PgClassExpression75
    Lambda77{{"Lambda[77∈3] ➊^<br />ᐸpipeStringEncodeᐳ"}}:::plan
    List76 --> Lambda77
    PgSelect25[["PgSelect[25∈4] ➊<br />ᐸpersonᐳ<br />ᐳPerson"]]:::plan
    Access100 -->|rejectNull| PgSelect25
    Object18 --> PgSelect25
    List80{{"List[80∈4] ➊^<br />ᐸ78,79ᐳ<br />More deps:<br />- Constantᐸ'people'ᐳ[78]"}}:::plan
    PgClassExpression79{{"PgClassExpression[79∈4] ➊^<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgClassExpression79 --> List80
    First29{{"First[29∈4] ➊^"}}:::plan
    PgSelectRows30[["PgSelectRows[30∈4] ➊^"]]:::plan
    PgSelectRows30 --> First29
    PgSelect25 --> PgSelectRows30
    PgSelectSingle31{{"PgSelectSingle[31∈4] ➊^<br />ᐸpersonᐳ"}}:::plan
    First29 --> PgSelectSingle31
    PgSelectSingle31 --> PgClassExpression79
    Lambda81{{"Lambda[81∈4] ➊^<br />ᐸpipeStringEncodeᐳ"}}:::plan
    List80 --> Lambda81
    PgClassExpression98{{"PgClassExpression[98∈4] ➊^<br />ᐸ__person__.”first_name”ᐳ"}}:::plan
    PgSelectSingle31 --> PgClassExpression98
    PgClassExpression99{{"PgClassExpression[99∈4] ➊^<br />ᐸ__person__.”last_name”ᐳ"}}:::plan
    PgClassExpression98 o--o PgClassExpression99
    PgSelect35[["PgSelect[35∈5] ➊<br />ᐸfilmsᐳ<br />ᐳFilm"]]:::plan
    Access100 -->|rejectNull| PgSelect35
    Object18 --> PgSelect35
    List84{{"List[84∈5] ➊^<br />ᐸ82,83ᐳ<br />More deps:<br />- Constantᐸ'films'ᐳ[82]"}}:::plan
    PgClassExpression83{{"PgClassExpression[83∈5] ➊^<br />ᐸ__films__.”code”ᐳ"}}:::plan
    PgClassExpression83 --> List84
    First39{{"First[39∈5] ➊^"}}:::plan
    PgSelectRows40[["PgSelectRows[40∈5] ➊^"]]:::plan
    PgSelectRows40 --> First39
    PgSelect35 --> PgSelectRows40
    PgSelectSingle41{{"PgSelectSingle[41∈5] ➊^<br />ᐸfilmsᐳ"}}:::plan
    First39 --> PgSelectSingle41
    PgSelectSingle41 --> PgClassExpression83
    Lambda85{{"Lambda[85∈5] ➊^<br />ᐸpipeStringEncodeᐳ"}}:::plan
    List84 --> Lambda85
    PgSelect45[["PgSelect[45∈6] ➊<br />ᐸstudiosᐳ<br />ᐳStudio"]]:::plan
    Access100 -->|rejectNull| PgSelect45
    Object18 --> PgSelect45
    List88{{"List[88∈6] ➊^<br />ᐸ86,87ᐳ<br />More deps:<br />- Constantᐸ'studios'ᐳ[86]"}}:::plan
    PgClassExpression87{{"PgClassExpression[87∈6] ➊^<br />ᐸ__studios__.”id”ᐳ"}}:::plan
    PgClassExpression87 --> List88
    First49{{"First[49∈6] ➊^"}}:::plan
    PgSelectRows50[["PgSelectRows[50∈6] ➊^"]]:::plan
    PgSelectRows50 --> First49
    PgSelect45 --> PgSelectRows50
    PgSelectSingle51{{"PgSelectSingle[51∈6] ➊^<br />ᐸstudiosᐳ"}}:::plan
    First49 --> PgSelectSingle51
    PgSelectSingle51 --> PgClassExpression87
    Lambda89{{"Lambda[89∈6] ➊^<br />ᐸpipeStringEncodeᐳ"}}:::plan
    List88 --> Lambda89
    PgSelect55[["PgSelect[55∈7] ➊<br />ᐸtv_showsᐳ<br />ᐳTvShow"]]:::plan
    Access100 -->|rejectNull| PgSelect55
    Object18 --> PgSelect55
    List92{{"List[92∈7] ➊^<br />ᐸ90,91ᐳ<br />More deps:<br />- Constantᐸ'tv_shows'ᐳ[90]"}}:::plan
    PgClassExpression91{{"PgClassExpression[91∈7] ➊^<br />ᐸ__tv_shows__.”code”ᐳ"}}:::plan
    PgClassExpression91 --> List92
    First59{{"First[59∈7] ➊^"}}:::plan
    PgSelectRows60[["PgSelectRows[60∈7] ➊^"]]:::plan
    PgSelectRows60 --> First59
    PgSelect55 --> PgSelectRows60
    PgSelectSingle61{{"PgSelectSingle[61∈7] ➊^<br />ᐸtv_showsᐳ"}}:::plan
    First59 --> PgSelectSingle61
    PgSelectSingle61 --> PgClassExpression91
    Lambda93{{"Lambda[93∈7] ➊^<br />ᐸpipeStringEncodeᐳ"}}:::plan
    List92 --> Lambda93
    PgSelect65[["PgSelect[65∈8] ➊<br />ᐸtv_episodesᐳ<br />ᐳTvEpisode"]]:::plan
    Access100 -->|rejectNull| PgSelect65
    Object18 --> PgSelect65
    List96{{"List[96∈8] ➊^<br />ᐸ94,95ᐳ<br />More deps:<br />- Constantᐸ'tv_episodes'ᐳ[94]"}}:::plan
    PgClassExpression95{{"PgClassExpression[95∈8] ➊^<br />ᐸ__tv_episodes__.”code”ᐳ"}}:::plan
    PgClassExpression95 --> List96
    First69{{"First[69∈8] ➊^"}}:::plan
    PgSelectRows70[["PgSelectRows[70∈8] ➊^"]]:::plan
    PgSelectRows70 --> First69
    PgSelect65 --> PgSelectRows70
    PgSelectSingle71{{"PgSelectSingle[71∈8] ➊^<br />ᐸtv_episodesᐳ"}}:::plan
    First69 --> PgSelectSingle71
    PgSelectSingle71 --> PgClassExpression95
    Lambda97{{"Lambda[97∈8] ➊^<br />ᐸpipeStringEncodeᐳ"}}:::plan
    List96 --> Lambda97

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value2,Access6,Lambda9 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,Access16,Access17,Object18,Access100 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,Lambda73 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect15,First19,PgSelectRows20,PgSelectSingle21,PgClassExpression75,List76,Lambda77 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect25,First29,PgSelectRows30,PgSelectSingle31,PgClassExpression79,List80,Lambda81,PgClassExpression98,PgClassExpression99 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgSelect35,First39,PgSelectRows40,PgSelectSingle41,PgClassExpression83,List84,Lambda85 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgSelect45,First49,PgSelectRows50,PgSelectSingle51,PgClassExpression87,List88,Lambda89 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,PgSelect55,First59,PgSelectRows60,PgSelectSingle61,PgClassExpression91,List92,Lambda93 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgSelect65,First69,PgSelectRows70,PgSelectSingle71,PgClassExpression95,List96,Lambda97 bucket8

