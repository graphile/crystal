%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect18[["PgSelect[18∈0] ➊<br />ᐸpostᐳ"]]:::plan
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    ApplyInput17{{"ApplyInput[17∈0] ➊"}}:::plan
    Connection15{{"Connection[15∈0] ➊<br />ᐸ11ᐳ"}}:::plan
    ApplyInput17 -->|rejectNull| PgSelect18
    Object14 & Connection15 --> PgSelect18
    PgSelect44[["PgSelect[44∈0] ➊<br />ᐸpostᐳ"]]:::plan
    ApplyInput43{{"ApplyInput[43∈0] ➊"}}:::plan
    Connection41{{"Connection[41∈0] ➊<br />ᐸ39ᐳ"}}:::plan
    ApplyInput43 -->|rejectNull| PgSelect44
    Object14 & Connection41 --> PgSelect44
    PgSelect69[["PgSelect[69∈0] ➊<br />ᐸpostᐳ"]]:::plan
    ApplyInput68{{"ApplyInput[68∈0] ➊"}}:::plan
    Connection66{{"Connection[66∈0] ➊<br />ᐸ64ᐳ"}}:::plan
    ApplyInput68 -->|rejectNull| PgSelect69
    Object14 & Connection66 --> PgSelect69
    PgSelect95[["PgSelect[95∈0] ➊<br />ᐸpostᐳ"]]:::plan
    ApplyInput94{{"ApplyInput[94∈0] ➊"}}:::plan
    Connection92{{"Connection[92∈0] ➊<br />ᐸ90ᐳ"}}:::plan
    ApplyInput94 -->|rejectNull| PgSelect95
    Object14 & Connection92 --> PgSelect95
    __InputObject8{{"__InputObject[8∈0] ➊"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ0.undefinedᐳ"}}:::plan
    Access9 --> __InputObject8
    Access12{{"Access[12∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    __InputObject36{{"__InputObject[36∈0] ➊"}}:::plan
    Access37{{"Access[37∈0] ➊<br />ᐸ0.aliceᐳ"}}:::plan
    Access37 --> __InputObject36
    __InputObject62{{"__InputObject[62∈0] ➊"}}:::plan
    Constant63{{"Constant[63∈0] ➊<br />ᐸnullᐳ"}}:::plan
    Constant63 --> __InputObject62
    __InputObject87{{"__InputObject[87∈0] ➊"}}:::plan
    Access88{{"Access[88∈0] ➊<br />ᐸ0.post3ᐳ"}}:::plan
    Access88 --> __InputObject87
    __Value0["__Value[0∈0] ➊<br />ᐸvariableValuesᐳ"]:::plan
    __Value0 --> Access9
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access12
    __Value2 --> Access13
    __InputObject8 --> ApplyInput17
    PgSelectRows19[["PgSelectRows[19∈0] ➊"]]:::plan
    PgSelect18 --> PgSelectRows19
    __Value0 --> Access37
    __InputObject36 --> ApplyInput43
    PgSelectRows45[["PgSelectRows[45∈0] ➊"]]:::plan
    PgSelect44 --> PgSelectRows45
    __InputObject62 --> ApplyInput68
    PgSelectRows70[["PgSelectRows[70∈0] ➊"]]:::plan
    PgSelect69 --> PgSelectRows70
    __Value0 --> Access88
    __InputObject87 --> ApplyInput94
    PgSelectRows96[["PgSelectRows[96∈0] ➊"]]:::plan
    PgSelect95 --> PgSelectRows96
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant30{{"Constant[30∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    PgSelect23[["PgSelect[23∈1]<br />ᐸpersonᐳ"]]:::plan
    PgClassExpression22{{"PgClassExpression[22∈1]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Object14 & PgClassExpression22 --> PgSelect23
    List32{{"List[32∈1]<br />ᐸ30,31ᐳ"}}:::plan
    PgClassExpression31{{"PgClassExpression[31∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant30 & PgClassExpression31 --> List32
    __Item20[/"__Item[20∈1]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelectRows19 ==> __Item20
    PgSelectSingle21{{"PgSelectSingle[21∈1]<br />ᐸpostᐳ"}}:::plan
    __Item20 --> PgSelectSingle21
    PgSelectSingle21 --> PgClassExpression22
    First27{{"First[27∈1]"}}:::plan
    PgSelectRows28[["PgSelectRows[28∈1]"]]:::plan
    PgSelectRows28 --> First27
    PgSelect23 --> PgSelectRows28
    PgSelectSingle29{{"PgSelectSingle[29∈1]<br />ᐸpersonᐳ"}}:::plan
    First27 --> PgSelectSingle29
    PgSelectSingle29 --> PgClassExpression31
    Lambda33{{"Lambda[33∈1]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List32 --> Lambda33
    PgClassExpression34{{"PgClassExpression[34∈1]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression34
    PgSelect49[["PgSelect[49∈2]<br />ᐸpersonᐳ"]]:::plan
    PgClassExpression48{{"PgClassExpression[48∈2]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Object14 & PgClassExpression48 --> PgSelect49
    List58{{"List[58∈2]<br />ᐸ30,57ᐳ"}}:::plan
    PgClassExpression57{{"PgClassExpression[57∈2]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant30 & PgClassExpression57 --> List58
    __Item46[/"__Item[46∈2]<br />ᐸ45ᐳ"\]:::itemplan
    PgSelectRows45 ==> __Item46
    PgSelectSingle47{{"PgSelectSingle[47∈2]<br />ᐸpostᐳ"}}:::plan
    __Item46 --> PgSelectSingle47
    PgSelectSingle47 --> PgClassExpression48
    First53{{"First[53∈2]"}}:::plan
    PgSelectRows54[["PgSelectRows[54∈2]"]]:::plan
    PgSelectRows54 --> First53
    PgSelect49 --> PgSelectRows54
    PgSelectSingle55{{"PgSelectSingle[55∈2]<br />ᐸpersonᐳ"}}:::plan
    First53 --> PgSelectSingle55
    PgSelectSingle55 --> PgClassExpression57
    Lambda59{{"Lambda[59∈2]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List58 --> Lambda59
    PgClassExpression60{{"PgClassExpression[60∈2]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle47 --> PgClassExpression60
    PgSelect74[["PgSelect[74∈3]<br />ᐸpersonᐳ"]]:::plan
    PgClassExpression73{{"PgClassExpression[73∈3]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Object14 & PgClassExpression73 --> PgSelect74
    List83{{"List[83∈3]<br />ᐸ30,82ᐳ"}}:::plan
    PgClassExpression82{{"PgClassExpression[82∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant30 & PgClassExpression82 --> List83
    __Item71[/"__Item[71∈3]<br />ᐸ70ᐳ"\]:::itemplan
    PgSelectRows70 ==> __Item71
    PgSelectSingle72{{"PgSelectSingle[72∈3]<br />ᐸpostᐳ"}}:::plan
    __Item71 --> PgSelectSingle72
    PgSelectSingle72 --> PgClassExpression73
    First78{{"First[78∈3]"}}:::plan
    PgSelectRows79[["PgSelectRows[79∈3]"]]:::plan
    PgSelectRows79 --> First78
    PgSelect74 --> PgSelectRows79
    PgSelectSingle80{{"PgSelectSingle[80∈3]<br />ᐸpersonᐳ"}}:::plan
    First78 --> PgSelectSingle80
    PgSelectSingle80 --> PgClassExpression82
    Lambda84{{"Lambda[84∈3]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List83 --> Lambda84
    PgClassExpression85{{"PgClassExpression[85∈3]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle72 --> PgClassExpression85
    PgSelect100[["PgSelect[100∈4]<br />ᐸpersonᐳ"]]:::plan
    PgClassExpression99{{"PgClassExpression[99∈4]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Object14 & PgClassExpression99 --> PgSelect100
    List109{{"List[109∈4]<br />ᐸ30,108ᐳ"}}:::plan
    PgClassExpression108{{"PgClassExpression[108∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant30 & PgClassExpression108 --> List109
    __Item97[/"__Item[97∈4]<br />ᐸ96ᐳ"\]:::itemplan
    PgSelectRows96 ==> __Item97
    PgSelectSingle98{{"PgSelectSingle[98∈4]<br />ᐸpostᐳ"}}:::plan
    __Item97 --> PgSelectSingle98
    PgSelectSingle98 --> PgClassExpression99
    First104{{"First[104∈4]"}}:::plan
    PgSelectRows105[["PgSelectRows[105∈4]"]]:::plan
    PgSelectRows105 --> First104
    PgSelect100 --> PgSelectRows105
    PgSelectSingle106{{"PgSelectSingle[106∈4]<br />ᐸpersonᐳ"}}:::plan
    First104 --> PgSelectSingle106
    PgSelectSingle106 --> PgClassExpression108
    Lambda110{{"Lambda[110∈4]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List109 --> Lambda110
    PgClassExpression111{{"PgClassExpression[111∈4]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle98 --> PgClassExpression111

    %% define steps

    subgraph "Buckets for queries/relay/conditionNodeId"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 6, 9, 12, 13, 30, 37, 63, 88, 8, 14, 15, 17, 36, 41, 43, 62, 66, 68, 87, 92, 94<br />2: 18, 44, 69, 95<br />3: 19, 45, 70, 96"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value2,__Value4,__InputObject8,Access9,Access12,Access13,Object14,Connection15,ApplyInput17,PgSelect18,PgSelectRows19,Constant30,__InputObject36,Access37,Connection41,ApplyInput43,PgSelect44,PgSelectRows45,__InputObject62,Constant63,Connection66,ApplyInput68,PgSelect69,PgSelectRows70,__InputObject87,Access88,Connection92,ApplyInput94,PgSelect95,PgSelectRows96 bucket0
    Bucket1("Bucket 1 (listItem)<br />Deps: 14, 30<br /><br />ROOT __Item{1}ᐸ19ᐳ[20]<br />1: <br />ᐳ: 21, 22, 34<br />2: PgSelect[23]<br />3: PgSelectRows[28]<br />ᐳ: 27, 29, 31, 32, 33"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item20,PgSelectSingle21,PgClassExpression22,PgSelect23,First27,PgSelectRows28,PgSelectSingle29,PgClassExpression31,List32,Lambda33,PgClassExpression34 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 14, 30<br /><br />ROOT __Item{2}ᐸ45ᐳ[46]<br />1: <br />ᐳ: 47, 48, 60<br />2: PgSelect[49]<br />3: PgSelectRows[54]<br />ᐳ: 53, 55, 57, 58, 59"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item46,PgSelectSingle47,PgClassExpression48,PgSelect49,First53,PgSelectRows54,PgSelectSingle55,PgClassExpression57,List58,Lambda59,PgClassExpression60 bucket2
    Bucket3("Bucket 3 (listItem)<br />Deps: 14, 30<br /><br />ROOT __Item{3}ᐸ70ᐳ[71]<br />1: <br />ᐳ: 72, 73, 85<br />2: PgSelect[74]<br />3: PgSelectRows[79]<br />ᐳ: 78, 80, 82, 83, 84"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item71,PgSelectSingle72,PgClassExpression73,PgSelect74,First78,PgSelectRows79,PgSelectSingle80,PgClassExpression82,List83,Lambda84,PgClassExpression85 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 14, 30<br /><br />ROOT __Item{4}ᐸ96ᐳ[97]<br />1: <br />ᐳ: 98, 99, 111<br />2: PgSelect[100]<br />3: PgSelectRows[105]<br />ᐳ: 104, 106, 108, 109, 110"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item97,PgSelectSingle98,PgClassExpression99,PgSelect100,First104,PgSelectRows105,PgSelectSingle106,PgClassExpression108,List109,Lambda110,PgClassExpression111 bucket4
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4
    end
