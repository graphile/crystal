%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-vuln-totalCount"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 10, 11, 34, 77, 81, 12<br />2: PgSelect[9]<br />3: Connection[13]<br />4: ConnectionItems[15]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 15, 12, 34, 77<br /><br />ROOT Connectionᐸ9ᐳ[13]"):::bucket
    Bucket3("Bucket 3 (listItem)<br />Deps: 12, 34, 77<br /><br />ROOT __Item{3}ᐸ15ᐳ[18]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 19, 12, 34, 77<br /><br />ROOT PgSelectSingle{3}ᐸpeopleᐳ[19]<br />1: <br />ᐳ: 20, 21<br />2: PgUnionAll[22]<br />3: Connection[26]<br />4: ConnectionItems[27]"):::bucket
    Bucket6("Bucket 6 (listItem)<br />Deps: 34, 12, 77<br /><br />ROOT __Item{6}ᐸ27ᐳ[30]"):::bucket
    Bucket7("Bucket 7 (polymorphic)<br />__typename: Access[38]<br />Deps: 38, 12, 39, 77"):::bucket
    Bucket8("Bucket 8 (polymorphicPartition)<br />|AwsApplication<br />Deps: 12, 39, 77<br />ᐳAwsApplication<br /><br />1: PgSelect[40]<br />2: PgSelectRows[45]<br />ᐳ: 44, 46, 55<br />3: PgUnionAll[67]<br />ᐳ: 78, 68, 71"):::bucket
    Bucket9("Bucket 9 (polymorphicPartition)<br />|GcpApplication<br />Deps: 12, 39, 77<br />ᐳGcpApplication<br /><br />1: PgSelect[48]<br />2: PgSelectRows[53]<br />ᐳ: 52, 54, 61<br />3: PgUnionAll[72]<br />ᐳ: 80, 73, 76"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket6
    Bucket6 --> Bucket7
    Bucket7 --> Bucket8 & Bucket9

    %% plan dependencies
    PgSelect9[["PgSelect[9∈0] ➊<br />ᐸpeopleᐳ<br />More deps:<br />- Object[12]<br />- Constantᐸ4ᐳ[81]"]]:::plan
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ<br />Dependents: 6"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    Connection13[["Connection[13∈0] ➊<br />ᐸ9ᐳ<br />More deps:<br />- Constantᐸ4ᐳ[81]"]]:::plan
    PgSelect9 --> Connection13
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    ConnectionItems15[["ConnectionItems[15∈0] ➊"]]:::plan
    Connection13 --> ConnectionItems15
    __Item18[/"__Item[18∈3]<br />ᐸ15ᐳ"\]:::itemplan
    ConnectionItems15 ==> __Item18
    PgSelectSingle19{{"PgSelectSingle[19∈3]<br />ᐸpeopleᐳ"}}:::plan
    __Item18 --> PgSelectSingle19
    PgUnionAll22[["PgUnionAll[22∈4]<br />ᐸAwsApplication,GcpApplicationᐳ<br />More deps:<br />- Object[12]"]]:::plan
    PgClassExpression20{{"PgClassExpression[20∈4]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    PgClassExpression20 --> PgUnionAll22
    PgSelectSingle19 --> PgClassExpression20
    PgClassExpression21{{"PgClassExpression[21∈4]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression21
    Connection26[["Connection[26∈4]<br />ᐸ22ᐳ"]]:::plan
    PgUnionAll22 --> Connection26
    ConnectionItems27[["ConnectionItems[27∈4]"]]:::plan
    Connection26 --> ConnectionItems27
    List35{{"List[35∈6]<br />ᐸ32,33,34ᐳ<br />More deps:<br />- Constantᐸ[HIDDEN]ᐳ[34]"}}:::plan
    Access32{{"Access[32∈6]<br />ᐸ30.0ᐳ"}}:::plan
    Access33{{"Access[33∈6]<br />ᐸ30.1ᐳ"}}:::plan
    Access32 & Access33 --> List35
    __Item30[/"__Item[30∈6]<br />ᐸ27ᐳ"\]:::itemplan
    ConnectionItems27 ==> __Item30
    __Item30 --> Access32
    __Item30 --> Access33
    Lambda36{{"Lambda[36∈6]<br />ᐸtoSpecifierᐳ"}}:::plan
    List35 --> Lambda36
    Access38{{"Access[38∈6]<br />ᐸ36.__typenameᐳ"}}:::plan
    Lambda36 -->|rejectNull| Access38
    Access39{{"Access[39∈6]<br />ᐸ36.idᐳ"}}:::plan
    Lambda36 -->|rejectNull| Access39
    PgSelect40[["PgSelect[40∈8]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication<br />More deps:<br />- Object[12]"]]:::plan
    Access39 --> PgSelect40
    PgUnionAll67[["PgUnionAll[67∈8]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ<br />More deps:<br />- Object[12]"]]:::plan
    PgClassExpression55{{"PgClassExpression[55∈8]^<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    PgClassExpression55 --> PgUnionAll67
    First44{{"First[44∈8]^"}}:::plan
    PgSelectRows45[["PgSelectRows[45∈8]^"]]:::plan
    PgSelectRows45 --> First44
    PgSelect40 --> PgSelectRows45
    PgSelectSingle46{{"PgSelectSingle[46∈8]^<br />ᐸaws_applicationsᐳ"}}:::plan
    First44 --> PgSelectSingle46
    PgSelectSingle46 --> PgClassExpression55
    First68{{"First[68∈8]^"}}:::plan
    Access78{{"Access[78∈8]^<br />ᐸ67.itemsᐳ"}}:::plan
    Access78 --> First68
    PgClassExpression71{{"PgClassExpression[71∈8]^<br />ᐸcount(*)ᐳ"}}:::plan
    First68 --> PgClassExpression71
    PgUnionAll67 --> Access78
    PgSelect48[["PgSelect[48∈9]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication<br />More deps:<br />- Object[12]"]]:::plan
    Access39 --> PgSelect48
    PgUnionAll72[["PgUnionAll[72∈9]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ<br />More deps:<br />- Object[12]"]]:::plan
    PgClassExpression61{{"PgClassExpression[61∈9]^<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    PgClassExpression61 --> PgUnionAll72
    First52{{"First[52∈9]^"}}:::plan
    PgSelectRows53[["PgSelectRows[53∈9]^"]]:::plan
    PgSelectRows53 --> First52
    PgSelect48 --> PgSelectRows53
    PgSelectSingle54{{"PgSelectSingle[54∈9]^<br />ᐸgcp_applicationsᐳ"}}:::plan
    First52 --> PgSelectSingle54
    PgSelectSingle54 --> PgClassExpression61
    First73{{"First[73∈9]^"}}:::plan
    Access80{{"Access[80∈9]^<br />ᐸ72.itemsᐳ"}}:::plan
    Access80 --> First73
    PgClassExpression76{{"PgClassExpression[76∈9]^<br />ᐸcount(*)ᐳ"}}:::plan
    First73 --> PgClassExpression76
    PgUnionAll72 --> Access80

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect9,Access10,Access11,Object12,Connection13,ConnectionItems15 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1 bucket1
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item18,PgSelectSingle19 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression20,PgClassExpression21,PgUnionAll22,Connection26,ConnectionItems27 bucket4
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item30,Access32,Access33,List35,Lambda36,Access38,Access39 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgSelect40,First44,PgSelectRows45,PgSelectSingle46,PgClassExpression55,PgUnionAll67,First68,PgClassExpression71,Access78 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgSelect48,First52,PgSelectRows53,PgSelectSingle54,PgClassExpression61,PgUnionAll72,First73,PgClassExpression76,Access80 bucket9

