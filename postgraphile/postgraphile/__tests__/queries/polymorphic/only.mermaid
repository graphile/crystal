%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection14{{"Connection[14∈0] ➊<br />ᐸ10ᐳ"}}:::plan
    Constant6{{"Constant[6∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Constant6 & Constant6 & Constant6 --> Connection14
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    Lambda15{{"Lambda[15∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant6 --> Lambda15
    Lambda16[["Lambda[16∈0] ➊<br />ᐸlimitToTypesᐳ"]]:::unbatchedplan
    Constant119{{"Constant[119∈0] ➊<br />ᐸ[ 'GcpApplication', 'AwsApplication' ]ᐳ"}}:::plan
    Constant119 --> Lambda16
    Lambda38{{"Lambda[38∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant6 --> Lambda38
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant120{{"Constant[120∈0] ➊<br />ᐸ[ 'ThirdPartyVulnerability' ]ᐳ"}}:::plan
    PgUnionAll17[["PgUnionAll[17∈1] ➊"]]:::plan
    Object13 & Lambda15 & Lambda16 & Connection14 & Constant6 & Constant6 & Constant6 --> PgUnionAll17
    Access112{{"Access[112∈1] ➊<br />ᐸ17.itemsᐳ"}}:::plan
    PgUnionAll17 --> Access112
    __Item19[/"__Item[19∈2]<br />ᐸ112ᐳ"\]:::itemplan
    Access112 ==> __Item19
    PgUnionAllSingle20["PgUnionAllSingle[20∈2]"]:::plan
    __Item19 --> PgUnionAllSingle20
    Access21{{"Access[21∈2]<br />ᐸ20.1ᐳ"}}:::plan
    PgUnionAllSingle20 --> Access21
    PgUnionAll40[["PgUnionAll[40∈3]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression34{{"PgClassExpression[34∈3]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Lambda39[["Lambda[39∈3] ➊<br />ᐸlimitToTypesᐳ<br />ᐳAwsApplication<br />ᐳGcpApplication"]]:::unbatchedplan
    Connection37{{"Connection[37∈3] ➊<br />ᐸ35ᐳ<br />ᐳAwsApplication"}}:::plan
    Object13 & PgClassExpression34 & Lambda38 & Lambda39 & Connection37 & Constant6 & Constant6 & Constant6 --> PgUnionAll40
    PgUnionAll83[["PgUnionAll[83∈3]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression77{{"PgClassExpression[77∈3]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection80{{"Connection[80∈3] ➊<br />ᐸ78ᐳ<br />ᐳGcpApplication"}}:::plan
    Object13 & PgClassExpression77 & Lambda38 & Lambda39 & Connection80 & Constant6 & Constant6 & Constant6 --> PgUnionAll83
    Constant6 & Constant6 & Constant6 --> Connection37
    Constant6 & Constant6 & Constant6 --> Connection80
    PgSelect24[["PgSelect[24∈3]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access23{{"Access[23∈3]<br />ᐸ22.0ᐳ"}}:::plan
    Object13 & Access23 --> PgSelect24
    PgSelect69[["PgSelect[69∈3]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access68{{"Access[68∈3]<br />ᐸ67.0ᐳ"}}:::plan
    Object13 & Access68 --> PgSelect69
    JSONParse22[["JSONParse[22∈3]<br />ᐸ21ᐳ<br />ᐳAwsApplication"]]:::plan
    Access21 --> JSONParse22
    JSONParse22 --> Access23
    First28{{"First[28∈3]"}}:::plan
    PgSelectRows29[["PgSelectRows[29∈3]"]]:::plan
    PgSelectRows29 --> First28
    PgSelect24 --> PgSelectRows29
    PgSelectSingle30{{"PgSelectSingle[30∈3]<br />ᐸaws_applicationsᐳ"}}:::plan
    First28 --> PgSelectSingle30
    PgClassExpression31{{"PgClassExpression[31∈3]<br />ᐸ__aws_appl..._.”aws_id”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression31
    PgSelectSingle30 --> PgClassExpression34
    Constant120 --> Lambda39
    JSONParse67[["JSONParse[67∈3]<br />ᐸ21ᐳ<br />ᐳGcpApplication"]]:::plan
    Access21 --> JSONParse67
    JSONParse67 --> Access68
    First71{{"First[71∈3]"}}:::plan
    PgSelectRows72[["PgSelectRows[72∈3]"]]:::plan
    PgSelectRows72 --> First71
    PgSelect69 --> PgSelectRows72
    PgSelectSingle73{{"PgSelectSingle[73∈3]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First71 --> PgSelectSingle73
    PgClassExpression74{{"PgClassExpression[74∈3]<br />ᐸ__gcp_appl..._.”gcp_id”ᐳ"}}:::plan
    PgSelectSingle73 --> PgClassExpression74
    PgSelectSingle73 --> PgClassExpression77
    Access110{{"Access[110∈3]<br />ᐸ40.itemsᐳ"}}:::plan
    PgUnionAll40 --> Access110
    Access111{{"Access[111∈3]<br />ᐸ83.itemsᐳ"}}:::plan
    PgUnionAll83 --> Access111
    __Item42[/"__Item[42∈4]<br />ᐸ110ᐳ"\]:::itemplan
    Access110 ==> __Item42
    PgUnionAllSingle43["PgUnionAllSingle[43∈4]"]:::plan
    __Item42 --> PgUnionAllSingle43
    Access44{{"Access[44∈4]<br />ᐸ43.1ᐳ"}}:::plan
    PgUnionAllSingle43 --> Access44
    PgSelect47[["PgSelect[47∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access46{{"Access[46∈5]<br />ᐸ45.0ᐳ"}}:::plan
    Object13 & Access46 --> PgSelect47
    PgSelect59[["PgSelect[59∈5]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access58{{"Access[58∈5]<br />ᐸ57.0ᐳ"}}:::plan
    Object13 & Access58 --> PgSelect59
    JSONParse45[["JSONParse[45∈5]<br />ᐸ44ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access44 --> JSONParse45
    JSONParse45 --> Access46
    First51{{"First[51∈5]"}}:::plan
    PgSelectRows52[["PgSelectRows[52∈5]"]]:::plan
    PgSelectRows52 --> First51
    PgSelect47 --> PgSelectRows52
    PgSelectSingle53{{"PgSelectSingle[53∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First51 --> PgSelectSingle53
    PgClassExpression54{{"PgClassExpression[54∈5]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression54
    PgClassExpression55{{"PgClassExpression[55∈5]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈5]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression56
    JSONParse57[["JSONParse[57∈5]<br />ᐸ44ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access44 --> JSONParse57
    JSONParse57 --> Access58
    First61{{"First[61∈5]"}}:::plan
    PgSelectRows62[["PgSelectRows[62∈5]"]]:::plan
    PgSelectRows62 --> First61
    PgSelect59 --> PgSelectRows62
    PgSelectSingle63{{"PgSelectSingle[63∈5]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First61 --> PgSelectSingle63
    PgClassExpression64{{"PgClassExpression[64∈5]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression64
    PgClassExpression65{{"PgClassExpression[65∈5]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression65
    PgClassExpression66{{"PgClassExpression[66∈5]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression66
    __Item85[/"__Item[85∈6]<br />ᐸ111ᐳ"\]:::itemplan
    Access111 ==> __Item85
    PgUnionAllSingle86["PgUnionAllSingle[86∈6]"]:::plan
    __Item85 --> PgUnionAllSingle86
    Access87{{"Access[87∈6]<br />ᐸ86.1ᐳ"}}:::plan
    PgUnionAllSingle86 --> Access87
    PgSelect90[["PgSelect[90∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access89{{"Access[89∈7]<br />ᐸ88.0ᐳ"}}:::plan
    Object13 & Access89 --> PgSelect90
    PgSelect102[["PgSelect[102∈7]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access101{{"Access[101∈7]<br />ᐸ100.0ᐳ"}}:::plan
    Object13 & Access101 --> PgSelect102
    JSONParse88[["JSONParse[88∈7]<br />ᐸ87ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access87 --> JSONParse88
    JSONParse88 --> Access89
    First94{{"First[94∈7]"}}:::plan
    PgSelectRows95[["PgSelectRows[95∈7]"]]:::plan
    PgSelectRows95 --> First94
    PgSelect90 --> PgSelectRows95
    PgSelectSingle96{{"PgSelectSingle[96∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First94 --> PgSelectSingle96
    PgClassExpression97{{"PgClassExpression[97∈7]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle96 --> PgClassExpression97
    PgClassExpression98{{"PgClassExpression[98∈7]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle96 --> PgClassExpression98
    PgClassExpression99{{"PgClassExpression[99∈7]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle96 --> PgClassExpression99
    JSONParse100[["JSONParse[100∈7]<br />ᐸ87ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access87 --> JSONParse100
    JSONParse100 --> Access101
    First104{{"First[104∈7]"}}:::plan
    PgSelectRows105[["PgSelectRows[105∈7]"]]:::plan
    PgSelectRows105 --> First104
    PgSelect102 --> PgSelectRows105
    PgSelectSingle106{{"PgSelectSingle[106∈7]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First104 --> PgSelectSingle106
    PgClassExpression107{{"PgClassExpression[107∈7]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression107
    PgClassExpression108{{"PgClassExpression[108∈7]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression108
    PgClassExpression109{{"PgClassExpression[109∈7]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression109

    %% define steps

    subgraph "Buckets for queries/polymorphic/only"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 6, 11, 12, 119, 120, 13, 14, 15, 38<br />2: Lambda[16]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant6,Access11,Access12,Object13,Connection14,Lambda15,Lambda16,Lambda38,Constant119,Constant120 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 15, 16, 14, 6, 120, 38<br /><br />ROOT Connectionᐸ10ᐳ[14]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll17,Access112 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 13, 6, 120, 38<br /><br />ROOT __Item{2}ᐸ112ᐳ[19]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item19,PgUnionAllSingle20,Access21 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 21, 13, 6, 120, 38, 20<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: 22, 39, 67<br />ᐳ: 37, 80, 23, 68<br />2: PgSelect[24], PgSelect[69]<br />3: PgSelectRows[29], PgSelectRows[72]<br />ᐳ: 28, 30, 31, 34, 71, 73, 74, 77<br />4: PgUnionAll[40], PgUnionAll[83]<br />ᐳ: Access[110], Access[111]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse22,Access23,PgSelect24,First28,PgSelectRows29,PgSelectSingle30,PgClassExpression31,PgClassExpression34,Connection37,Lambda39,PgUnionAll40,JSONParse67,Access68,PgSelect69,First71,PgSelectRows72,PgSelectSingle73,PgClassExpression74,PgClassExpression77,Connection80,PgUnionAll83,Access110,Access111 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 13<br /><br />ROOT __Item{4}ᐸ110ᐳ[42]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item42,PgUnionAllSingle43,Access44 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 44, 13, 43<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[45], JSONParse[57]<br />ᐳ: Access[46], Access[58]<br />2: PgSelect[47], PgSelect[59]<br />3: PgSelectRows[52], PgSelectRows[62]<br />ᐳ: 51, 53, 54, 55, 56, 61, 63, 64, 65, 66"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,JSONParse45,Access46,PgSelect47,First51,PgSelectRows52,PgSelectSingle53,PgClassExpression54,PgClassExpression55,PgClassExpression56,JSONParse57,Access58,PgSelect59,First61,PgSelectRows62,PgSelectSingle63,PgClassExpression64,PgClassExpression65,PgClassExpression66 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 13<br /><br />ROOT __Item{6}ᐸ111ᐳ[85]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item85,PgUnionAllSingle86,Access87 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 87, 13, 86<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[88], JSONParse[100]<br />ᐳ: Access[89], Access[101]<br />2: PgSelect[90], PgSelect[102]<br />3: PgSelectRows[95], PgSelectRows[105]<br />ᐳ: 94, 96, 97, 98, 99, 104, 106, 107, 108, 109"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,JSONParse88,Access89,PgSelect90,First94,PgSelectRows95,PgSelectSingle96,PgClassExpression97,PgClassExpression98,PgClassExpression99,JSONParse100,Access101,PgSelect102,First104,PgSelectRows105,PgSelectSingle106,PgClassExpression107,PgClassExpression108,PgClassExpression109 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    end
