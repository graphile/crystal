%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object19{{"Object[19∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access17 & Access18 --> Object19
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access17
    __Value2 --> Access18
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection20{{"Connection[20∈0] ➊<br />ᐸ16ᐳ"}}:::plan
    PgUnionAll21[["PgUnionAll[21∈1] ➊"]]:::plan
    Object19 & Connection20 --> PgUnionAll21
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgUnionAll21 ==> __Item22
    PgUnionAllSingle23["PgUnionAllSingle[23∈2]"]:::plan
    __Item22 --> PgUnionAllSingle23
    PgUnionAll47[["PgUnionAll[47∈3]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression43{{"PgClassExpression[43∈3]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection46{{"Connection[46∈3] ➊<br />ᐸ44ᐳ<br />ᐳAwsApplication"}}:::plan
    Object19 & PgClassExpression43 & Connection46 --> PgUnionAll47
    PgUnionAll91[["PgUnionAll[91∈3]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression87{{"PgClassExpression[87∈3]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection90{{"Connection[90∈3] ➊<br />ᐸ88ᐳ<br />ᐳGcpApplication"}}:::plan
    Object19 & PgClassExpression87 & Connection90 --> PgUnionAll91
    PgSelect27[["PgSelect[27∈3]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access26{{"Access[26∈3]<br />ᐸ25.0ᐳ"}}:::plan
    Object19 & Access26 --> PgSelect27
    PgSelect73[["PgSelect[73∈3]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access72{{"Access[72∈3]<br />ᐸ71.0ᐳ"}}:::plan
    Object19 & Access72 --> PgSelect73
    Access24{{"Access[24∈3]<br />ᐸ23.1ᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle23 --> Access24
    JSONParse25[["JSONParse[25∈3]<br />ᐸ24ᐳ"]]:::plan
    Access24 --> JSONParse25
    JSONParse25 --> Access26
    First31{{"First[31∈3]"}}:::plan
    PgSelect27 --> First31
    PgSelectSingle32{{"PgSelectSingle[32∈3]<br />ᐸaws_applicationsᐳ"}}:::plan
    First31 --> PgSelectSingle32
    PgClassExpression33{{"PgClassExpression[33∈3]<br />ᐸ__aws_appl..._.”aws_id”ᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression33
    PgSelectSingle32 --> PgClassExpression43
    JSONParse71[["JSONParse[71∈3]<br />ᐸ24ᐳ<br />ᐳGcpApplication"]]:::plan
    Access24 --> JSONParse71
    JSONParse71 --> Access72
    First75{{"First[75∈3]"}}:::plan
    PgSelect73 --> First75
    PgSelectSingle76{{"PgSelectSingle[76∈3]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First75 --> PgSelectSingle76
    PgClassExpression77{{"PgClassExpression[77∈3]<br />ᐸ__gcp_appl..._.”gcp_id”ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression77
    PgSelectSingle76 --> PgClassExpression87
    __Item48[/"__Item[48∈4]<br />ᐸ47ᐳ"\]:::itemplan
    PgUnionAll47 ==> __Item48
    PgUnionAllSingle49["PgUnionAllSingle[49∈4]"]:::plan
    __Item48 --> PgUnionAllSingle49
    PgSelect53[["PgSelect[53∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access52{{"Access[52∈5]<br />ᐸ51.0ᐳ"}}:::plan
    Object19 & Access52 --> PgSelect53
    PgSelect64[["PgSelect[64∈5]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access63{{"Access[63∈5]<br />ᐸ62.0ᐳ"}}:::plan
    Object19 & Access63 --> PgSelect64
    Access50{{"Access[50∈5]<br />ᐸ49.1ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"}}:::plan
    PgUnionAllSingle49 --> Access50
    JSONParse51[["JSONParse[51∈5]<br />ᐸ50ᐳ"]]:::plan
    Access50 --> JSONParse51
    JSONParse51 --> Access52
    First57{{"First[57∈5]"}}:::plan
    PgSelect53 --> First57
    PgSelectSingle58{{"PgSelectSingle[58∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First57 --> PgSelectSingle58
    PgClassExpression59{{"PgClassExpression[59∈5]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression59
    PgClassExpression60{{"PgClassExpression[60∈5]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈5]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression61
    JSONParse62[["JSONParse[62∈5]<br />ᐸ50ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access50 --> JSONParse62
    JSONParse62 --> Access63
    First66{{"First[66∈5]"}}:::plan
    PgSelect64 --> First66
    PgSelectSingle67{{"PgSelectSingle[67∈5]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First66 --> PgSelectSingle67
    PgClassExpression68{{"PgClassExpression[68∈5]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression68
    PgClassExpression69{{"PgClassExpression[69∈5]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression69
    PgClassExpression70{{"PgClassExpression[70∈5]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression70
    __Item92[/"__Item[92∈6]<br />ᐸ91ᐳ"\]:::itemplan
    PgUnionAll91 ==> __Item92
    PgUnionAllSingle93["PgUnionAllSingle[93∈6]"]:::plan
    __Item92 --> PgUnionAllSingle93
    PgSelect97[["PgSelect[97∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access96{{"Access[96∈7]<br />ᐸ95.0ᐳ"}}:::plan
    Object19 & Access96 --> PgSelect97
    PgSelect108[["PgSelect[108∈7]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access107{{"Access[107∈7]<br />ᐸ106.0ᐳ"}}:::plan
    Object19 & Access107 --> PgSelect108
    Access94{{"Access[94∈7]<br />ᐸ93.1ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"}}:::plan
    PgUnionAllSingle93 --> Access94
    JSONParse95[["JSONParse[95∈7]<br />ᐸ94ᐳ"]]:::plan
    Access94 --> JSONParse95
    JSONParse95 --> Access96
    First101{{"First[101∈7]"}}:::plan
    PgSelect97 --> First101
    PgSelectSingle102{{"PgSelectSingle[102∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First101 --> PgSelectSingle102
    PgClassExpression103{{"PgClassExpression[103∈7]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression103
    PgClassExpression104{{"PgClassExpression[104∈7]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression104
    PgClassExpression105{{"PgClassExpression[105∈7]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression105
    JSONParse106[["JSONParse[106∈7]<br />ᐸ94ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access94 --> JSONParse106
    JSONParse106 --> Access107
    First110{{"First[110∈7]"}}:::plan
    PgSelect108 --> First110
    PgSelectSingle111{{"PgSelectSingle[111∈7]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First110 --> PgSelectSingle111
    PgClassExpression112{{"PgClassExpression[112∈7]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle111 --> PgClassExpression112
    PgClassExpression113{{"PgClassExpression[113∈7]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle111 --> PgClassExpression113
    PgClassExpression114{{"PgClassExpression[114∈7]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle111 --> PgClassExpression114

    %% define steps

    subgraph "Buckets for queries/polymorphic/only"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access17,Access18,Object19,Connection20 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 20<br /><br />ROOT Connectionᐸ16ᐳ[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll21 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 19<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgUnionAllSingle23 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 23, 19<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: <br />ᐳ: 24, 46, 90<br />2: JSONParse[25], JSONParse[71]<br />ᐳ: Access[26], Access[72]<br />3: PgSelect[27], PgSelect[73]<br />ᐳ: 31, 32, 33, 43, 75, 76, 77, 87<br />4: PgUnionAll[47], PgUnionAll[91]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,Access24,JSONParse25,Access26,PgSelect27,First31,PgSelectSingle32,PgClassExpression33,PgClassExpression43,Connection46,PgUnionAll47,JSONParse71,Access72,PgSelect73,First75,PgSelectSingle76,PgClassExpression77,PgClassExpression87,Connection90,PgUnionAll91 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 19<br /><br />ROOT __Item{4}ᐸ47ᐳ[48]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item48,PgUnionAllSingle49 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 49, 19<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[50]<br />2: JSONParse[51], JSONParse[62]<br />ᐳ: Access[52], Access[63]<br />3: PgSelect[53], PgSelect[64]<br />ᐳ: 57, 58, 59, 60, 61, 66, 67, 68, 69, 70"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,Access50,JSONParse51,Access52,PgSelect53,First57,PgSelectSingle58,PgClassExpression59,PgClassExpression60,PgClassExpression61,JSONParse62,Access63,PgSelect64,First66,PgSelectSingle67,PgClassExpression68,PgClassExpression69,PgClassExpression70 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 19<br /><br />ROOT __Item{6}ᐸ91ᐳ[92]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item92,PgUnionAllSingle93 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 93, 19<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[94]<br />2: JSONParse[95], JSONParse[106]<br />ᐳ: Access[96], Access[107]<br />3: PgSelect[97], PgSelect[108]<br />ᐳ: 101, 102, 103, 104, 105, 110, 111, 112, 113, 114"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,Access94,JSONParse95,Access96,PgSelect97,First101,PgSelectSingle102,PgClassExpression103,PgClassExpression104,PgClassExpression105,JSONParse106,Access107,PgSelect108,First110,PgSelectSingle111,PgClassExpression112,PgClassExpression113,PgClassExpression114 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    end
