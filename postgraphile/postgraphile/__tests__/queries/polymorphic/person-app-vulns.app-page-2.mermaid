%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection28{{"Connection[28∈0] ➊<br />ᐸ24ᐳ"}}:::plan
    Constant125{{"Constant[125∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    Lambda30{{"Lambda[30∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant125 & Constant7 & Constant7 & Lambda30 --> Connection28
    Connection14{{"Connection[14∈0] ➊<br />ᐸ10ᐳ"}}:::plan
    Constant122{{"Constant[122∈0] ➊<br />ᐸ4ᐳ"}}:::plan
    Constant122 & Constant7 & Constant7 --> Connection14
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    Lambda15{{"Lambda[15∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant127{{"Constant[127∈0] ➊<br />ᐸ[ 'PRIMARY_KEY_ASC' ]ᐳ"}}:::plan
    Constant127 --> Lambda15
    Lambda29{{"Lambda[29∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant7 --> Lambda29
    Constant126{{"Constant[126∈0] ➊<br />ᐸ'WyI0OTgwM2MxZTJiIiwiQXdzQXBwbGljYXRpb24iLCJbXCI0XCJdIl0='ᐳ"}}:::plan
    Constant126 --> Lambda30
    Lambda31[["Lambda[31∈0] ➊<br />ᐸlimitToTypesᐳ"]]:::unbatchedplan
    Constant7 --> Lambda31
    Lambda53{{"Lambda[53∈0] ➊<br />ᐸextractList_grafast_applyᐳ"}}:::plan
    Constant7 --> Lambda53
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect16[["PgSelect[16∈1] ➊<br />ᐸpeopleᐳ"]]:::plan
    Object13 & Lambda15 & Connection14 & Constant122 & Constant7 & Constant7 --> PgSelect16
    PgSelectRows17[["PgSelectRows[17∈1] ➊"]]:::plan
    PgSelect16 --> PgSelectRows17
    __Item18[/"__Item[18∈2]<br />ᐸ17ᐳ"\]:::itemplan
    PgSelectRows17 ==> __Item18
    PgSelectSingle19{{"PgSelectSingle[19∈2]<br />ᐸpeopleᐳ"}}:::plan
    __Item18 --> PgSelectSingle19
    PgUnionAll32[["PgUnionAll[32∈3]"]]:::plan
    PgClassExpression20{{"PgClassExpression[20∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object13 & PgClassExpression20 & Lambda29 & Lambda31 & Connection28 & Lambda30 & Constant125 & Constant7 & Constant7 --> PgUnionAll32
    PgSelectSingle19 --> PgClassExpression20
    PgClassExpression21{{"PgClassExpression[21∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression21
    Access121{{"Access[121∈3]<br />ᐸ32.itemsᐳ"}}:::plan
    PgUnionAll32 --> Access121
    __Item34[/"__Item[34∈4]<br />ᐸ121ᐳ"\]:::itemplan
    Access121 ==> __Item34
    PgUnionAllSingle35["PgUnionAllSingle[35∈4]"]:::plan
    __Item34 --> PgUnionAllSingle35
    Access36{{"Access[36∈4]<br />ᐸ32.cursorDetailsᐳ"}}:::plan
    PgUnionAll32 --> Access36
    PgCursor37{{"PgCursor[37∈5]"}}:::plan
    PgUnionAllSingle35 & Access36 --> PgCursor37
    Access38{{"Access[38∈5]<br />ᐸ35.1ᐳ"}}:::plan
    PgUnionAllSingle35 --> Access38
    PgUnionAll55[["PgUnionAll[55∈6]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression48{{"PgClassExpression[48∈6]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection52{{"Connection[52∈6] ➊<br />ᐸ50ᐳ<br />ᐳAwsApplication"}}:::plan
    Object13 & PgClassExpression48 & Lambda53 & Lambda31 & Connection52 & Constant125 & Constant7 & Constant7 --> PgUnionAll55
    PgUnionAll94[["PgUnionAll[94∈6]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression87{{"PgClassExpression[87∈6]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection91{{"Connection[91∈6] ➊<br />ᐸ89ᐳ<br />ᐳGcpApplication"}}:::plan
    Object13 & PgClassExpression87 & Lambda53 & Lambda31 & Connection91 & Constant125 & Constant7 & Constant7 --> PgUnionAll94
    Constant125 & Constant7 & Constant7 --> Connection52
    Constant125 & Constant7 & Constant7 --> Connection91
    PgSelect41[["PgSelect[41∈6]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access40{{"Access[40∈6]<br />ᐸ39.0ᐳ"}}:::plan
    Object13 & Access40 --> PgSelect41
    PgSelect82[["PgSelect[82∈6]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access81{{"Access[81∈6]<br />ᐸ80.0ᐳ"}}:::plan
    Object13 & Access81 --> PgSelect82
    JSONParse39[["JSONParse[39∈6]<br />ᐸ38ᐳ<br />ᐳAwsApplication"]]:::plan
    Access38 --> JSONParse39
    JSONParse39 --> Access40
    First45{{"First[45∈6]"}}:::plan
    PgSelectRows46[["PgSelectRows[46∈6]"]]:::plan
    PgSelectRows46 --> First45
    PgSelect41 --> PgSelectRows46
    PgSelectSingle47{{"PgSelectSingle[47∈6]<br />ᐸaws_applicationsᐳ"}}:::plan
    First45 --> PgSelectSingle47
    PgSelectSingle47 --> PgClassExpression48
    JSONParse80[["JSONParse[80∈6]<br />ᐸ38ᐳ<br />ᐳGcpApplication"]]:::plan
    Access38 --> JSONParse80
    JSONParse80 --> Access81
    First84{{"First[84∈6]"}}:::plan
    PgSelectRows85[["PgSelectRows[85∈6]"]]:::plan
    PgSelectRows85 --> First84
    PgSelect82 --> PgSelectRows85
    PgSelectSingle86{{"PgSelectSingle[86∈6]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First84 --> PgSelectSingle86
    PgSelectSingle86 --> PgClassExpression87
    Access119{{"Access[119∈6]<br />ᐸ55.itemsᐳ"}}:::plan
    PgUnionAll55 --> Access119
    Access120{{"Access[120∈6]<br />ᐸ94.itemsᐳ"}}:::plan
    PgUnionAll94 --> Access120
    __Item57[/"__Item[57∈7]<br />ᐸ119ᐳ"\]:::itemplan
    Access119 ==> __Item57
    PgUnionAllSingle58["PgUnionAllSingle[58∈7]"]:::plan
    __Item57 --> PgUnionAllSingle58
    Access59{{"Access[59∈7]<br />ᐸ55.cursorDetailsᐳ"}}:::plan
    PgUnionAll55 --> Access59
    PgCursor60{{"PgCursor[60∈8]<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle58 & Access59 --> PgCursor60
    Access61{{"Access[61∈8]<br />ᐸ58.1ᐳ"}}:::plan
    PgUnionAllSingle58 --> Access61
    PgSelect64[["PgSelect[64∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access63{{"Access[63∈9]<br />ᐸ62.0ᐳ"}}:::plan
    Object13 & Access63 --> PgSelect64
    PgSelect74[["PgSelect[74∈9]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access73{{"Access[73∈9]<br />ᐸ72.0ᐳ"}}:::plan
    Object13 & Access73 --> PgSelect74
    JSONParse62[["JSONParse[62∈9]<br />ᐸ61ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access61 --> JSONParse62
    JSONParse62 --> Access63
    First68{{"First[68∈9]"}}:::plan
    PgSelectRows69[["PgSelectRows[69∈9]"]]:::plan
    PgSelectRows69 --> First68
    PgSelect64 --> PgSelectRows69
    PgSelectSingle70{{"PgSelectSingle[70∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First68 --> PgSelectSingle70
    PgClassExpression71{{"PgClassExpression[71∈9]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression71
    JSONParse72[["JSONParse[72∈9]<br />ᐸ61ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access61 --> JSONParse72
    JSONParse72 --> Access73
    First76{{"First[76∈9]"}}:::plan
    PgSelectRows77[["PgSelectRows[77∈9]"]]:::plan
    PgSelectRows77 --> First76
    PgSelect74 --> PgSelectRows77
    PgSelectSingle78{{"PgSelectSingle[78∈9]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First76 --> PgSelectSingle78
    PgClassExpression79{{"PgClassExpression[79∈9]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression79
    __Item96[/"__Item[96∈10]<br />ᐸ120ᐳ"\]:::itemplan
    Access120 ==> __Item96
    PgUnionAllSingle97["PgUnionAllSingle[97∈10]"]:::plan
    __Item96 --> PgUnionAllSingle97
    Access98{{"Access[98∈10]<br />ᐸ94.cursorDetailsᐳ"}}:::plan
    PgUnionAll94 --> Access98
    PgCursor99{{"PgCursor[99∈11]<br />ᐳGcpApplication"}}:::plan
    PgUnionAllSingle97 & Access98 --> PgCursor99
    Access100{{"Access[100∈11]<br />ᐸ97.1ᐳ"}}:::plan
    PgUnionAllSingle97 --> Access100
    PgSelect103[["PgSelect[103∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access102{{"Access[102∈12]<br />ᐸ101.0ᐳ"}}:::plan
    Object13 & Access102 --> PgSelect103
    PgSelect113[["PgSelect[113∈12]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access112{{"Access[112∈12]<br />ᐸ111.0ᐳ"}}:::plan
    Object13 & Access112 --> PgSelect113
    JSONParse101[["JSONParse[101∈12]<br />ᐸ100ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access100 --> JSONParse101
    JSONParse101 --> Access102
    First107{{"First[107∈12]"}}:::plan
    PgSelectRows108[["PgSelectRows[108∈12]"]]:::plan
    PgSelectRows108 --> First107
    PgSelect103 --> PgSelectRows108
    PgSelectSingle109{{"PgSelectSingle[109∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First107 --> PgSelectSingle109
    PgClassExpression110{{"PgClassExpression[110∈12]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle109 --> PgClassExpression110
    JSONParse111[["JSONParse[111∈12]<br />ᐸ100ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access100 --> JSONParse111
    JSONParse111 --> Access112
    First115{{"First[115∈12]"}}:::plan
    PgSelectRows116[["PgSelectRows[116∈12]"]]:::plan
    PgSelectRows116 --> First115
    PgSelect113 --> PgSelectRows116
    PgSelectSingle117{{"PgSelectSingle[117∈12]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First115 --> PgSelectSingle117
    PgClassExpression118{{"PgClassExpression[118∈12]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression118

    %% define steps

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 11, 12, 122, 125, 126, 127, 13, 14, 15, 29, 30, 53, 28<br />2: Lambda[31]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access11,Access12,Object13,Connection14,Lambda15,Connection28,Lambda29,Lambda30,Lambda31,Lambda53,Constant122,Constant125,Constant126,Constant127 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 15, 14, 122, 7, 29, 31, 28, 30, 125, 53<br /><br />ROOT Connectionᐸ10ᐳ[14]<br />1: PgSelect[16]<br />2: PgSelectRows[17]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect16,PgSelectRows17 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 13, 29, 31, 28, 30, 125, 7, 53<br /><br />ROOT __Item{2}ᐸ17ᐳ[18]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item18,PgSelectSingle19 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 19, 13, 29, 31, 28, 30, 125, 7, 53<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[19]<br />1: <br />ᐳ: 20, 21<br />2: PgUnionAll[32]<br />ᐳ: Access[121]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression20,PgClassExpression21,PgUnionAll32,Access121 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 32, 13, 125, 7, 53, 31<br /><br />ROOT __Item{4}ᐸ121ᐳ[34]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item34,PgUnionAllSingle35,Access36 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 35, 36, 13, 125, 7, 53, 31<br /><br />ROOT PgUnionAllSingle{4}[35]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor37,Access38 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 38, 13, 125, 7, 53, 31, 35<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: JSONParse[39], JSONParse[80]<br />ᐳ: 52, 91, 40, 81<br />2: PgSelect[41], PgSelect[82]<br />3: PgSelectRows[46], PgSelectRows[85]<br />ᐳ: 45, 47, 48, 84, 86, 87<br />4: PgUnionAll[55], PgUnionAll[94]<br />ᐳ: Access[119], Access[120]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse39,Access40,PgSelect41,First45,PgSelectRows46,PgSelectSingle47,PgClassExpression48,Connection52,PgUnionAll55,JSONParse80,Access81,PgSelect82,First84,PgSelectRows85,PgSelectSingle86,PgClassExpression87,Connection91,PgUnionAll94,Access119,Access120 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 55, 13<br /><br />ROOT __Item{7}ᐸ119ᐳ[57]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item57,PgUnionAllSingle58,Access59 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 58, 59, 13<br /><br />ROOT PgUnionAllSingle{7}[58]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgCursor60,Access61 bucket8
    Bucket9("Bucket 9 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 61, 13, 58<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[62], JSONParse[72]<br />ᐳ: Access[63], Access[73]<br />2: PgSelect[64], PgSelect[74]<br />3: PgSelectRows[69], PgSelectRows[77]<br />ᐳ: 68, 70, 71, 76, 78, 79"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,JSONParse62,Access63,PgSelect64,First68,PgSelectRows69,PgSelectSingle70,PgClassExpression71,JSONParse72,Access73,PgSelect74,First76,PgSelectRows77,PgSelectSingle78,PgClassExpression79 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 94, 13<br /><br />ROOT __Item{10}ᐸ120ᐳ[96]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item96,PgUnionAllSingle97,Access98 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 97, 98, 13<br /><br />ROOT PgUnionAllSingle{10}[97]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgCursor99,Access100 bucket11
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 100, 13, 97<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[101], JSONParse[111]<br />ᐳ: Access[102], Access[112]<br />2: PgSelect[103], PgSelect[113]<br />3: PgSelectRows[108], PgSelectRows[116]<br />ᐳ: 107, 109, 110, 115, 117, 118"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse101,Access102,PgSelect103,First107,PgSelectRows108,PgSelectSingle109,PgClassExpression110,JSONParse111,Access112,PgSelect113,First115,PgSelectRows116,PgSelectSingle117,PgClassExpression118 bucket12
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket10
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    end
