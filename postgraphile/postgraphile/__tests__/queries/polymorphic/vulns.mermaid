%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection19{{"Connection[19∈0] ➊<br />ᐸ15ᐳ"}}:::plan
    Constant137{{"Constant[137∈0] ➊<br />ᐸ3ᐳ"}}:::plan
    Lambda20{{"Lambda[20∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor25["PgValidateParsedCursor[25∈0] ➊"]:::plan
    Constant137 & Lambda20 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 --> Connection19
    Object18{{"Object[18∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access16
    __Value2 --> Access17
    Constant138{{"Constant[138∈0] ➊<br />ᐸ'WyIzMDY3N2Q5ZTIyIiwiMTAiLCJUaGlyZFBhcnR5VnVsbmVyYWJpbGl0eSIᐳ"}}:::plan
    Constant138 --> Lambda20
    Lambda20 --> PgValidateParsedCursor25
    PgUnionAll102[["PgUnionAll[102∈0] ➊"]]:::plan
    Object18 --> PgUnionAll102
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgUnionAll21[["PgUnionAll[21∈1] ➊"]]:::plan
    ToPg27{{"ToPg[27∈1] ➊"}}:::plan
    ToPg29{{"ToPg[29∈1] ➊"}}:::plan
    Access30{{"Access[30∈1] ➊<br />ᐸ20.3ᐳ"}}:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll21
    PgUnionAll63[["PgUnionAll[63∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll63
    PgUnionAll74[["PgUnionAll[74∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll74
    PgUnionAll86[["PgUnionAll[86∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll86
    PgUnionAll92[["PgUnionAll[92∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll92
    Object94{{"Object[94∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Constant7{{"Constant[7∈1] ➊<br />ᐸundefinedᐳ"}}:::plan
    Access93{{"Access[93∈1] ➊<br />ᐸ92.hasMoreᐳ"}}:::plan
    Constant137 & Constant7 & Constant7 & Access93 --> Object94
    List73{{"List[73∈1] ➊<br />ᐸ70,71,72ᐳ"}}:::plan
    Access70{{"Access[70∈1] ➊<br />ᐸ65.0ᐳ"}}:::plan
    Access71{{"Access[71∈1] ➊<br />ᐸ65.1ᐳ"}}:::plan
    Access72{{"Access[72∈1] ➊<br />ᐸ65.2ᐳ"}}:::plan
    Access70 & Access71 & Access72 --> List73
    List84{{"List[84∈1] ➊<br />ᐸ81,82,83ᐳ"}}:::plan
    Access81{{"Access[81∈1] ➊<br />ᐸ76.0ᐳ"}}:::plan
    Access82{{"Access[82∈1] ➊<br />ᐸ76.1ᐳ"}}:::plan
    Access83{{"Access[83∈1] ➊<br />ᐸ76.2ᐳ"}}:::plan
    Access81 & Access82 & Access83 --> List84
    Object88{{"Object[88∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Access87{{"Access[87∈1] ➊<br />ᐸ86.hasMoreᐳ"}}:::plan
    Constant137 & Constant7 & Access87 --> Object88
    PgUnionAll57[["PgUnionAll[57∈1] ➊"]]:::plan
    Object18 & Connection19 --> PgUnionAll57
    Access26{{"Access[26∈1] ➊<br />ᐸ20.1ᐳ"}}:::plan
    Lambda20 --> Access26
    Access26 --> ToPg27
    Access28{{"Access[28∈1] ➊<br />ᐸ20.2ᐳ"}}:::plan
    Lambda20 --> Access28
    Access28 --> ToPg29
    Lambda20 --> Access30
    First58{{"First[58∈1] ➊"}}:::plan
    PgUnionAll57 --> First58
    PgUnionAllSingle59["PgUnionAllSingle[59∈1] ➊"]:::plan
    First58 --> PgUnionAllSingle59
    PgClassExpression60{{"PgClassExpression[60∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgUnionAllSingle59 --> PgClassExpression60
    PgPageInfo62{{"PgPageInfo[62∈1] ➊"}}:::plan
    Connection19 --> PgPageInfo62
    First64{{"First[64∈1] ➊"}}:::plan
    PgUnionAll63 --> First64
    PgUnionAllSingle65["PgUnionAllSingle[65∈1] ➊"]:::plan
    First64 --> PgUnionAllSingle65
    PgCursor66{{"PgCursor[66∈1] ➊"}}:::plan
    List73 --> PgCursor66
    PgUnionAllSingle65 --> Access70
    PgUnionAllSingle65 --> Access71
    PgUnionAllSingle65 --> Access72
    Last75{{"Last[75∈1] ➊"}}:::plan
    PgUnionAll74 --> Last75
    PgUnionAllSingle76["PgUnionAllSingle[76∈1] ➊"]:::plan
    Last75 --> PgUnionAllSingle76
    PgCursor77{{"PgCursor[77∈1] ➊"}}:::plan
    List84 --> PgCursor77
    PgUnionAllSingle76 --> Access81
    PgUnionAllSingle76 --> Access82
    PgUnionAllSingle76 --> Access83
    PgUnionAll86 --> Access87
    Lambda89{{"Lambda[89∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object88 --> Lambda89
    PgUnionAll92 --> Access93
    Lambda95{{"Lambda[95∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object94 --> Lambda95
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgUnionAll21 ==> __Item22
    PgUnionAllSingle23["PgUnionAllSingle[23∈2]"]:::plan
    __Item22 --> PgUnionAllSingle23
    List34{{"List[34∈3]<br />ᐸ31,32,33ᐳ"}}:::plan
    Access31{{"Access[31∈3]<br />ᐸ23.0ᐳ"}}:::plan
    Access32{{"Access[32∈3]<br />ᐸ23.1ᐳ"}}:::plan
    Access33{{"Access[33∈3]<br />ᐸ23.2ᐳ"}}:::plan
    Access31 & Access32 & Access33 --> List34
    PgCursor24{{"PgCursor[24∈3]"}}:::plan
    List34 --> PgCursor24
    PgUnionAllSingle23 --> Access31
    PgUnionAllSingle23 --> Access32
    PgUnionAllSingle23 --> Access33
    PgSelect38[["PgSelect[38∈4]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access37{{"Access[37∈4]<br />ᐸ36.0ᐳ"}}:::plan
    Object18 & Access37 --> PgSelect38
    PgSelect49[["PgSelect[49∈4]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access48{{"Access[48∈4]<br />ᐸ47.0ᐳ"}}:::plan
    Object18 & Access48 --> PgSelect49
    JSONParse36[["JSONParse[36∈4]<br />ᐸ33ᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access33 --> JSONParse36
    JSONParse36 --> Access37
    First42{{"First[42∈4]"}}:::plan
    PgSelect38 --> First42
    PgSelectSingle43{{"PgSelectSingle[43∈4]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈4]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈4]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression45
    PgClassExpression46{{"PgClassExpression[46∈4]<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression46
    JSONParse47[["JSONParse[47∈4]<br />ᐸ33ᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access33 --> JSONParse47
    JSONParse47 --> Access48
    First51{{"First[51∈4]"}}:::plan
    PgSelect49 --> First51
    PgSelectSingle52{{"PgSelectSingle[52∈4]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈4]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈4]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression54
    PgClassExpression55{{"PgClassExpression[55∈4]<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈4]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression56
    __Item104[/"__Item[104∈5]<br />ᐸ102ᐳ"\]:::itemplan
    PgUnionAll102 ==> __Item104
    PgUnionAllSingle105["PgUnionAllSingle[105∈5]"]:::plan
    __Item104 --> PgUnionAllSingle105
    PgSelect109[["PgSelect[109∈6]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access108{{"Access[108∈6]<br />ᐸ107.0ᐳ"}}:::plan
    Object18 & Access108 --> PgSelect109
    PgSelect120[["PgSelect[120∈6]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access119{{"Access[119∈6]<br />ᐸ118.0ᐳ"}}:::plan
    Object18 & Access119 --> PgSelect120
    Access106{{"Access[106∈6]<br />ᐸ105.2ᐳ<br />ᐳFirstPartyVulnerability"}}:::plan
    PgUnionAllSingle105 --> Access106
    JSONParse107[["JSONParse[107∈6]<br />ᐸ106ᐳ"]]:::plan
    Access106 --> JSONParse107
    JSONParse107 --> Access108
    First113{{"First[113∈6]"}}:::plan
    PgSelect109 --> First113
    PgSelectSingle114{{"PgSelectSingle[114∈6]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First113 --> PgSelectSingle114
    PgClassExpression115{{"PgClassExpression[115∈6]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression115
    PgClassExpression116{{"PgClassExpression[116∈6]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression116
    PgClassExpression117{{"PgClassExpression[117∈6]<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression117
    JSONParse118[["JSONParse[118∈6]<br />ᐸ106ᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access106 --> JSONParse118
    JSONParse118 --> Access119
    First122{{"First[122∈6]"}}:::plan
    PgSelect120 --> First122
    PgSelectSingle123{{"PgSelectSingle[123∈6]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First122 --> PgSelectSingle123
    PgClassExpression124{{"PgClassExpression[124∈6]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression124
    PgClassExpression125{{"PgClassExpression[125∈6]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression125
    PgClassExpression126{{"PgClassExpression[126∈6]<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression126
    PgClassExpression127{{"PgClassExpression[127∈6]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression127

    %% define steps

    subgraph "Buckets for queries/polymorphic/vulns"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 16, 17, 137, 138, 18, 20<br />2: 25, 102<br />ᐳ: Connection[19]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access16,Access17,Object18,Connection19,Lambda20,PgValidateParsedCursor25,PgUnionAll102,Constant137,Constant138 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19, 20, 137<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: PgUnionAll[57]<br />ᐳ: 7, 26, 28, 30, 62, 27, 29, 58<br />2: 21, 59, 63, 74, 86, 92<br />ᐳ: 60, 64, 75, 87, 88, 89, 93, 94, 95<br />3: 65, 76<br />ᐳ: 70, 71, 72, 73, 81, 82, 83, 84, 66, 77"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,Constant7,PgUnionAll21,Access26,ToPg27,Access28,ToPg29,Access30,PgUnionAll57,First58,PgUnionAllSingle59,PgClassExpression60,PgPageInfo62,PgUnionAll63,First64,PgUnionAllSingle65,PgCursor66,Access70,Access71,Access72,List73,PgUnionAll74,Last75,PgUnionAllSingle76,PgCursor77,Access81,Access82,Access83,List84,PgUnionAll86,Access87,Object88,Lambda89,PgUnionAll92,Access93,Object94,Lambda95 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 18<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgUnionAllSingle23 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 23, 18<br /><br />ROOT PgUnionAllSingle{2}[23]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor24,Access31,Access32,Access33,List34 bucket3
    Bucket4("Bucket 4 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 33, 18, 23<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[36], JSONParse[47]<br />ᐳ: Access[37], Access[48]<br />2: PgSelect[38], PgSelect[49]<br />ᐳ: 42, 43, 44, 45, 46, 51, 52, 53, 54, 55, 56"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,JSONParse36,Access37,PgSelect38,First42,PgSelectSingle43,PgClassExpression44,PgClassExpression45,PgClassExpression46,JSONParse47,Access48,PgSelect49,First51,PgSelectSingle52,PgClassExpression53,PgClassExpression54,PgClassExpression55,PgClassExpression56 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 18<br /><br />ROOT __Item{5}ᐸ102ᐳ[104]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item104,PgUnionAllSingle105 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 105, 18<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[106]<br />2: JSONParse[107], JSONParse[118]<br />ᐳ: Access[108], Access[119]<br />3: PgSelect[109], PgSelect[120]<br />ᐳ: 113, 114, 115, 116, 117, 122, 123, 124, 125, 126, 127"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,Access106,JSONParse107,Access108,PgSelect109,First113,PgSelectSingle114,PgClassExpression115,PgClassExpression116,PgClassExpression117,JSONParse118,Access119,PgSelect120,First122,PgSelectSingle123,PgClassExpression124,PgClassExpression125,PgClassExpression126,PgClassExpression127 bucket6
    Bucket0 --> Bucket1 & Bucket5
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket5 --> Bucket6
    end
