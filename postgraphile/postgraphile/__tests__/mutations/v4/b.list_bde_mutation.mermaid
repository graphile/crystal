%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for mutations/v4/b.list_bde_mutation"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (mutationField)<br />Deps: 15, 16, 22<br /><br />1: PgSelect[12]<br />2: PgSelectRows[18]<br />ᐳ: 17, 19, 20, 21"):::bucket
    Bucket2("Bucket 2 (mutationField)<br />Deps: 39, 2, 28, 80, 81<br /><br />1: Access[30]<br />2: Access[31]<br />3: Object[32]<br />4: PgFromExpression[33]<br />5: PgSelect[29]<br />6: PgSelectRows[35]<br />ᐳ: 34, 36, 37, 38"):::bucket
    Bucket3("Bucket 3 (mutationField)<br />Deps: 56, 2, 45, 82, 83<br /><br />1: Access[47]<br />2: Access[48]<br />3: Object[49]<br />4: PgFromExpression[50]<br />5: PgSelect[46]<br />6: PgSelectRows[52]<br />ᐳ: 51, 53, 54, 55"):::bucket
    Bucket4("Bucket 4 (mutationField)<br />Deps: 73, 2, 62, 80, 84<br /><br />1: Access[64]<br />2: Access[65]<br />3: Object[66]<br />4: PgFromExpression[67]<br />5: PgSelect[63]<br />6: PgSelectRows[69]<br />ᐳ: 68, 70, 71, 72"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 21, 20<br /><br />ROOT Object{1}ᐸ{result}ᐳ[21]"):::bucket
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 38, 37<br /><br />ROOT Object{2}ᐸ{result}ᐳ[38]"):::bucket
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 55, 54<br /><br />ROOT Object{3}ᐸ{result}ᐳ[55]"):::bucket
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 72, 71<br /><br />ROOT Object{4}ᐸ{result}ᐳ[72]"):::bucket
    Bucket9("Bucket 9 (listItem)<br /><br />ROOT __Item{9}ᐸ20ᐳ[74]"):::bucket
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ37ᐳ[75]"):::bucket
    Bucket11("Bucket 11 (listItem)<br /><br />ROOT __Item{11}ᐸ54ᐳ[76]"):::bucket
    Bucket12("Bucket 12 (listItem)<br /><br />ROOT __Item{12}ᐸ71ᐳ[77]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4
    Bucket1 --> Bucket5
    Bucket2 --> Bucket6
    Bucket3 --> Bucket7
    Bucket4 --> Bucket8
    Bucket5 --> Bucket9
    Bucket6 --> Bucket10
    Bucket7 --> Bucket11
    Bucket8 --> Bucket12

    %% plan dependencies
    __InputObject6{{"__InputObject[6∈0] ➊"}}:::plan
    Constant8{{"Constant[8∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant78{{"Constant[78∈0] ➊<br />ᐸ'bar'ᐳ"}}:::plan
    Constant79{{"Constant[79∈0] ➊<br />ᐸ'q0'ᐳ"}}:::plan
    Constant8 & Constant78 & Constant79 --> __InputObject6
    __InputObject23{{"__InputObject[23∈0] ➊"}}:::plan
    Constant25{{"Constant[25∈0] ➊<br />ᐸ[ 'option-1' ]ᐳ"}}:::plan
    Constant80{{"Constant[80∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant81{{"Constant[81∈0] ➊<br />ᐸ'q1'ᐳ"}}:::plan
    Constant25 & Constant80 & Constant81 --> __InputObject23
    __InputObject40{{"__InputObject[40∈0] ➊"}}:::plan
    Constant42{{"Constant[42∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant82{{"Constant[82∈0] ➊<br />ᐸ'foo'ᐳ"}}:::plan
    Constant83{{"Constant[83∈0] ➊<br />ᐸ'q2'ᐳ"}}:::plan
    Constant42 & Constant82 & Constant83 --> __InputObject40
    __InputObject57{{"__InputObject[57∈0] ➊"}}:::plan
    Constant59{{"Constant[59∈0] ➊<br />ᐸ[ 'option-2' ]ᐳ"}}:::plan
    Constant84{{"Constant[84∈0] ➊<br />ᐸ'q3'ᐳ"}}:::plan
    Constant59 & Constant80 & Constant84 --> __InputObject57
    PgFromExpression16{{"PgFromExpression[16∈0] ➊"}}:::plan
    BakedInput11{{"BakedInput[11∈0] ➊"}}:::plan
    BakedInput11 & Constant78 & Constant79 --> PgFromExpression16
    Object15{{"Object[15∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access14{{"Access[14∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access13 & Access14 --> Object15
    Constant8 --> BakedInput11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access13
    __Value2 --> Access14
    ApplyInput22{{"ApplyInput[22∈0] ➊"}}:::plan
    __InputObject6 --> ApplyInput22
    BakedInput28{{"BakedInput[28∈0] ➊"}}:::plan
    Constant25 --> BakedInput28
    ApplyInput39{{"ApplyInput[39∈0] ➊"}}:::plan
    __InputObject23 --> ApplyInput39
    BakedInput45{{"BakedInput[45∈0] ➊"}}:::plan
    Constant42 --> BakedInput45
    ApplyInput56{{"ApplyInput[56∈0] ➊"}}:::plan
    __InputObject40 --> ApplyInput56
    BakedInput62{{"BakedInput[62∈0] ➊"}}:::plan
    Constant59 --> BakedInput62
    ApplyInput73{{"ApplyInput[73∈0] ➊"}}:::plan
    __InputObject57 --> ApplyInput73
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect12[["PgSelect[12∈1] ➊<br />ᐸlist_bde_mutation(mutation)ᐳ"]]:::sideeffectplan
    Object15 & PgFromExpression16 & ApplyInput22 --> PgSelect12
    First17{{"First[17∈1] ➊"}}:::plan
    PgSelectRows18[["PgSelectRows[18∈1] ➊"]]:::plan
    PgSelectRows18 --> First17
    PgSelect12 --> PgSelectRows18
    PgSelectSingle19{{"PgSelectSingle[19∈1] ➊<br />ᐸlist_bde_mutationᐳ"}}:::plan
    First17 --> PgSelectSingle19
    PgClassExpression20{{"PgClassExpression[20∈1] ➊<br />ᐸ__list_bde_mutation__.vᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression20
    Object21{{"Object[21∈1] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgClassExpression20 --> Object21
    PgSelect29[["PgSelect[29∈2] ➊<br />ᐸlist_bde_mutation(mutation)ᐳ"]]:::sideeffectplan
    Object32{{"Object[32∈2] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgFromExpression33{{"PgFromExpression[33∈2] ➊"}}:::plan
    Object32 & PgFromExpression33 & ApplyInput39 --> PgSelect29
    BakedInput28 & Constant80 & Constant81 --> PgFromExpression33
    Access30{{"Access[30∈2] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access31{{"Access[31∈2] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access30 & Access31 --> Object32
    __Value2 --> Access30
    __Value2 --> Access31
    First34{{"First[34∈2] ➊"}}:::plan
    PgSelectRows35[["PgSelectRows[35∈2] ➊"]]:::plan
    PgSelectRows35 --> First34
    PgSelect29 --> PgSelectRows35
    PgSelectSingle36{{"PgSelectSingle[36∈2] ➊<br />ᐸlist_bde_mutationᐳ"}}:::plan
    First34 --> PgSelectSingle36
    PgClassExpression37{{"PgClassExpression[37∈2] ➊<br />ᐸ__list_bde_mutation__.vᐳ"}}:::plan
    PgSelectSingle36 --> PgClassExpression37
    Object38{{"Object[38∈2] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgClassExpression37 --> Object38
    PgSelect46[["PgSelect[46∈3] ➊<br />ᐸlist_bde_mutation(mutation)ᐳ"]]:::sideeffectplan
    Object49{{"Object[49∈3] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgFromExpression50{{"PgFromExpression[50∈3] ➊"}}:::plan
    Object49 & PgFromExpression50 & ApplyInput56 --> PgSelect46
    BakedInput45 & Constant82 & Constant83 --> PgFromExpression50
    Access47{{"Access[47∈3] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access48{{"Access[48∈3] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access47 & Access48 --> Object49
    __Value2 --> Access47
    __Value2 --> Access48
    First51{{"First[51∈3] ➊"}}:::plan
    PgSelectRows52[["PgSelectRows[52∈3] ➊"]]:::plan
    PgSelectRows52 --> First51
    PgSelect46 --> PgSelectRows52
    PgSelectSingle53{{"PgSelectSingle[53∈3] ➊<br />ᐸlist_bde_mutationᐳ"}}:::plan
    First51 --> PgSelectSingle53
    PgClassExpression54{{"PgClassExpression[54∈3] ➊<br />ᐸ__list_bde_mutation__.vᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression54
    Object55{{"Object[55∈3] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgClassExpression54 --> Object55
    PgSelect63[["PgSelect[63∈4] ➊<br />ᐸlist_bde_mutation(mutation)ᐳ"]]:::sideeffectplan
    Object66{{"Object[66∈4] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgFromExpression67{{"PgFromExpression[67∈4] ➊"}}:::plan
    Object66 & PgFromExpression67 & ApplyInput73 --> PgSelect63
    BakedInput62 & Constant80 & Constant84 --> PgFromExpression67
    Access64{{"Access[64∈4] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access65{{"Access[65∈4] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access64 & Access65 --> Object66
    __Value2 --> Access64
    __Value2 --> Access65
    First68{{"First[68∈4] ➊"}}:::plan
    PgSelectRows69[["PgSelectRows[69∈4] ➊"]]:::plan
    PgSelectRows69 --> First68
    PgSelect63 --> PgSelectRows69
    PgSelectSingle70{{"PgSelectSingle[70∈4] ➊<br />ᐸlist_bde_mutationᐳ"}}:::plan
    First68 --> PgSelectSingle70
    PgClassExpression71{{"PgClassExpression[71∈4] ➊<br />ᐸ__list_bde_mutation__.vᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression71
    Object72{{"Object[72∈4] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgClassExpression71 --> Object72
    __Item74[/"__Item[74∈9]<br />ᐸ20ᐳ"\]:::itemplan
    PgClassExpression20 ==> __Item74
    __Item75[/"__Item[75∈10]<br />ᐸ37ᐳ"\]:::itemplan
    PgClassExpression37 ==> __Item75
    __Item76[/"__Item[76∈11]<br />ᐸ54ᐳ"\]:::itemplan
    PgClassExpression54 ==> __Item76
    __Item77[/"__Item[77∈12]<br />ᐸ71ᐳ"\]:::itemplan
    PgClassExpression71 ==> __Item77

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,__InputObject6,Constant8,BakedInput11,Access13,Access14,Object15,PgFromExpression16,ApplyInput22,__InputObject23,Constant25,BakedInput28,ApplyInput39,__InputObject40,Constant42,BakedInput45,ApplyInput56,__InputObject57,Constant59,BakedInput62,ApplyInput73,Constant78,Constant79,Constant80,Constant81,Constant82,Constant83,Constant84 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect12,First17,PgSelectRows18,PgSelectSingle19,PgClassExpression20,Object21 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect29,Access30,Access31,Object32,PgFromExpression33,First34,PgSelectRows35,PgSelectSingle36,PgClassExpression37,Object38 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect46,Access47,Access48,Object49,PgFromExpression50,First51,PgSelectRows52,PgSelectSingle53,PgClassExpression54,Object55 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect63,Access64,Access65,Object66,PgFromExpression67,First68,PgSelectRows69,PgSelectSingle70,PgClassExpression71,Object72 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item74 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item75 bucket10
    classDef bucket11 stroke:#00ffff
    class Bucket11,__Item76 bucket11
    classDef bucket12 stroke:#4169e1
    class Bucket12,__Item77 bucket12

