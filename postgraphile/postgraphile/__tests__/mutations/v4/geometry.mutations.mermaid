%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object87{{"Object[87∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access85{{"Access[85∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access86{{"Access[86∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Access85 & Access86 --> Object87
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value3 --> Access85
    __Value3 --> Access86
    __Value0["__Value[0∈0]"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Constant209{{"Constant[209∈0]<br />ᐸ[Object: null prototype] { x: 99, y: 1234 }ᐳ"}}:::plan
    Constant222{{"Constant[222∈0]<br />ᐸ[Object: null prototype] {   a: [Object: null prototype] { xᐳ"}}:::plan
    Constant223{{"Constant[223∈0]<br />ᐸ[Object: null prototype] {   a: [Object: null prototype] { xᐳ"}}:::plan
    Constant224{{"Constant[224∈0]<br />ᐸ[Object: null prototype] {   a: [Object: null prototype] { xᐳ"}}:::plan
    Constant226{{"Constant[226∈0]<br />ᐸ[Object: null prototype] {   center: [Object: null prototypeᐳ"}}:::plan
    Constant227{{"Constant[227∈0]<br />ᐸ[Object: null prototype] {   points: [     [Object: null proᐳ"}}:::plan
    Constant228{{"Constant[228∈0]<br />ᐸ[Object: null prototype] {   points: [     [Object: null proᐳ"}}:::plan
    Constant229{{"Constant[229∈0]<br />ᐸ[Object: null prototype] {   points: [     [Object: null proᐳ"}}:::plan
    PgInsertSingle84[["PgInsertSingle[84∈1]<br />ᐸgeom(point,line,lseg,box,open_path,closed_path,polygon,circle)ᐳ"]]:::sideeffectplan
    Object87 & Constant209 & Constant222 & Constant223 & Constant224 & Constant227 & Constant228 & Constant229 & Constant226 --> PgInsertSingle84
    Object88{{"Object[88∈1]<br />ᐸ{result}ᐳ"}}:::plan
    PgInsertSingle84 --> Object88
    PgClassExpression119{{"PgClassExpression[119∈3]<br />ᐸ__geom__.”id”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression119
    PgClassExpression120{{"PgClassExpression[120∈3]<br />ᐸ__geom__.”point”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression120
    PgClassExpression123{{"PgClassExpression[123∈3]<br />ᐸ__geom__.”line”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression123
    PgClassExpression130{{"PgClassExpression[130∈3]<br />ᐸ__geom__.”lseg”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression130
    PgClassExpression137{{"PgClassExpression[137∈3]<br />ᐸ__geom__.”box”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression137
    PgClassExpression144{{"PgClassExpression[144∈3]<br />ᐸ__geom__.”open_path”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression144
    PgClassExpression150{{"PgClassExpression[150∈3]<br />ᐸ__geom__.”closed_path”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression150
    PgClassExpression156{{"PgClassExpression[156∈3]<br />ᐸ__geom__.”polygon”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression156
    PgClassExpression161{{"PgClassExpression[161∈3]<br />ᐸ__geom__.”circle”ᐳ"}}:::plan
    PgInsertSingle84 --> PgClassExpression161
    Access146{{"Access[146∈8]<br />ᐸ144.pointsᐳ"}}:::plan
    PgClassExpression144 --> Access146
    __Item147[/"__Item[147∈9]<br />ᐸ146ᐳ"\]:::itemplan
    Access146 ==> __Item147
    Access152{{"Access[152∈10]<br />ᐸ150.pointsᐳ"}}:::plan
    PgClassExpression150 --> Access152
    __Item153[/"__Item[153∈11]<br />ᐸ152ᐳ"\]:::itemplan
    Access152 ==> __Item153
    Access157{{"Access[157∈12]<br />ᐸ156.pointsᐳ"}}:::plan
    PgClassExpression156 --> Access157
    __Item158[/"__Item[158∈13]<br />ᐸ157ᐳ"\]:::itemplan
    Access157 ==> __Item158

    %% define steps

    subgraph "Buckets for mutations/v4/geometry.mutations"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__Value5,Access85,Access86,Object87,Constant209,Constant222,Constant223,Constant224,Constant226,Constant227,Constant228,Constant229 bucket0
    Bucket1("Bucket 1 (mutationField)<br />Deps: 87, 209, 222, 223, 224, 227, 228, 229, 226<br /><br />1: PgInsertSingle[84]<br />2: <br />ᐳ: Object[88]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgInsertSingle84,Object88 bucket1
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 88, 84<br /><br />ROOT Object{1}ᐸ{result}ᐳ[88]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 84<br /><br />ROOT PgInsertSingle{1}ᐸgeom(point,line,lseg,box,open_path,closed_path,polygon,circle)ᐳ[84]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression119,PgClassExpression120,PgClassExpression123,PgClassExpression130,PgClassExpression137,PgClassExpression144,PgClassExpression150,PgClassExpression156,PgClassExpression161 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 120<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”point”ᐳ[120]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 123<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”line”ᐳ[123]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 130<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”lseg”ᐳ[130]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 137<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”box”ᐳ[137]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 144<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”open_path”ᐳ[144]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,Access146 bucket8
    Bucket9("Bucket 9 (listItem)<br />ROOT __Item{9}ᐸ146ᐳ[147]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item147 bucket9
    Bucket10("Bucket 10 (nullableBoundary)<br />Deps: 150<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”closed_path”ᐳ[150]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,Access152 bucket10
    Bucket11("Bucket 11 (listItem)<br />ROOT __Item{11}ᐸ152ᐳ[153]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,__Item153 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 156<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”polygon”ᐳ[156]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,Access157 bucket12
    Bucket13("Bucket 13 (listItem)<br />ROOT __Item{13}ᐸ157ᐳ[158]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,__Item158 bucket13
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 161<br /><br />ROOT PgClassExpression{3}ᐸ__geom__.”circle”ᐳ[161]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14 bucket14
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5 & Bucket6 & Bucket7 & Bucket8 & Bucket10 & Bucket12 & Bucket14
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket12 --> Bucket13
    end
