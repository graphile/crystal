%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    __InputObject8{{"__InputObject[8∈0] ➊"}}:::plan
    Constant55{{"Constant[55∈0] ➊<br />ᐸ'2023-05-24T07:43:00Z'ᐳ"}}:::plan
    Constant56{{"Constant[56∈0] ➊<br />ᐸ'temp'ᐳ"}}:::plan
    Constant57{{"Constant[57∈0] ➊<br />ᐸ12.7ᐳ"}}:::plan
    Constant58{{"Constant[58∈0] ➊<br />ᐸ4ᐳ"}}:::plan
    Constant55 & Constant56 & Constant57 & Constant58 --> __InputObject8
    __InputObject31{{"__InputObject[31∈0] ➊"}}:::plan
    __InputObject35{{"__InputObject[35∈0] ➊"}}:::plan
    Constant55 & Constant56 & __InputObject35 --> __InputObject31
    __InputObject6{{"__InputObject[6∈0] ➊"}}:::plan
    __InputObject8 --> __InputObject6
    Object16{{"Object[16∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access14{{"Access[14∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access14 & Access15 --> Object16
    Constant59{{"Constant[59∈0] ➊<br />ᐸ13ᐳ"}}:::plan
    Constant59 --> __InputObject35
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access14
    __Value2 --> Access15
    ApplyInput17{{"ApplyInput[17∈0] ➊"}}:::plan
    __InputObject6 --> ApplyInput17
    ApplyInput41{{"ApplyInput[41∈0] ➊"}}:::plan
    __InputObject31 --> ApplyInput41
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgInsertSingle13[["PgInsertSingle[13∈1] ➊<br />ᐸmeasurements()ᐳ"]]:::sideeffectplan
    Object16 & ApplyInput17 --> PgInsertSingle13
    PgSelect24[["PgSelect[24∈1] ➊<br />ᐸusersᐳ"]]:::plan
    PgClassExpression23{{"PgClassExpression[23∈1] ➊<br />ᐸ__measurem....”user_id”ᐳ"}}:::plan
    Object16 & PgClassExpression23 --> PgSelect24
    Object18{{"Object[18∈1] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgInsertSingle13 --> Object18
    PgClassExpression19{{"PgClassExpression[19∈1] ➊<br />ᐸ__measurem...timestamp”ᐳ"}}:::plan
    Access20{{"Access[20∈1] ➊<br />ᐸ13.tᐳ"}}:::plan
    Access20 --> PgClassExpression19
    PgInsertSingle13 --> Access20
    PgClassExpression21{{"PgClassExpression[21∈1] ➊<br />ᐸ__measurements__.”key”ᐳ"}}:::plan
    Access20 --> PgClassExpression21
    PgClassExpression22{{"PgClassExpression[22∈1] ➊<br />ᐸ__measurem...__.”value”ᐳ"}}:::plan
    Access20 --> PgClassExpression22
    Access20 --> PgClassExpression23
    First26{{"First[26∈1] ➊"}}:::plan
    PgSelectRows27[["PgSelectRows[27∈1] ➊"]]:::plan
    PgSelectRows27 --> First26
    PgSelect24 --> PgSelectRows27
    PgSelectSingle28{{"PgSelectSingle[28∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First26 --> PgSelectSingle28
    PgClassExpression29{{"PgClassExpression[29∈1] ➊<br />ᐸ__users__.”id”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression29
    PgClassExpression30{{"PgClassExpression[30∈1] ➊<br />ᐸ__users__.”name”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression30
    PgUpdateSingle37[["PgUpdateSingle[37∈2] ➊<br />ᐸmeasurements(timestamp,key;)ᐳ"]]:::sideeffectplan
    Object40{{"Object[40∈2] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Object40 & Constant55 & Constant56 & ApplyInput41 --> PgUpdateSingle37
    Access38{{"Access[38∈2] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access39{{"Access[39∈2] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access38 & Access39 --> Object40
    PgSelect48[["PgSelect[48∈2] ➊<br />ᐸusersᐳ"]]:::plan
    PgClassExpression47{{"PgClassExpression[47∈2] ➊<br />ᐸ__measurem....”user_id”ᐳ"}}:::plan
    Object40 & PgClassExpression47 --> PgSelect48
    __Value2 --> Access38
    __Value2 --> Access39
    Object42{{"Object[42∈2] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgUpdateSingle37 --> Object42
    PgClassExpression43{{"PgClassExpression[43∈2] ➊<br />ᐸ__measurem...timestamp”ᐳ"}}:::plan
    Access44{{"Access[44∈2] ➊<br />ᐸ37.tᐳ"}}:::plan
    Access44 --> PgClassExpression43
    PgUpdateSingle37 --> Access44
    PgClassExpression45{{"PgClassExpression[45∈2] ➊<br />ᐸ__measurements__.”key”ᐳ"}}:::plan
    Access44 --> PgClassExpression45
    PgClassExpression46{{"PgClassExpression[46∈2] ➊<br />ᐸ__measurem...__.”value”ᐳ"}}:::plan
    Access44 --> PgClassExpression46
    Access44 --> PgClassExpression47
    First50{{"First[50∈2] ➊"}}:::plan
    PgSelectRows51[["PgSelectRows[51∈2] ➊"]]:::plan
    PgSelectRows51 --> First50
    PgSelect48 --> PgSelectRows51
    PgSelectSingle52{{"PgSelectSingle[52∈2] ➊<br />ᐸusersᐳ"}}:::plan
    First50 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈2] ➊<br />ᐸ__users__.”id”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈2] ➊<br />ᐸ__users__.”name”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression54

    %% define steps

    subgraph "Buckets for mutations/v4/partitions.unqualified"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,__InputObject6,__InputObject8,Access14,Access15,Object16,ApplyInput17,__InputObject31,__InputObject35,ApplyInput41,Constant55,Constant56,Constant57,Constant58,Constant59 bucket0
    Bucket1("Bucket 1 (mutationField)<br />Deps: 16, 17<br /><br />1: PgInsertSingle[13]<br />2: <br />ᐳ: 18, 20, 19, 21, 22, 23<br />3: PgSelect[24]<br />4: PgSelectRows[27]<br />ᐳ: 26, 28, 29, 30"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgInsertSingle13,Object18,PgClassExpression19,Access20,PgClassExpression21,PgClassExpression22,PgClassExpression23,PgSelect24,First26,PgSelectRows27,PgSelectSingle28,PgClassExpression29,PgClassExpression30 bucket1
    Bucket2("Bucket 2 (mutationField)<br />Deps: 55, 56, 41, 2<br /><br />1: Access[38]<br />2: Access[39]<br />3: Object[40]<br />4: PgUpdateSingle[37]<br />5: <br />ᐳ: 42, 44, 43, 45, 46, 47<br />6: PgSelect[48]<br />7: PgSelectRows[51]<br />ᐳ: 50, 52, 53, 54"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgUpdateSingle37,Access38,Access39,Object40,Object42,PgClassExpression43,Access44,PgClassExpression45,PgClassExpression46,PgClassExpression47,PgSelect48,First50,PgSelectRows51,PgSelectSingle52,PgClassExpression53,PgClassExpression54 bucket2
    Bucket0 --> Bucket1 & Bucket2
    end
