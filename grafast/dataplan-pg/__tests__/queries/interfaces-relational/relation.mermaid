%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸrelational_itemsᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant335{{"Constant[335∈0] ➊<br />ᐸ15ᐳ"}}:::plan
    Object10 & Constant335 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgPolymorphic15{{"PgPolymorphic[15∈0] ➊"}}:::plan
    PgSelectSingle13{{"PgSelectSingle[13∈0] ➊<br />ᐸrelational_itemsᐳ"}}:::plan
    PgClassExpression14{{"PgClassExpression[14∈0] ➊<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle13 & PgClassExpression14 --> PgPolymorphic15
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    First11{{"First[11∈0] ➊"}}:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelectRows12 --> First11
    PgSelect7 --> PgSelectRows12
    First11 --> PgSelectSingle13
    PgSelectSingle13 --> PgClassExpression14
    PgClassExpression16{{"PgClassExpression[16∈0] ➊<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression16
    PgClassExpression24{{"PgClassExpression[24∈0] ➊<br />ᐸ__relation...parent_id”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression24
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect17[["PgSelect[17∈1] ➊<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopic"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect17
    PgSelect25[["PgSelect[25∈1] ➊<br />ᐸrelational_itemsᐳ<br />ᐳRelationalTopic<br />ᐳRelationalPost<br />ᐳRelationalDivider<br />ᐳRelationalChecklist<br />ᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression24 --> PgSelect25
    PgPolymorphic31{{"PgPolymorphic[31∈1] ➊<br />ᐳRelationalTopic<br />ᐳRelationalPost<br />ᐳRelationalDivider<br />ᐳRelationalChecklist<br />ᐳRelationalChecklistItem"}}:::plan
    PgSelectSingle29{{"PgSelectSingle[29∈1] ➊<br />ᐸrelational_itemsᐳ"}}:::plan
    PgClassExpression30{{"PgClassExpression[30∈1] ➊<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle29 & PgClassExpression30 --> PgPolymorphic31
    PgSelect87[["PgSelect[87∈1] ➊<br />ᐸrelational_postsᐳ<br />ᐳRelationalPost"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect87
    PgSelect149[["PgSelect[149∈1] ➊<br />ᐸrelational_dividersᐳ<br />ᐳRelationalDivider"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect149
    PgSelect211[["PgSelect[211∈1] ➊<br />ᐸrelational_checklistsᐳ<br />ᐳRelationalChecklist"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect211
    PgSelect273[["PgSelect[273∈1] ➊<br />ᐸrelational_checklist_itemsᐳ<br />ᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect273
    First21{{"First[21∈1] ➊"}}:::plan
    PgSelectRows22[["PgSelectRows[22∈1] ➊"]]:::plan
    PgSelectRows22 --> First21
    PgSelect17 --> PgSelectRows22
    PgSelectSingle23{{"PgSelectSingle[23∈1] ➊<br />ᐸrelational_topicsᐳ"}}:::plan
    First21 --> PgSelectSingle23
    First27{{"First[27∈1] ➊"}}:::plan
    PgSelectRows28[["PgSelectRows[28∈1] ➊"]]:::plan
    PgSelectRows28 --> First27
    PgSelect25 --> PgSelectRows28
    First27 --> PgSelectSingle29
    PgSelectSingle29 --> PgClassExpression30
    PgClassExpression32{{"PgClassExpression[32∈1] ➊<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression32
    PgClassExpression40{{"PgClassExpression[40∈1] ➊<br />ᐸ__relation...author_id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression40
    First89{{"First[89∈1] ➊"}}:::plan
    PgSelectRows90[["PgSelectRows[90∈1] ➊"]]:::plan
    PgSelectRows90 --> First89
    PgSelect87 --> PgSelectRows90
    PgSelectSingle91{{"PgSelectSingle[91∈1] ➊<br />ᐸrelational_postsᐳ"}}:::plan
    First89 --> PgSelectSingle91
    First151{{"First[151∈1] ➊"}}:::plan
    PgSelectRows152[["PgSelectRows[152∈1] ➊"]]:::plan
    PgSelectRows152 --> First151
    PgSelect149 --> PgSelectRows152
    PgSelectSingle153{{"PgSelectSingle[153∈1] ➊<br />ᐸrelational_dividersᐳ"}}:::plan
    First151 --> PgSelectSingle153
    First213{{"First[213∈1] ➊"}}:::plan
    PgSelectRows214[["PgSelectRows[214∈1] ➊"]]:::plan
    PgSelectRows214 --> First213
    PgSelect211 --> PgSelectRows214
    PgSelectSingle215{{"PgSelectSingle[215∈1] ➊<br />ᐸrelational_checklistsᐳ"}}:::plan
    First213 --> PgSelectSingle215
    First275{{"First[275∈1] ➊"}}:::plan
    PgSelectRows276[["PgSelectRows[276∈1] ➊"]]:::plan
    PgSelectRows276 --> First275
    PgSelect273 --> PgSelectRows276
    PgSelectSingle277{{"PgSelectSingle[277∈1] ➊<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    First275 --> PgSelectSingle277
    PgSelect33[["PgSelect[33∈2] ➊<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopicᐳRelationalTopic<br />ᐳRelationalPostᐳRelationalTopic<br />ᐳRelationalDividerᐳRelationalTopic<br />ᐳRelationalChecklistᐳRelationalTopic<br />ᐳRelationalChecklistItemᐳRelationalTopic"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect33
    PgSelect41[["PgSelect[41∈2] ➊<br />ᐸpeopleᐳ<br />ᐳRelationalTopicᐳRelationalTopic<br />ᐳRelationalTopicᐳRelationalPost<br />ᐳRelationalTopicᐳRelationalDivider<br />ᐳRelationalTopicᐳRelationalChecklist<br />ᐳRelationalTopicᐳRelationalChecklistItem<br />ᐳRelationalPostᐳRelationalTopic<br />ᐳRelationalPostᐳRelationalPost<br />ᐳRelationalPostᐳRelationalDivider<br />ᐳRelationalPostᐳRelationalChecklist<br />ᐳRelationalPostᐳRelationalChecklistItem<br />ᐳRelationalDividerᐳRelationalTopic<br />ᐳRelationalDividerᐳRelationalPost<br />ᐳRelationalDividerᐳRelationalDivider<br />ᐳRelationalDividerᐳRelationalChecklist<br />ᐳRelationalDividerᐳRelationalChecklistItem<br />ᐳRelationalChecklistᐳRelationalTopic<br />ᐳRelationalChecklistᐳRelationalPost<br />ᐳRelationalChecklistᐳRelationalDivider<br />ᐳRelationalChecklistᐳRelationalChecklist<br />ᐳRelationalChecklistᐳRelationalChecklistItem<br />ᐳRelationalChecklistItemᐳRelationalTopic<br />ᐳRelationalChecklistItemᐳRelationalPost<br />ᐳRelationalChecklistItemᐳRelationalDivider<br />ᐳRelationalChecklistItemᐳRelationalChecklist<br />ᐳRelationalChecklistItemᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression40 --> PgSelect41
    PgSelect47[["PgSelect[47∈2] ➊<br />ᐸrelational_postsᐳ<br />ᐳRelationalTopicᐳRelationalPost<br />ᐳRelationalPostᐳRelationalPost<br />ᐳRelationalDividerᐳRelationalPost<br />ᐳRelationalChecklistᐳRelationalPost<br />ᐳRelationalChecklistItemᐳRelationalPost"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect47
    PgSelect57[["PgSelect[57∈2] ➊<br />ᐸrelational_dividersᐳ<br />ᐳRelationalTopicᐳRelationalDivider<br />ᐳRelationalPostᐳRelationalDivider<br />ᐳRelationalDividerᐳRelationalDivider<br />ᐳRelationalChecklistᐳRelationalDivider<br />ᐳRelationalChecklistItemᐳRelationalDivider"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect57
    PgSelect67[["PgSelect[67∈2] ➊<br />ᐸrelational_checklistsᐳ<br />ᐳRelationalTopicᐳRelationalChecklist<br />ᐳRelationalPostᐳRelationalChecklist<br />ᐳRelationalDividerᐳRelationalChecklist<br />ᐳRelationalChecklistᐳRelationalChecklist<br />ᐳRelationalChecklistItemᐳRelationalChecklist"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect67
    PgSelect77[["PgSelect[77∈2] ➊<br />ᐸrelational_checklist_itemsᐳ<br />ᐳRelationalTopicᐳRelationalChecklistItem<br />ᐳRelationalPostᐳRelationalChecklistItem<br />ᐳRelationalDividerᐳRelationalChecklistItem<br />ᐳRelationalChecklistᐳRelationalChecklistItem<br />ᐳRelationalChecklistItemᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect77
    First37{{"First[37∈2] ➊"}}:::plan
    PgSelectRows38[["PgSelectRows[38∈2] ➊"]]:::plan
    PgSelectRows38 --> First37
    PgSelect33 --> PgSelectRows38
    PgSelectSingle39{{"PgSelectSingle[39∈2] ➊<br />ᐸrelational_topicsᐳ"}}:::plan
    First37 --> PgSelectSingle39
    First43{{"First[43∈2] ➊"}}:::plan
    PgSelectRows44[["PgSelectRows[44∈2] ➊"]]:::plan
    PgSelectRows44 --> First43
    PgSelect41 --> PgSelectRows44
    PgSelectSingle45{{"PgSelectSingle[45∈2] ➊<br />ᐸpeopleᐳ"}}:::plan
    First43 --> PgSelectSingle45
    First49{{"First[49∈2] ➊"}}:::plan
    PgSelectRows50[["PgSelectRows[50∈2] ➊"]]:::plan
    PgSelectRows50 --> First49
    PgSelect47 --> PgSelectRows50
    PgSelectSingle51{{"PgSelectSingle[51∈2] ➊<br />ᐸrelational_postsᐳ"}}:::plan
    First49 --> PgSelectSingle51
    First59{{"First[59∈2] ➊"}}:::plan
    PgSelectRows60[["PgSelectRows[60∈2] ➊"]]:::plan
    PgSelectRows60 --> First59
    PgSelect57 --> PgSelectRows60
    PgSelectSingle61{{"PgSelectSingle[61∈2] ➊<br />ᐸrelational_dividersᐳ"}}:::plan
    First59 --> PgSelectSingle61
    First69{{"First[69∈2] ➊"}}:::plan
    PgSelectRows70[["PgSelectRows[70∈2] ➊"]]:::plan
    PgSelectRows70 --> First69
    PgSelect67 --> PgSelectRows70
    PgSelectSingle71{{"PgSelectSingle[71∈2] ➊<br />ᐸrelational_checklistsᐳ"}}:::plan
    First69 --> PgSelectSingle71
    First79{{"First[79∈2] ➊"}}:::plan
    PgSelectRows80[["PgSelectRows[80∈2] ➊"]]:::plan
    PgSelectRows80 --> First79
    PgSelect77 --> PgSelectRows80
    PgSelectSingle81{{"PgSelectSingle[81∈2] ➊<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    First79 --> PgSelectSingle81
    PgClassExpression46{{"PgClassExpression[46∈3] ➊<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression46

    %% define steps

    subgraph "Buckets for queries/interfaces-relational/relation"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 335, 10<br />2: PgSelect[7]<br />3: PgSelectRows[12]<br />ᐳ: 11, 13, 14, 15, 16, 24"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,First11,PgSelectRows12,PgSelectSingle13,PgClassExpression14,PgPolymorphic15,PgClassExpression16,PgClassExpression24,Constant335 bucket0
    Bucket1("Bucket 1 (polymorphic)<br />RelationalTopic,RelationalPost,RelationalDivider,RelationalChecklist,RelationalChecklistItem<br />Deps: 10, 16, 24, 15<br />ᐳRelationalTopic<br />ᐳRelationalPost<br />ᐳRelationalDivider<br />ᐳRelationalChecklist<br />ᐳRelationalChecklistItem<br /><br />1: 17, 25, 87, 149, 211, 273<br />2: 22, 28, 90, 152, 214, 276<br />ᐳ: 21, 23, 27, 29, 30, 31, 32, 40, 89, 91, 151, 153, 213, 215, 275, 277"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect17,First21,PgSelectRows22,PgSelectSingle23,PgSelect25,First27,PgSelectRows28,PgSelectSingle29,PgClassExpression30,PgPolymorphic31,PgClassExpression32,PgClassExpression40,PgSelect87,First89,PgSelectRows90,PgSelectSingle91,PgSelect149,First151,PgSelectRows152,PgSelectSingle153,PgSelect211,First213,PgSelectRows214,PgSelectSingle215,PgSelect273,First275,PgSelectRows276,PgSelectSingle277 bucket1
    Bucket2("Bucket 2 (polymorphic)<br />RelationalTopic,RelationalPost,RelationalDivider,RelationalChecklist,RelationalChecklistItem<br />Deps: 10, 32, 40, 31<br />ᐳRelationalTopicᐳRelationalTopic<br />ᐳRelationalTopicᐳRelationalPost<br />ᐳRelationalTopicᐳRelationalDivider<br />ᐳRelationalTopicᐳRelationalChecklist<br />ᐳRelationalTopicᐳRelationalChecklistItem<br />ᐳRelationalPostᐳRelationalTopic<br />ᐳRelationalPostᐳRelationalPost<br />ᐳRelationalPostᐳRelationalDivider<br />ᐳRelationalPostᐳRelationalChecklist<br />ᐳRelationalPostᐳRelationalChecklistItem<br />ᐳRelationalDividerᐳRelationalTopic<br />ᐳRelationalDividerᐳRelationalPost<br />ᐳRelationalDividerᐳRelationalDivider<br />ᐳRelationalDividerᐳRelationalChecklist<br />ᐳRelationalDividerᐳRelationalChecklistItem<br />ᐳRelationalChecklistᐳRelationalTopic<br />ᐳRelationalChecklistᐳRelationalPost<br />ᐳRelationalChecklistᐳRelationalDivider<br />ᐳRelationalChecklistᐳRelationalChecklist<br />ᐳRelationalChecklistᐳRelationalChecklistItem<br />ᐳRelationalChecklistItemᐳRelationalTopic<br />ᐳRelationalChecklistItemᐳRelationalPost<br />ᐳRelationalChecklistItemᐳRelationalDivider<br />ᐳRelationalChecklistItemᐳRelationalChecklist<br />ᐳRelationalChecklistItemᐳRelationalChecklistItem<br /><br />1: 33, 41, 47, 57, 67, 77<br />2: 38, 44, 50, 60, 70, 80<br />ᐳ: 37, 39, 43, 45, 49, 51, 59, 61, 69, 71, 79, 81"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect33,First37,PgSelectRows38,PgSelectSingle39,PgSelect41,First43,PgSelectRows44,PgSelectSingle45,PgSelect47,First49,PgSelectRows50,PgSelectSingle51,PgSelect57,First59,PgSelectRows60,PgSelectSingle61,PgSelect67,First69,PgSelectRows70,PgSelectSingle71,PgSelect77,First79,PgSelectRows80,PgSelectSingle81 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 45<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[45]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression46 bucket3
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    end
