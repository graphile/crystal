%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/interfaces-relational/commentables"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: Access[8], Access[9], Object[10]<br />2: PgSelect[7]<br />3: PgSelectRows[12]<br />4: __ListTransform[11]"):::bucket
    Bucket1("Bucket 1 (subroutine)<br /><br />ROOT PgSelectSingle{1}ᐸrelational_commentablesᐳ[14]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 10<br /><br />ROOT __Item{2}ᐸ11ᐳ[15]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />__typename: Access[24]<br />Deps: 24, 10, 25"):::bucket
    Bucket4("Bucket 4 (polymorphicPartition)<br />|RelationalPost<br />Deps: 10, 25<br />ᐳRelationalPost<br /><br />1: PgSelectInlineApply[118]<br />2: PgSelect[26]<br />ᐳ: Access[119]<br />3: PgSelectRows[31]<br />ᐳ: 30, 32, 49, 112, 115, 117, 120, 121<br />4: PgSelectRows[57]<br />ᐳ: 56, 58, 59, 81, 99"):::bucket
    Bucket5("Bucket 5 (polymorphicPartition)<br />|RelationalChecklist<br />Deps: 10, 25<br />ᐳRelationalChecklist<br /><br />1: PgSelectInlineApply[122]<br />2: PgSelect[34]<br />ᐳ: Access[123]<br />3: PgSelectRows[39]<br />ᐳ: 38, 40, 50, 113, 124, 125<br />4: PgSelectRows[65]<br />ᐳ: 64, 66, 67, 87, 105"):::bucket
    Bucket6("Bucket 6 (polymorphicPartition)<br />|RelationalChecklistItem<br />Deps: 10, 25<br />ᐳRelationalChecklistItem<br /><br />1: PgSelectInlineApply[126]<br />2: PgSelect[42]<br />ᐳ: Access[127]<br />3: PgSelectRows[47]<br />ᐳ: 46, 48, 51, 114, 116, 128, 129<br />4: PgSelectRows[73]<br />ᐳ: 72, 74, 75, 93, 111"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5 & Bucket6

    %% plan dependencies
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ<br />Dependents: 4"}}:::plan
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸrelational_commentablesᐳ<br />More deps:<br />- Object[10]"]]:::plan
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    __ListTransform11[["__ListTransform[11∈0] ➊<br />ᐸeach:7ᐳ<br />More deps:<br />- PgSelectRows[12]"]]:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊<br />Dependents: 2"]]:::plan
    PgSelect7 --> PgSelectRows12
    __Item13[/"__Item[13∈1]<br />ᐸ12ᐳ<br />More deps:<br />- PgSelectRows[12]"\]:::itemplan
    PgSelectSingle14{{"PgSelectSingle[14∈1]<br />ᐸrelational_commentablesᐳ"}}:::plan
    __Item13 --> PgSelectSingle14
    Object22{{"Object[22∈2]<br />ᐸ{__typename,id}ᐳ"}}:::plan
    Lambda21{{"Lambda[21∈2]<br />ᐸrelationalItemTypeNameFromTypeᐳ"}}:::plan
    PgClassExpression17{{"PgClassExpression[17∈2]<br />ᐸ__relation...les__.”id”ᐳ"}}:::plan
    PgClassExpression17 -->|rejectNull| Object22
    Lambda21 --> Object22
    __Item15[/"__Item[15∈2]<br />ᐸ11ᐳ"\]:::itemplan
    __ListTransform11 ==> __Item15
    PgSelectSingle16{{"PgSelectSingle[16∈2]<br />ᐸrelational_commentablesᐳ"}}:::plan
    __Item15 --> PgSelectSingle16
    PgSelectSingle16 --> PgClassExpression17
    PgClassExpression19{{"PgClassExpression[19∈2]<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression19
    PgClassExpression19 -->|rejectNull| Lambda21
    Access24{{"Access[24∈2]<br />ᐸ22.__typenameᐳ"}}:::plan
    Object22 -->|rejectNull| Access24
    Access25{{"Access[25∈2]<br />ᐸ22.idᐳ"}}:::plan
    Object22 -->|rejectNull| Access25
    PgSelect26[["PgSelect[26∈4]^<br />ᐸrelational_postsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply118["PgSelectInlineApply[118∈4] ➊<br />ᐳRelationalPost"]:::plan
    Access25 & PgSelectInlineApply118 --> PgSelect26
    List120{{"List[120∈4]^<br />ᐸ119,32ᐳ"}}:::plan
    Access119{{"Access[119∈4]^<br />ᐸ26.m.joinDetailsFor52ᐳ"}}:::plan
    PgSelectSingle32{{"PgSelectSingle[32∈4]^<br />ᐸrelational_postsᐳ"}}:::plan
    Access119 & PgSelectSingle32 --> List120
    First30{{"First[30∈4]^"}}:::plan
    PgSelectRows31[["PgSelectRows[31∈4]^"]]:::plan
    PgSelectRows31 --> First30
    PgSelect26 --> PgSelectRows31
    First30 --> PgSelectSingle32
    PgClassExpression49{{"PgClassExpression[49∈4]^<br />ᐸ__relation...sts__.”id”ᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression49
    First56{{"First[56∈4]^"}}:::plan
    PgSelectRows57[["PgSelectRows[57∈4]^"]]:::plan
    PgSelectRows57 --> First56
    Lambda121{{"Lambda[121∈4]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda121 --> PgSelectRows57
    PgSelectSingle58{{"PgSelectSingle[58∈4]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First56 --> PgSelectSingle58
    PgClassExpression59{{"PgClassExpression[59∈4]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression59
    PgClassExpression81{{"PgClassExpression[81∈4]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgClassExpression59 o--o PgClassExpression81
    PgClassExpression99{{"PgClassExpression[99∈4]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgClassExpression81 o--o PgClassExpression99
    PgClassExpression112{{"PgClassExpression[112∈4]^<br />ᐸ__relation...__.”title”ᐳ"}}:::plan
    PgClassExpression49 o--o PgClassExpression112
    PgClassExpression115{{"PgClassExpression[115∈4]^<br />ᐸ__relation...scription”ᐳ"}}:::plan
    PgClassExpression112 o--o PgClassExpression115
    PgClassExpression117{{"PgClassExpression[117∈4]^<br />ᐸ__relation...s__.”note”ᐳ"}}:::plan
    PgClassExpression115 o--o PgClassExpression117
    PgSelect26 --> Access119
    List120 --> Lambda121
    PgSelect34[["PgSelect[34∈5]^<br />ᐸrelational_checklistsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply122["PgSelectInlineApply[122∈5] ➊<br />ᐳRelationalChecklist"]:::plan
    Access25 & PgSelectInlineApply122 --> PgSelect34
    List124{{"List[124∈5]^<br />ᐸ123,40ᐳ"}}:::plan
    Access123{{"Access[123∈5]^<br />ᐸ34.m.joinDetailsFor60ᐳ"}}:::plan
    PgSelectSingle40{{"PgSelectSingle[40∈5]^<br />ᐸrelational_checklistsᐳ"}}:::plan
    Access123 & PgSelectSingle40 --> List124
    First38{{"First[38∈5]^"}}:::plan
    PgSelectRows39[["PgSelectRows[39∈5]^"]]:::plan
    PgSelectRows39 --> First38
    PgSelect34 --> PgSelectRows39
    First38 --> PgSelectSingle40
    PgClassExpression50{{"PgClassExpression[50∈5]^<br />ᐸ__relation...sts__.”id”ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression50
    First64{{"First[64∈5]^"}}:::plan
    PgSelectRows65[["PgSelectRows[65∈5]^"]]:::plan
    PgSelectRows65 --> First64
    Lambda125{{"Lambda[125∈5]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda125 --> PgSelectRows65
    PgSelectSingle66{{"PgSelectSingle[66∈5]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First64 --> PgSelectSingle66
    PgClassExpression67{{"PgClassExpression[67∈5]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle66 --> PgClassExpression67
    PgClassExpression87{{"PgClassExpression[87∈5]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgClassExpression67 o--o PgClassExpression87
    PgClassExpression105{{"PgClassExpression[105∈5]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgClassExpression87 o--o PgClassExpression105
    PgClassExpression113{{"PgClassExpression[113∈5]^<br />ᐸ__relation...__.”title”ᐳ"}}:::plan
    PgClassExpression50 o--o PgClassExpression113
    PgSelect34 --> Access123
    List124 --> Lambda125
    PgSelect42[["PgSelect[42∈6]^<br />ᐸrelational_checklist_itemsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply126["PgSelectInlineApply[126∈6] ➊<br />ᐳRelationalChecklistItem"]:::plan
    Access25 & PgSelectInlineApply126 --> PgSelect42
    List128{{"List[128∈6]^<br />ᐸ127,48ᐳ"}}:::plan
    Access127{{"Access[127∈6]^<br />ᐸ42.m.joinDetailsFor68ᐳ"}}:::plan
    PgSelectSingle48{{"PgSelectSingle[48∈6]^<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    Access127 & PgSelectSingle48 --> List128
    First46{{"First[46∈6]^"}}:::plan
    PgSelectRows47[["PgSelectRows[47∈6]^"]]:::plan
    PgSelectRows47 --> First46
    PgSelect42 --> PgSelectRows47
    First46 --> PgSelectSingle48
    PgClassExpression51{{"PgClassExpression[51∈6]^<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression51
    First72{{"First[72∈6]^"}}:::plan
    PgSelectRows73[["PgSelectRows[73∈6]^"]]:::plan
    PgSelectRows73 --> First72
    Lambda129{{"Lambda[129∈6]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda129 --> PgSelectRows73
    PgSelectSingle74{{"PgSelectSingle[74∈6]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First72 --> PgSelectSingle74
    PgClassExpression75{{"PgClassExpression[75∈6]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle74 --> PgClassExpression75
    PgClassExpression93{{"PgClassExpression[93∈6]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgClassExpression75 o--o PgClassExpression93
    PgClassExpression111{{"PgClassExpression[111∈6]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgClassExpression93 o--o PgClassExpression111
    PgClassExpression114{{"PgClassExpression[114∈6]^<br />ᐸ__relation...scription”ᐳ"}}:::plan
    PgClassExpression51 o--o PgClassExpression114
    PgClassExpression116{{"PgClassExpression[116∈6]^<br />ᐸ__relation...s__.”note”ᐳ"}}:::plan
    PgClassExpression114 o--o PgClassExpression116
    PgSelect42 --> Access127
    List128 --> Lambda129

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect7,Access8,Access9,Object10,__ListTransform11,PgSelectRows12 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item13,PgSelectSingle14 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item15,PgSelectSingle16,PgClassExpression17,PgClassExpression19,Lambda21,Object22,Access24,Access25 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect26,First30,PgSelectRows31,PgSelectSingle32,PgClassExpression49,First56,PgSelectRows57,PgSelectSingle58,PgClassExpression59,PgClassExpression81,PgClassExpression99,PgClassExpression112,PgClassExpression115,PgClassExpression117,PgSelectInlineApply118,Access119,List120,Lambda121 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgSelect34,First38,PgSelectRows39,PgSelectSingle40,PgClassExpression50,First64,PgSelectRows65,PgSelectSingle66,PgClassExpression67,PgClassExpression87,PgClassExpression105,PgClassExpression113,PgSelectInlineApply122,Access123,List124,Lambda125 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgSelect42,First46,PgSelectRows47,PgSelectSingle48,PgClassExpression51,First72,PgSelectRows73,PgSelectSingle74,PgClassExpression75,PgClassExpression93,PgClassExpression111,PgClassExpression114,PgClassExpression116,PgSelectInlineApply126,Access127,List128,Lambda129 bucket6

