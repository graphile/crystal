<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-step-library/dataplan-pg/pgSelect">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">pgSelect and pgSelectSingle | Grafast</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://grafast.org/grafast/step-library/dataplan-pg/pgSelect"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="pgSelect and pgSelectSingle | Grafast"><meta data-rh="true" name="description" content="Though you don&#x27;t typically create a pgSelect() or pgSelectSingle() step"><meta data-rh="true" property="og:description" content="Though you don&#x27;t typically create a pgSelect() or pgSelectSingle() step"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://grafast.org/grafast/step-library/dataplan-pg/pgSelect"><link data-rh="true" rel="alternate" href="https://grafast.org/grafast/step-library/dataplan-pg/pgSelect" hreflang="en"><link data-rh="true" rel="alternate" href="https://grafast.org/grafast/step-library/dataplan-pg/pgSelect" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://G81R3UYS9Q-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Grafast" href="/opensearch.xml">


<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Grafast RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Grafast Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8cd52a68.css">
<link rel="preload" href="/assets/js/runtime~main.f86d0f08.js" as="script">
<link rel="preload" href="/assets/js/main.60ddd26c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_ncOr" role="banner"><div class="content_L1uV announcementBarContent__57G"><a href="/caveats">Read the pre-release caveats!</a> Documentation is not complete; PRs welcome ♥</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/grafast-exclamation.svg" alt="Grafast Logo" class="themedImage_RWGG themedImage--light_riBm"><img src="/img/grafast-exclamation.svg" alt="Grafast Logo" class="themedImage_RWGG themedImage--dark_Dsi0"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/grafast/">Gra<em>fast</em></a><a class="navbar__item navbar__link" href="/grafserv/">Grafserv</a><a class="navbar__item navbar__link" href="/ruru/">Ruru</a><a class="navbar__item navbar__link" href="/playground">Playground</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/news">News</a><a class="navbar__item navbar__link" href="/sponsor">Sponsor</a><a href="https://github.com/grafast/wg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">WG<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/graphile/crystal/tree/main/grafast/grafast/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_xrOJ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV docsWrapper_BqXd"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docPage_pOTq"><aside class="theme-doc-sidebar-container docSidebarContainer_aIKW"><div class="sidebarViewport_DwR9"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME menuWithAnnouncementBar_hRfJ"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/">Grafast Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/grafast/getting-started/">Getting started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/servers">Servers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/plan-resolvers">Plan resolvers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/grafast/step-library/">Step library</a><button aria-label="Toggle the collapsible sidebar category &#x27;Step library&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/grafast/step-library/standard-steps/">Standard steps</a><button aria-label="Toggle the collapsible sidebar category &#x27;Standard steps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/grafast/step-library/dataplan-json/">@dataplan/json</a><button aria-label="Toggle the collapsible sidebar category &#x27;@dataplan/json&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/grafast/step-library/dataplan-pg/">@dataplan/pg</a><button aria-label="Toggle the collapsible sidebar category &#x27;@dataplan/pg&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/grafast/step-library/dataplan-pg/registry/">Registry</a><button aria-label="Toggle the collapsible sidebar category &#x27;Registry&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/adaptors">Adaptors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/grafast/step-library/dataplan-pg/pgSelect">pgSelect and pgSelectSingle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgClassExpression">pgClassExpression</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgCondition">pgCondition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgDeleteSingle">pgDeleteSingle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgInsertSingle">pgInsertSingle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgPolymorphic">pgPolymorphic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgSingleTablePolymorphic">pgSingleTablePolymorphic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgUnionAll">pgUnionAll</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/pgUpdateSingle">pgUpdateSingle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/polymorphism">Polymorphism</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/grafast/step-library/dataplan-pg/withPgClient">withPgClient and withPgClientTransaction</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/step-classes">Step classes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/request-overview">Request overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/operation-plan">Operation plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/access-control">Access control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/plan-diagrams">Plan diagrams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/polymorphism">Polymorphism</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/production-considerations">Production Considerations</a></li></ul></nav></div></div></aside><main class="docMainContainer_fv3b"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/grafast/step-library/"><span itemprop="name">Step library</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/grafast/step-library/dataplan-pg/"><span itemprop="name">@dataplan/pg</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">pgSelect and pgSelectSingle</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><h1>pgSelect and pgSelectSingle</h1><p>Though you don&#x27;t typically create a <code>pgSelect()</code> or <code>pgSelectSingle()</code> step
manually (instead using the <code>.get()</code>, <code>.find()</code> or <code>.execute()</code> methods on the
relevant resource), they are the step classes that you&#x27;ll likely interact with
the most in <code>@dataplan/pg</code>.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselect">pgSelect<a href="#pgselect" class="hash-link" aria-label="Direct link to pgSelect" title="Direct link to pgSelect">​</a></h2><p><code>pgSelect()</code> represents a selection of rows from the database. You might get a
pgSelect instance such as <code>$pgSelect</code> in this example:</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// `pgSelect()` step representing all the messages in forum 1:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $pgSelect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pgResources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">messages</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> forum_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">constant</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once you have access to a <code>pgSelect()</code> step, you may use its various methods to
add conditions, reorder it, add pagination limits, and so on.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_qNG0"><div class="admonitionHeading_l909"><span class="admonitionIcon_UNbs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_oUmQ"><p>You can only make these changes whilst planning the field in which the
<code>pgSelect()</code> was created. Once that field plan is finalized (via the Gra<em>fast</em>
<code>deduplicate</code> lifecycle event) any changes to conditions, ordering, etc may
cause your schema to violate the GraphQL specification, and thus these actions
are forbidden.</p></div></div><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_qNG0"><div class="admonitionHeading_l909"><span class="admonitionIcon_UNbs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_oUmQ"><p>If you are using a pgSelect in a mutation plan resolver, and that pgSelect has
side effects (e.g. calls a <code>VOLATILE</code> database function), then ensure that the
<a href="/grafast/step-library/dataplan-pg/registry/resources">resource</a> representing the function is correctly
configured with <code>isMutation: true</code> and that you are creating the step through
<code>resource.execute()</code>. (If this is not done then in some circumstances it&#x27;s
possible that the step may be tree-shaken away and thus the side effects may
never occur.)</p><p>(Alternatively, if creating the <code>pgSelect</code> directly, create it with
<code>mode=&quot;mutation&quot;</code>, or set <code>$pgSelect.hasSideEffects = true;</code>.)</p></div></div><p>Below we&#x27;ve documenting the most commonly used properties and methods, for full
documentation you should explore the methods and their types through
TypeScript.</p><p>Note that methods that are generally used internally or via helper steps such
as <code>connection()</code> have not been documented because you typically won&#x27;t call
these yourself.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectalias">$pgSelect.alias<a href="#pgselectalias" class="hash-link" aria-label="Direct link to $pgSelect.alias" title="Direct link to $pgSelect.alias">​</a></h3><p>Since the same table might appear multiple times in the resulting query (once
the queries have been inlined/merged), each $pgSelect is given its own alias.
The alias is an SQL fragment representing the underlying table, useful so that
you can reference a column of the table or similar:</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> usersResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> tbl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alias</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string sql language-sql interpolation">tbl</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">.</span><span class="token template-string sql language-sql">username </span><span class="token template-string sql language-sql operator" style="color:#393A34">=</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql string" style="color:#e3116c">&#x27;Benjie&#x27;</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsingle">$pgSelect.single()<a href="#pgselectsingle" class="hash-link" aria-label="Direct link to $pgSelect.single()" title="Direct link to $pgSelect.single()">​</a></h3><p>If this plan may only return one record, you can use <code>$pgSelect.single()</code> to
return a plan that resolves to either that record (in the case of composite
types) or the underlying scalar (in the case of a resource whose codec has no
attributes).</p><p>Beware: if you call this and the database might actually return more than
one record then you&#x27;re potentially in for a Bad Time.</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Instead of:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     const $user = usersResource.get({ id: constant(1) });</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// you could do:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> usersResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">constant</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">single</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsingleasrecord">$pgSelect.singleAsRecord()<a href="#pgselectsingleasrecord" class="hash-link" aria-label="Direct link to $pgSelect.singleAsRecord()" title="Direct link to $pgSelect.singleAsRecord()">​</a></h3><p>Most likely you want <code>.single()</code> instead; only use this if you specifically
need a <code>PgSelectSingleStep</code> instance even though you&#x27;re querying a scalar.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectrowrow">$pgSelect.row($row)<a href="#pgselectrowrow" class="hash-link" aria-label="Direct link to $pgSelect.row($row)" title="Direct link to $pgSelect.row($row)">​</a></h3><p>You can use this to create a <code>pgSelectSingle</code> instance based on an arbitrary
entry from a <code>$pgSelect</code>, e.g. to get the first row from a <code>$pgSelect</code> set as a
<code>pgSelectSingle</code> you might do:</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $row </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $pgSelect</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">row</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">first</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$pgSelect</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectorderbyspec">$pgSelect.orderBy(spec)<a href="#pgselectorderbyspec" class="hash-link" aria-label="Direct link to $pgSelect.orderBy(spec)" title="Direct link to $pgSelect.orderBy(spec)">​</a></h3><p>Adds an ordering clause to the query. Can be called multiple times to add more
ordering clauses, these are always appended to the existing list.</p><p>The argument can either be an attribute spec, an object with the following properties:</p><ul><li><code>attribute</code> (required) - the name of the attribute to sort by, must be one of the attributes on the codec the $pgSelect represents</li><li><code>callback</code> (optional) - used to wrap the attribute in an expression</li><li><code>direction</code> (required) - <code>&quot;ASC&quot;</code> or <code>&quot;DESC&quot;</code></li><li><code>nulls</code> (optional) - <code>&quot;FIRST&quot;</code> or <code>&quot;LAST&quot;</code> or <code>null</code></li></ul><p>or a fragment spec, an object with the following properties:</p><ul><li><code>fragment</code> (required) - an SQL expression to order by</li><li><code>codec</code> (required) - the codec that matches the type of the expression in <code>fragment</code></li><li><code>direction</code> (required) - <code>&quot;ASC&quot;</code> or <code>&quot;DESC&quot;</code></li><li><code>nulls</code> (optional) - <code>&quot;FIRST&quot;</code> or <code>&quot;LAST&quot;</code> or <code>null</code></li></ul><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Get a pgSelect:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> usersResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Sort by username length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">orderBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;username&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usernameExpression</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> codec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sql</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string sql language-sql">length</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">(</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string sql language-sql interpolation">usernameExpression</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">)</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TYPES</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  direction</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ASC&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nulls</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;LAST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Sort within that by user id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">orderBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> direction</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ASC&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Result is something like:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// `SELECT ... FROM users ORDER BY length(username) ASC NULLS LAST, id ASC`</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsetorderisunique">$pgSelect.setOrderIsUnique()<a href="#pgselectsetorderisunique" class="hash-link" aria-label="Direct link to $pgSelect.setOrderIsUnique()" title="Direct link to $pgSelect.setOrderIsUnique()">​</a></h3><p>Call this if you are certain that the order that you&#x27;ve specified is sufficient
to ensure that there are no ambiguities in the ordering (i.e. it is stable). If
you don&#x27;t do this then we might (if unique order is required, for example for
cursor pagination) add the primary key or similar unique constraint to the
ordering in order to make it stable.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectwherecondition">$pgSelect.where(condition)<a href="#pgselectwherecondition" class="hash-link" aria-label="Direct link to $pgSelect.where(condition)" title="Direct link to $pgSelect.where(condition)">​</a></h3><p>Adds a <code>WHERE</code> clause to the query, can be called multiple times and the
conditions will be appended with <code>AND</code>.</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> usersResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> tbl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alias</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string sql language-sql interpolation">tbl</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">.</span><span class="token template-string sql language-sql">username </span><span class="token template-string sql language-sql operator" style="color:#393A34">=</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql string" style="color:#e3116c">&#x27;Benjie&#x27;</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectplaceholderstep-codec">$pgSelect.placeholder($step, codec)<a href="#pgselectplaceholderstep-codec" class="hash-link" aria-label="Direct link to $pgSelect.placeholder($step, codec)" title="Direct link to $pgSelect.placeholder($step, codec)">​</a></h3><p>Placeholder accepts an arbitrary step and a codec representing what its SQL
type should be (optional if the step already contains details of the codec) and
returns an SQL expression that allows the value of the step to be referenced
inside an SQL query.</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> usersResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> tbl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alias</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $username </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fieldArgs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;username&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> frag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">placeholder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TYPES</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">citext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string sql language-sql interpolation">tbl</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">.</span><span class="token template-string sql language-sql">username </span><span class="token template-string sql language-sql operator" style="color:#393A34">=</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string sql language-sql interpolation">frag</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglerelationrelationname">$pgSelect.singleRelation(relationName)<a href="#pgselectsinglerelationrelationname" class="hash-link" aria-label="Direct link to $pgSelect.singleRelation(relationName)" title="Direct link to $pgSelect.singleRelation(relationName)">​</a></h3><p>Forces the <code>$pgSelect</code> to do a left join to the given relation and gives you an
alias representing this join; useful for building conditions on related tables.</p><p>Note this method on <code>pgSelect</code> (collection) differs from the same named method
on <code>pgSelectSingle</code> (row) which instead returns a step representing the related
record.</p><p>Example: &quot;return all the posts where the forum is not archived&quot;:</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $posts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> postsResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> forumAlias </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $posts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">singleRelation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;forum&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$posts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string sql language-sql interpolation">forumAlias</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">.</span><span class="token template-string sql language-sql">is_archived </span><span class="token template-string sql language-sql operator" style="color:#393A34">=</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql boolean" style="color:#36acaa">false</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> $posts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Result is something like:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// `SELECT ... FROM posts LEFT JOIN forums ON (...) WHERE forums.is_archived = false`</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_qNG0"><div class="admonitionHeading_l909"><span class="admonitionIcon_UNbs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_oUmQ"><p>If the relationship is not unique then an error will be thrown.</p></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectwhereplan">$pgSelect.wherePlan()<a href="#pgselectwhereplan" class="hash-link" aria-label="Direct link to $pgSelect.wherePlan()" title="Direct link to $pgSelect.wherePlan()">​</a></h3><p>Instead of adding conditions directly, this advanced method returns a
<code>PgConditionStep</code> (a &quot;modifier step&quot;) which allows the condition to be built up
in a different way. This is particularly useful if you are building deep
filtering arguments, using the <code>applyPlan</code> plan resolver on arguments and input
fields.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsetfirstn">$pgSelect.setFirst($n)<a href="#pgselectsetfirstn" class="hash-link" aria-label="Direct link to $pgSelect.setFirst($n)" title="Direct link to $pgSelect.setFirst($n)">​</a></h3><p>Limits the number of records returned.</p><p>Currently this must be called with an input step (i.e. it must come from a
GraphQL field argument or be a constant).</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsetlastn">$pgSelect.setLast($n)<a href="#pgselectsetlastn" class="hash-link" aria-label="Direct link to $pgSelect.setLast($n)" title="Direct link to $pgSelect.setLast($n)">​</a></h3><p>Limits the number of records returned, but instead of taking the first entries
in the list, it takes the last ones.</p><p>Currently this must be called with an input step (i.e. it must come from a
GraphQL field argument or be a constant).</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsetoffsetn">$pgSelect.setOffset($n)<a href="#pgselectsetoffsetn" class="hash-link" aria-label="Direct link to $pgSelect.setOffset($n)" title="Direct link to $pgSelect.setOffset($n)">​</a></h3><p>Skips over the given number of records, cannot be combined with <code>setLast</code>.</p><p>Currently this must be called with an input step (i.e. it must come from a
GraphQL field argument or be a constant).</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectgroupbyspec">$pgSelect.groupBy(spec)<a href="#pgselectgroupbyspec" class="hash-link" aria-label="Direct link to $pgSelect.groupBy(spec)" title="Direct link to $pgSelect.groupBy(spec)">​</a></h3><p>Instructs the query to add a <code>GROUP BY</code> clause. Currently spec must be an
object with the following properties:</p><ul><li><code>fragment</code> (required) - an SQL fragment to indicate what to <code>GROUP BY</code></li></ul><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselecthavingcondition">$pgSelect.having(condition)<a href="#pgselecthavingcondition" class="hash-link" aria-label="Direct link to $pgSelect.having(condition)" title="Direct link to $pgSelect.having(condition)">​</a></h3><p>Like <code>$pgSelect.where(condition)</code>, but for the <code>HAVING</code> clause of a grouped
query and only supports the SQL fragment condition form.</p><p>TODO: THIS METHOD IS UNTESTED!</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselecthavingplan">$pgSelect.havingPlan()<a href="#pgselecthavingplan" class="hash-link" aria-label="Direct link to $pgSelect.havingPlan()" title="Direct link to $pgSelect.havingPlan()">​</a></h3><p>Like <code>$pgSelect.wherePlan()</code> but for the <code>HAVING</code> clause.</p><p>TODO: THIS METHOD IS UNTESTED!</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsetunique">$pgSelect.setUnique()<a href="#pgselectsetunique" class="hash-link" aria-label="Direct link to $pgSelect.setUnique()" title="Direct link to $pgSelect.setUnique()">​</a></h3><p>Call this ONLY if there can be at most one matching row. If you set this true
when this is not the case then you may get unexpected results during inlining;
if in doubt leave it at the default.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselecthasmore">$pgSelect.hasMore()<a href="#pgselecthasmore" class="hash-link" aria-label="Direct link to $pgSelect.hasMore()" title="Direct link to $pgSelect.hasMore()">​</a></h3><p>Returns a step indicating if there&#x27;s a next page or not (by selecting 1 extra
row and throwing it away). Typically this is used by the <code>connection()</code> steps
<code>pageInfo</code> logic and you wouldn&#x27;t call it yourself.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsetinliningforbidden">$pgSelect.setInliningForbidden()<a href="#pgselectsetinliningforbidden" class="hash-link" aria-label="Direct link to $pgSelect.setInliningForbidden()" title="Direct link to $pgSelect.setInliningForbidden()">​</a></h3><p>Call this if you wish to prevent this query from being inlined into its parent.
You may want to do this to work around a performance issue, or to improve the
cacheability of the step.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsettrusted">$pgSelect.setTrusted()<a href="#pgselectsettrusted" class="hash-link" aria-label="Direct link to $pgSelect.setTrusted()" title="Direct link to $pgSelect.setTrusted()">​</a></h3><p>By default, all <code>pgSelect</code> steps will apply the authorization checks that their
resource specifies, for example to apply conditions similar to row-level
security. Call this if you wish to bypass this behavior, for example if you know
that the conditions would pass because the parent was visible.</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> plans </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Forum</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">posts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$forum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $posts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> postsResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> forum_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $forum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// If we can see the forum, then we can see all the posts inside the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// forum, so don&#x27;t bother adding the access conditions:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      $posts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setTrusted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> $posts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsingle-1">pgSelectSingle<a href="#pgselectsingle-1" class="hash-link" aria-label="Direct link to pgSelectSingle" title="Direct link to pgSelectSingle">​</a></h2><p><code>pgSelectSingle()</code> represents a single row from within a <code>pgSelect()</code>
collection. Typically you wouldn&#x27;t build an instance of this directly, instead
you&#x27;d get it from <code>resource.get()</code>, <code>resource.execute()</code> (for isUnique
functions), from the entries in a list from a <code>pgSelect</code>, or via
<code>$pgSelect.single()</code>.</p><p>Here are some of the more commonly used methods:</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglegetattr">$pgSelectSingle.get(attr)<a href="#pgselectsinglegetattr" class="hash-link" aria-label="Direct link to $pgSelectSingle.get(attr)" title="Direct link to $pgSelectSingle.get(attr)">​</a></h3><p>The absolute most commonly used method on a <code>pgSelectSingle</code>, this gets a step
representing the value of the given attribute from the row.</p><div class="theme-admonition theme-admonition-important alert alert--info admonition_qNG0"><div class="admonitionHeading_l909"><span class="admonitionIcon_UNbs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_oUmQ"><p>You must always use <code>$pgSelectSingle.get(attr)</code> rather than
<code>access($pgSelectSingle, attr)</code> or similar for multiple reasons:</p><ol><li>the data a <code>pgSelectSingle</code> contains is an unpredictable tuple (see <a href="#opaque-steps">Opaque steps</a> below),</li><li>the <code>.get(attr)</code> tells the related <code>pgSelect</code> step to add the <code>attr</code> to the list of expressions to <code>SELECT</code></li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsingleselectfragment-codec">$pgSelectSingle.select(fragment, codec)<a href="#pgselectsingleselectfragment-codec" class="hash-link" aria-label="Direct link to $pgSelectSingle.select(fragment, codec)" title="Direct link to $pgSelectSingle.select(fragment, codec)">​</a></h3><p>Returns a PgClassExpressionStep representing the value of the given SQL
expression.</p><div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> usersResource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">constant</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> $usernameLength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string sql language-sql">length</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">(</span><span class="token template-string sql language-sql">username</span><span class="token template-string sql language-sql punctuation" style="color:#393A34">)</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TYPES</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsingleplaceholderstep-codec">$pgSelectSingle.placeholder($step, codec)<a href="#pgselectsingleplaceholderstep-codec" class="hash-link" aria-label="Direct link to $pgSelectSingle.placeholder($step, codec)" title="Direct link to $pgSelectSingle.placeholder($step, codec)">​</a></h3><p>Identical to <code>$pgSelect.placeholder($step, codec)</code> on the underlying <code>pgSelect</code> step.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglesinglerelationrelationname">$pgSelectSingle.singleRelation(relationName)<a href="#pgselectsinglesinglerelationrelationname" class="hash-link" aria-label="Direct link to $pgSelectSingle.singleRelation(relationName)" title="Direct link to $pgSelectSingle.singleRelation(relationName)">​</a></h3><p>Returns a <code>pgSelectSingle</code> representing the single record related via the
<code>relationName</code> relation.</p><p>Do not confuse with <code>$pgSelect.singleRelation</code>.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglemanyrelationrelationname">$pgSelectSingle.manyRelation(relationName)<a href="#pgselectsinglemanyrelationrelationname" class="hash-link" aria-label="Direct link to $pgSelectSingle.manyRelation(relationName)" title="Direct link to $pgSelectSingle.manyRelation(relationName)">​</a></h3><p>Returns a <code>pgSelect</code> representing the records related via the
<code>relationName</code> relation.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglerecord">$pgSelectSingle.record()<a href="#pgselectsinglerecord" class="hash-link" aria-label="Direct link to $pgSelectSingle.record()" title="Direct link to $pgSelectSingle.record()">​</a></h3><p>Returns a PgClassExpressionStep representing the entire table, useful for debugging or to use with <code>pgSelectSingleFromRecord</code>.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglecursor">$pgSelectSingle.cursor()<a href="#pgselectsinglecursor" class="hash-link" aria-label="Direct link to $pgSelectSingle.cursor()" title="Direct link to $pgSelectSingle.cursor()">​</a></h3><p>Returns a step representing the cursor of this row, typically used for
the <code>cursor</code> field in a connection edge.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglegetclassstep">$pgSelectSingle.getClassStep()<a href="#pgselectsinglegetclassstep" class="hash-link" aria-label="Direct link to $pgSelectSingle.getClassStep()" title="Direct link to $pgSelectSingle.getClassStep()">​</a></h3><p>Returns the <code>PgSelectStep</code> that this <code>$pgSelectSingle</code> came from. Useful to get
the <code>alias</code>, among other things.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectfromrecordsresource-records">pgSelectFromRecords(resource, $records)<a href="#pgselectfromrecordsresource-records" class="hash-link" aria-label="Direct link to pgSelectFromRecords(resource, $records)" title="Direct link to pgSelectFromRecords(resource, $records)">​</a></h2><p>Builds a <code>pgSelect</code> step representing the multi-row data in <code>$records</code> as if
they had come from the <code>resource</code> resource.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectfromrecordresource-record">pgSelectFromRecord(resource, $record)<a href="#pgselectfromrecordresource-record" class="hash-link" aria-label="Direct link to pgSelectFromRecord(resource, $record)" title="Direct link to pgSelectFromRecord(resource, $record)">​</a></h2><p>Builds a <code>pgSelect</code> step using the single-row data in <code>$record</code> as if it had
come from the <code>resource</code> resource.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="pgselectsinglefromrecordresource-record">pgSelectSingleFromRecord(resource, $record)<a href="#pgselectsinglefromrecordresource-record" class="hash-link" aria-label="Direct link to pgSelectSingleFromRecord(resource, $record)" title="Direct link to pgSelectSingleFromRecord(resource, $record)">​</a></h2><p>Equivalent to <code>pgSelectFromRecord(resource, $record).single()</code>.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="opaque-steps">Opaque steps<a href="#opaque-steps" class="hash-link" aria-label="Direct link to Opaque steps" title="Direct link to Opaque steps">​</a></h2><p><code>pgSelect</code> and <code>pgSelectSingle</code> are what we call &quot;opaque steps&quot; - that is you
are not intended to use their underlying data directly, instead you use their
methods to extract the data you need to use with other steps.</p><p>Currently a <code>pgSelectSingle</code> doesn&#x27;t use the object representation you might
expect, instead it uses a tuple with entries for each of the selected
attributes. The makeup of this tuple will vary depending on which attributes
you requested, and in which order, so you must not rely on its structure. To
get an attribute you should use <code>$pgSelectSingle.get(attr)</code> or similar</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/graphile/crystal/tree/main/grafast/website/grafast/step-library/dataplan-pg/pgSelect.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UohW" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_T23F"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/grafast/step-library/dataplan-pg/adaptors"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Adaptors</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/grafast/step-library/dataplan-pg/pgClassExpression"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">pgClassExpression</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pgselect" class="table-of-contents__link toc-highlight">pgSelect</a><ul><li><a href="#pgselectalias" class="table-of-contents__link toc-highlight">$pgSelect.alias</a></li><li><a href="#pgselectsingle" class="table-of-contents__link toc-highlight">$pgSelect.single()</a></li><li><a href="#pgselectsingleasrecord" class="table-of-contents__link toc-highlight">$pgSelect.singleAsRecord()</a></li><li><a href="#pgselectrowrow" class="table-of-contents__link toc-highlight">$pgSelect.row($row)</a></li><li><a href="#pgselectorderbyspec" class="table-of-contents__link toc-highlight">$pgSelect.orderBy(spec)</a></li><li><a href="#pgselectsetorderisunique" class="table-of-contents__link toc-highlight">$pgSelect.setOrderIsUnique()</a></li><li><a href="#pgselectwherecondition" class="table-of-contents__link toc-highlight">$pgSelect.where(condition)</a></li><li><a href="#pgselectplaceholderstep-codec" class="table-of-contents__link toc-highlight">$pgSelect.placeholder($step, codec)</a></li><li><a href="#pgselectsinglerelationrelationname" class="table-of-contents__link toc-highlight">$pgSelect.singleRelation(relationName)</a></li><li><a href="#pgselectwhereplan" class="table-of-contents__link toc-highlight">$pgSelect.wherePlan()</a></li><li><a href="#pgselectsetfirstn" class="table-of-contents__link toc-highlight">$pgSelect.setFirst($n)</a></li><li><a href="#pgselectsetlastn" class="table-of-contents__link toc-highlight">$pgSelect.setLast($n)</a></li><li><a href="#pgselectsetoffsetn" class="table-of-contents__link toc-highlight">$pgSelect.setOffset($n)</a></li><li><a href="#pgselectgroupbyspec" class="table-of-contents__link toc-highlight">$pgSelect.groupBy(spec)</a></li><li><a href="#pgselecthavingcondition" class="table-of-contents__link toc-highlight">$pgSelect.having(condition)</a></li><li><a href="#pgselecthavingplan" class="table-of-contents__link toc-highlight">$pgSelect.havingPlan()</a></li><li><a href="#pgselectsetunique" class="table-of-contents__link toc-highlight">$pgSelect.setUnique()</a></li><li><a href="#pgselecthasmore" class="table-of-contents__link toc-highlight">$pgSelect.hasMore()</a></li><li><a href="#pgselectsetinliningforbidden" class="table-of-contents__link toc-highlight">$pgSelect.setInliningForbidden()</a></li><li><a href="#pgselectsettrusted" class="table-of-contents__link toc-highlight">$pgSelect.setTrusted()</a></li></ul></li><li><a href="#pgselectsingle-1" class="table-of-contents__link toc-highlight">pgSelectSingle</a><ul><li><a href="#pgselectsinglegetattr" class="table-of-contents__link toc-highlight">$pgSelectSingle.get(attr)</a></li><li><a href="#pgselectsingleselectfragment-codec" class="table-of-contents__link toc-highlight">$pgSelectSingle.select(fragment, codec)</a></li><li><a href="#pgselectsingleplaceholderstep-codec" class="table-of-contents__link toc-highlight">$pgSelectSingle.placeholder($step, codec)</a></li><li><a href="#pgselectsinglesinglerelationrelationname" class="table-of-contents__link toc-highlight">$pgSelectSingle.singleRelation(relationName)</a></li><li><a href="#pgselectsinglemanyrelationrelationname" class="table-of-contents__link toc-highlight">$pgSelectSingle.manyRelation(relationName)</a></li><li><a href="#pgselectsinglerecord" class="table-of-contents__link toc-highlight">$pgSelectSingle.record()</a></li><li><a href="#pgselectsinglecursor" class="table-of-contents__link toc-highlight">$pgSelectSingle.cursor()</a></li><li><a href="#pgselectsinglegetclassstep" class="table-of-contents__link toc-highlight">$pgSelectSingle.getClassStep()</a></li></ul></li><li><a href="#pgselectfromrecordsresource-records" class="table-of-contents__link toc-highlight">pgSelectFromRecords(resource, $records)</a></li><li><a href="#pgselectfromrecordresource-record" class="table-of-contents__link toc-highlight">pgSelectFromRecord(resource, $record)</a></li><li><a href="#pgselectsinglefromrecordresource-record" class="table-of-contents__link toc-highlight">pgSelectSingleFromRecord(resource, $record)</a></li><li><a href="#opaque-steps" class="table-of-contents__link toc-highlight">Opaque steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/grafast">Gra<em>fast</em></a></li><li class="footer__item"><a class="footer__link-item" href="/grafserv/">Grafserv</a></li><li class="footer__item"><a class="footer__link-item" href="/ruru/">Ruru</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/graphile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/GraphileHQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/graphile/crystal" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Graphile Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f86d0f08.js"></script>
<script src="/assets/js/main.60ddd26c.js"></script>
</body>
</html>