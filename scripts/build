#!/bin/bash

set -e
cd $(dirname $0)/..

./scripts/postinstall

npm_bin=$(npm bin)

echo "Cleaning build"
rm -rf build
mkdir build

echo "Compiling with TypeScript"
$npm_bin/tsc

echo "Building GraphiQL"
npm --prefix src/postgraphql/graphiql run build

echo "Moving GraphiQL build output"
mkdir -p build/postgraphql/graphiql/public
mv src/postgraphql/graphiql/build/* build/postgraphql/graphiql/public
